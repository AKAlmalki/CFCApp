{% extends "base.html" %} {% load static %} {% load humanize %} {% block head %}
<!-- Include jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- Include jQuery Validation Plugin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
<script src="{% static 'js/supporter_form(indiv).js' %}"></script>
<link rel="stylesheet" href="{% static 'css/supporter_form(indiv).css' %}" />

{% comment %} Data Table Requirements {% endcomment %}
{% comment %} Local {% endcomment %}
{% comment %} <link rel="stylesheet" href="{% static '/DataTables/datatables.css' %}" />
<script src="{% static '/DataTables/datatables.js' %}"></script> {% endcomment %}
{% comment %} Online {% endcomment %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" />
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/select/1.7.0/js/dataTables.select.min.js"></script>
<style type="text/css">
  #sponsorship_information,
  #payment_and_submit_confirmation {
    display: none;
  }
  {% comment %} CSS for age range input with MIN-MAX {% endcomment %}
  .ageContainer {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 500px;
  }
  .ageContainer input[type="number"] {
    width: 50px;
    height: 30px;
    background: #fff;
    border: 1px solid #ddd;
    font-size: 15px;
    font-weight: 700;
    text-align: center;
    border-radius: 5px;
  }
  .ageContainer input[type="number"]::-webkit-outer-spin-button,
  .ageContainer input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
  }
  .ageContainer .range-slider {
    position: relative;
    width: 400px;
    height: 5px;
    background: #ddd;
    outline: none;
    top: 1px;
    margin: 10px;
  }
  .ageContainer .range-slider .progress {
    left: 66%;
    right: 8.5%;
    height: 100%;
    background: #0d6efd;
    border-radius: 50px;
    position: absolute;
  }
  .ageContainer .range-slider input[type="range"] {
    position: absolute;
    top: -8px;
    left: -5px;
    width: 101%;
    -webkit-appearance: none;
    pointer-events: none;
    background: none;
    outline: none;
  }
  .ageContainer .range-slider input::-webkit-slider-thumb {
    pointer-events: auto;
    -webkit-apparance: none;
    width: 17px;
    height: 17px;
    background: #17a288;
    border-radius: 50px;
  }
  div.dataTables_wrapper div.dt-row {
    overflow-x: scroll;
  }
  div.dataTables_wrapper div.dataTables_filter label {
  }
  #beneficiaries_table_paginate {
    margin-top: 1rem!important;
  }
</style>
{% endblock %} {% block content %}
<div class="container mt-5 px-0 mb-4 p-5 rounded-3 ">
  <h1 class="fw-bold">تقديم طلب كفالة</h1>
  <div id="multi-step-form-container">
    {% comment %} Progress Bar {% endcomment %}
    <ul
      class="form-stepper form-stepper-horizontal text-center justify-content-center px-0 ps-lg-3 ps-xl-0 ps-md-0 mx-auto pl-0 d-flex justify-content-center row row-cols-md-5 row-cols-3"
    >
      <!-- Step 1 -->
      <li
        class="form-stepper-active text-center form-stepper-list"
        step="1"
        id="form-list-1"
      >
        <a class="mx-2 text-decoration-none">
          <span class="form-stepper-circle">
            <span>1</span>
          </span>
          <div class="label">بيانات مقدم الطلب</div>
        </a>
      </li>
      <!-- Step 2 -->
      <li
        class="form-stepper-unfinished text-center form-stepper-list"
        step="2"
        id="form-list-2"
      >
        <a class="mx-2 text-decoration-none">
          <span class="form-stepper-circle text-muted">
            <span>2</span>
          </span>
          <div class="label text-muted">
            <p class="p-0 m-0">بيانات الدعم</p>
          </div>
        </a>
      </li>
      <!-- Step 3 -->
      <li
        class="form-stepper-unfinished text-center form-stepper-list"
        step="3"
        id="form-list-3"
      >
        <a class="mx-2 text-decoration-none">
          <span class="form-stepper-circle text-muted">
            <span>3</span>
          </span>
          <div class="label text-muted">الدفع وتأكيد الطلب</div>
        </a>
      </li>
    </ul>

    <form 
      id="supporter_form" 
      enctype="multipart/form-data" 
      action="{% url 'supporter_indiv_post' %}" 
      method="POST" 
      class="needs-validation"
    >
      {% csrf_token %}
        <fieldset id="personal_information" class="form-step bg-light px-3 px-lg-5">
          <legend class="fs-2 fw-bold mb-5">بيانات مقدم الطلب</legend>
          <!-- Step 1 input fields -->
          <div class="mt-3">
          <div class="">
            <div class="container">
              <div class="row row-cols-md-2 row-cols-xl-4">
                <div class="mb-4 form-group">
                  <label for="id_personalinfo_first_name" class="form-label"
                    >الاسم الأول<span style="color: red">*</span></label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="id_personalinfo_first_name"
                    maxlength="55"
                    required
                    name="personalinfo_first_name"
                  />
                </div>
                <div class="mb-4 form-group">
                  <label for="id_personalinfo_second_name" class="form-label"
                    >الاسم الثاني<span style="color: red">*</span></label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="id_personalinfo_second_name"
                    maxlength="55"
                    required
                    name="personalinfo_second_name"
                  />
                </div>
                <div class="mb-4 form-group">
                  <label for="id_personalinfo_last_name" class="form-label"
                    >الاسم الاخير<span style="color: red">*</span> (اسم
                    العائلة)</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="id_personalinfo_last_name"
                    maxlength="55"
                    required
                    name="personalinfo_last_name"
                  />
                </div>
                <div class="mb-4 form-group">
                  <label
                    for="id_personalinfo_date_of_birth"
                    class="form-label"
                    >تاريخ الميلاد<span style="color: red">*</span></label
                  >
                  <input
                    type="date"
                    class="form-control"
                    id="id_personalinfo_date_of_birth"
                    maxlength="55"
                    required
                    name="personalinfo_date_of_birth"
                  />
                </div>
              </div>

              <hr />

              <div class="row row-cols-md-2 row-cols-xl-4">
                <div class="mb-4 form-group">
                  <label for="id_personalinfo_gender" class="form-label"
                    >الجنس<span style="color: red">*</span></label
                  >
                  <select
                    name="personalinfo_gender"
                    class="form-control"
                    id="id_personalinfo_gender"
                    required
                  >
                    <option value selected>---------</option>
                    <option value="ذكر">ذكر</option>
                    <option value="انثى">انثى</option>
                  </select>
                </div>
                <div class="mb-4 form-group">
                  <label for="id_personalinfo_national_id" class="form-label"
                    >رقم الهوية الوطنية \ الإقامة<span style="color: red"
                      >*</span
                    ></label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="id_personalinfo_national_id"
                    maxlength="20"
                    name="personalinfo_national_id"
                    required
                  />
                </div>
                <div class="mb-4 form-group">
                  <label
                    for="id_personalinfo_national_id_exp_date"
                    class="form-label"
                    >تاريخ انتهاء الهوية \ الإقامة<span style="color: red"
                      >*</span
                    ></label
                  >
                  <input
                    type="date"
                    class="form-control"
                    id="id_personalinfo_national_id_exp_date"
                    name="personalinfo_national_id_exp_date"
                    required
                  />
                </div>
                <div class="mb-4 form-group">
                  <label for="id_personalinfo_nationality" class="form-label"
                    >الجنسية<span style="color: red">*</span></label
                  >
                  <select
                    name="personalinfo_nationality"
                    class="form-control"
                    id="id_personalinfo_nationality"
                  >
                    <option value selected>إختر</option>
                    <option value="السعودية">السعودية</option>
                    <option value="أفغانستان">أفغانستان</option>
                    <option value="ألبانيا">ألبانيا</option>
                    <option value="الجزائر">الجزائر</option>
                    <option value="أندورا">أندورا</option>
                    <option value="أنغولا">أنغولا</option>
                    <option value="أنتيغوا وباربودا">أنتيغوا وباربودا</option>
                    <option value="الأرجنتين">الأرجنتين</option>
                    <option value="أرمينيا">أرمينيا</option>
                    <option value="أستراليا">أستراليا</option>
                    <option value="النمسا">النمسا</option>
                    <option value="أذربيجان">أذربيجان</option>
                    <option value="البهاما">البهاما</option>
                    <option value="البحرين">البحرين</option>
                    <option value="بنغلاديش">بنغلاديش</option>
                    <option value="باربادوس">باربادوس</option>
                    <option value="بيلاروسيا">بيلاروسيا</option>
                    <option value="بلجيكا">بلجيكا</option>
                    <option value="بليز">بليز</option>
                    <option value="بنين">بنين</option>
                    <option value="بوتان">بوتان</option>
                    <option value="بوليفيا">بوليفيا</option>
                    <option value="البوسنة والهرسك ">البوسنة والهرسك</option>
                    <option value="بوتسوانا">بوتسوانا</option>
                    <option value="البرازيل">البرازيل</option>
                    <option value="بروناي">بروناي</option>
                    <option value="بلغاريا">بلغاريا</option>
                    <option value="بوركينا فاسو ">بوركينا فاسو</option>
                    <option value="بوروندي">بوروندي</option>
                    <option value="كمبوديا">كمبوديا</option>
                    <option value="الكاميرون">الكاميرون</option>
                    <option value="كندا">كندا</option>
                    <option value="الرأس الأخضر">الرأس الأخضر</option>
                    <option value="جمهورية أفريقيا الوسطى ">
                      جمهورية أفريقيا الوسطى
                    </option>
                    <option value="تشاد">تشاد</option>
                    <option value="تشيلي">تشيلي</option>
                    <option value="الصين">الصين</option>
                    <option value="كولومبيا">كولومبيا</option>
                    <option value="جزر القمر">جزر القمر</option>
                    <option value="كوستاريكا">كوستاريكا</option>
                    <option value="ساحل العاج">ساحل العاج</option>
                    <option value="كرواتيا">كرواتيا</option>
                    <option value="كوبا">كوبا</option>
                    <option value="قبرص">قبرص</option>
                    <option value="التشيك">التشيك</option>
                    <option value="جمهورية الكونغو الديمقراطية">
                      جمهورية الكونغو الديمقراطية
                    </option>
                    <option value="الدنمارك">الدنمارك</option>
                    <option value="جيبوتي">جيبوتي</option>
                    <option value="دومينيكا">دومينيكا</option>
                    <option value="جمهورية الدومينيكان">
                      جمهورية الدومينيكان
                    </option>
                    <option value="تيمور الشرقية ">تيمور الشرقية</option>
                    <option value="الإكوادور">الإكوادور</option>
                    <option value="مصر">مصر</option>
                    <option value="السلفادور">السلفادور</option>
                    <option value="غينيا الاستوائية">غينيا الاستوائية</option>
                    <option value="إريتريا">إريتريا</option>
                    <option value="إستونيا">إستونيا</option>
                    <option value="إثيوبيا">إثيوبيا</option>
                    <option value="فيجي">فيجي</option>
                    <option value="فنلندا">فنلندا</option>
                    <option value="فرنسا">فرنسا</option>
                    <option value="الغابون">الغابون</option>
                    <option value="غامبيا">غامبيا</option>
                    <option value="جورجيا">جورجيا</option>
                    <option value="ألمانيا">ألمانيا</option>
                    <option value="غانا">غانا</option>
                    <option value="اليونان">اليونان</option>
                    <option value="جرينادا">جرينادا</option>
                    <option value="غواتيمالا">غواتيمالا</option>
                    <option value="غينيا">غينيا</option>
                    <option value="غينيا بيساو">غينيا بيساو</option>
                    <option value="غويانا">غويانا</option>
                    <option value="هايتي">هايتي</option>
                    <option value="هندوراس">هندوراس</option>
                    <option value="المجر">المجر</option>
                    <option value="آيسلندا">آيسلندا</option>
                    <option value="الهند">الهند</option>
                    <option value="إندونيسيا">إندونيسيا</option>
                    <option value="إيران">إيران</option>
                    <option value="العراق">العراق</option>
                    <option value="جمهورية أيرلندا ">جمهورية أيرلندا</option>
                    <option value="فلسطين">فلسطين</option>
                    <option value="إيطاليا">إيطاليا</option>
                    <option value="جامايكا">جامايكا</option>
                    <option value="اليابان">اليابان</option>
                    <option value="الأردن">الأردن</option>
                    <option value="كازاخستان">كازاخستان</option>
                    <option value="كينيا">كينيا</option>
                    <option value="كيريباتي">كيريباتي</option>
                    <option value="الكويت">الكويت</option>
                    <option value="قرغيزستان">قرغيزستان</option>
                    <option value="لاوس">لاوس</option>
                    <option value="لاوس">لاوس</option>
                    <option value="لاتفيا">لاتفيا</option>
                    <option value="لبنان">لبنان</option>
                    <option value="ليسوتو">ليسوتو</option>
                    <option value="ليبيريا">ليبيريا</option>
                    <option value="ليبيا">ليبيا</option>
                    <option value="ليختنشتاين">ليختنشتاين</option>
                    <option value="ليتوانيا">ليتوانيا</option>
                    <option value="لوكسمبورغ">لوكسمبورغ</option>
                    <option value="مدغشقر">مدغشقر</option>
                    <option value="مالاوي">مالاوي</option>
                    <option value="ماليزيا">ماليزيا</option>
                    <option value="جزر المالديف">جزر المالديف</option>
                    <option value="مالي">مالي</option>
                    <option value="مالطا">مالطا</option>
                    <option value="جزر مارشال">جزر مارشال</option>
                    <option value="موريتانيا">موريتانيا</option>
                    <option value="موريشيوس">موريشيوس</option>
                    <option value="المكسيك">المكسيك</option>
                    <option value="مايكرونيزيا">مايكرونيزيا</option>
                    <option value="مولدوفا">مولدوفا</option>
                    <option value="موناكو">موناكو</option>
                    <option value="منغوليا">منغوليا</option>
                    <option value="الجبل الأسود">الجبل الأسود</option>
                    <option value="المغرب">المغرب</option>
                    <option value="موزمبيق">موزمبيق</option>
                    <option value="بورما">بورما</option>
                    <option value="ناميبيا">ناميبيا</option>
                    <option value="ناورو">ناورو</option>
                    <option value="نيبال">نيبال</option>
                    <option value="هولندا">هولندا</option>
                    <option value="نيوزيلندا">نيوزيلندا</option>
                    <option value="نيكاراجوا">نيكاراجوا</option>
                    <option value="النيجر">النيجر</option>
                    <option value="نيجيريا">نيجيريا</option>
                    <option value="كوريا الشمالية ">كوريا الشمالية</option>
                    <option value="النرويج">النرويج</option>
                    <option value="سلطنة عمان">سلطنة عمان</option>
                    <option value="باكستان">باكستان</option>
                    <option value="بالاو">بالاو</option>
                    <option value="بنما">بنما</option>
                    <option value="بابوا غينيا الجديدة">
                      بابوا غينيا الجديدة
                    </option>
                    <option value="باراغواي">باراغواي</option>
                    <option value="بيرو">بيرو</option>
                    <option value="الفلبين">الفلبين</option>
                    <option value="بولندا">بولندا</option>
                    <option value="البرتغال">البرتغال</option>
                    <option value="قطر">قطر</option>
                    <option value="جمهورية الكونغو">جمهورية الكونغو</option>
                    <option value="جمهورية مقدونيا">جمهورية مقدونيا</option>
                    <option value="رومانيا">رومانيا</option>
                    <option value="روسيا">روسيا</option>
                    <option value="رواندا">رواندا</option>
                    <option value="سانت كيتس ونيفيس">سانت كيتس ونيفيس</option>
                    <option value="سانت لوسيا">سانت لوسيا</option>
                    <option value="سانت فنسينت والجرينادينز">
                      سانت فنسينت والجرينادينز
                    </option>
                    <option value="ساموا">ساموا</option>
                    <option value="سان مارينو">سان مارينو</option>
                    <option value="ساو تومي وبرينسيب">
                      ساو تومي وبرينسيب
                    </option>
                    <option value="السنغال">السنغال</option>
                    <option value="صربيا">صربيا</option>
                    <option value="سيشيل">سيشيل</option>
                    <option value="سيراليون">سيراليون</option>
                    <option value="سنغافورة">سنغافورة</option>
                    <option value="سلوفاكيا">سلوفاكيا</option>
                    <option value="سلوفينيا">سلوفينيا</option>
                    <option value="جزر سليمان">جزر سليمان</option>
                    <option value="الصومال">الصومال</option>
                    <option value="جنوب أفريقيا">جنوب أفريقيا</option>
                    <option value="كوريا الجنوبية">كوريا الجنوبية</option>
                    <option value="جنوب السودان">جنوب السودان</option>
                    <option value="إسبانيا">إسبانيا</option>
                    <option value="سريلانكا">سريلانكا</option>
                    <option value="السودان">السودان</option>
                    <option value="سورينام">سورينام</option>
                    <option value="سوازيلاند">سوازيلاند</option>
                    <option value="السويد">السويد</option>
                    <option value="سويسرا">سويسرا</option>
                    <option value="سوريا">سوريا</option>
                    <option value="طاجيكستان">طاجيكستان</option>
                    <option value="تنزانيا">تنزانيا</option>
                    <option value="تايلاند">تايلاند</option>
                    <option value="توغو">توغو</option>
                    <option value="تونجا">تونجا</option>
                    <option value="ترينيداد وتوباغو">ترينيداد وتوباغو</option>
                    <option value="تونس">تونس</option>
                    <option value="تركيا">تركيا</option>
                    <option value="تركمانستان">تركمانستان</option>
                    <option value="توفالو">توفالو</option>
                    <option value="أوغندا">أوغندا</option>
                    <option value="أوكرانيا">أوكرانيا</option>
                    <option value="الإمارات العربية المتحدة">
                      الإمارات العربية المتحدة
                    </option>
                    <option value="المملكة المتحدة">المملكة المتحدة</option>
                    <option value="الولايات المتحدة">الولايات المتحدة</option>
                    <option value="أوروغواي">أوروغواي</option>
                    <option value="أوزبكستان">أوزبكستان</option>
                    <option value="فانواتو">فانواتو</option>
                    <option value="فنزويلا">فنزويلا</option>
                    <option value="فيتنام">فيتنام</option>
                    <option value="اليمن">اليمن</option>
                    <option value="زامبيا">زامبيا</option>
                    <option value="زيمبابوي">زيمبابوي</option>
                  </select>
                </div>
              </div>

              <hr/>

              <div class="row row-cols-md-2">
                <div class="mb-4 form-group">
                  <label
                    for="id_personalinfo_marital_status"
                    class="form-label"
                    >الحالة الاجتماعية</label
                  >
                  <select
                    name="personalinfo_marital_status"
                    class="form-control"
                    required
                    id="id_personalinfo_marital_status"
                  >
                    <option value selected>---------</option>
                    <option value="متزوج/ـة">متزوج/ـة</option>
                    <option value="أعزب/ـة">أعزب/ـة</option>
                    <option value="أرمل/ـة">أرمل/ـة</option>
                    <option value="مطلقة">مطلقة</option>
                    <option value="مهجورة">مهجورة</option>
                  </select>
                </div>
                <div class="mb-4 form-group">
                  <label
                    for="id_personalinfo_educational_level"
                    class="form-label"
                    >المؤهل العلمي</label
                  >
                  <select
                    name="personalinfo_educational_level"
                    class="form-control"
                    id="id_personalinfo_educational_level"
                  >
                    <option value="" selected>---------</option>
                    <option value="ابتدائي">ابتدائي</option>
                    <option value="متوسط">متوسط</option>
                    <option value="ثانوي">ثانوي</option>
                    <option value="جامعي">جامعي</option>
                    <option value="ماجستر">ماجستر</option>
                    <option value="دكتوراه">دكتوراه</option>
                    <option value="لا يوجد">لا يدرس</option>
                  </select>
                </div>
              </div>

              <hr />

              <div class="row row-cols-md-2">
                <div class="mb-4 form-group">
                  <label for="id_personalinfo_work_status" class="form-label"
                    >هل تعمل؟</label
                  >
                  <select
                    name="personalinfo_work_status"
                    class="form-control"
                    required
                    id="id_personalinfo_work_status"
                    onchange="workCheck(this);"
                  >
                    <option value="" selected>---------</option>
                    <option value="نعم">نعم</option>
                    <option value="لا">لا</option>
                  </select>
                </div>
                <div
                  class="mb-4 form-group"
                  id="id_personalinfo_employer_group_info"
                  style="display: none"
                >
                  <label for="id_personalinfo_employer" class="form-label"
                    >جهة العمل<span style="color: red">*</span> (عند اختيار
                    نعم)</label
                  >
                  <input
                    type="text"
                    name="personalinfo_employer"
                    maxlength="100"
                    class="form-control"
                    id="id_personalinfo_employer"
                  />
                </div>
              </div>

              <hr />

              <div class="row row-cols-md-2">
                <div class="mb-4 form-group">
                  <label for="id_personalinfo_phone_number" class="form-label"
                    >رقم التواصل<span style="color: red">*</span></label
                  >
                  <input
                    type="tel"
                    name="personalinfo_phone_number"
                    class="form-control"
                    required
                    id="id_personalinfo_phone_number"
                  />
                </div>
                <div class="mb-4 form-group">
                  <label for="id_personalinfo_email" class="form-label"
                    >البريد الالكتروني<span style="color: red">*</span></label
                  >
                  <input
                    type="email"
                    name="personalinfo_email"
                    maxlength="254"
                    class="form-control"
                    id="id_personalinfo_email"
                  />
                </div>
              </div>

            </div>
          </div>
        </div>

        <div class="mt-3">
          <button
            class="col-12 col-md-3 col-xl-2 button btn-navigate-form-step next"
            type="button"
            step_number="2"
          >
            التالي
          </button>
        </div>
      </fieldset>

        <fieldset
          id="sponsorship_information"
          class="form-step bg-light px-3 px-lg-5"
        >
          <div class="row">
            <h2 class="fs-2 fw-bold mb-5">بيانات الدعم</h2>

            <div class="alert alert-primary" role="alert">
              يمكنك اختيار المستفيدين بنفسك من خلال اختيار "اختار بنفسك"
            </div>
            <div class="row row-cols-sm-1 row-cols-md-2 row-cols-lg-2 row-cols-xl-2 mt-2">
              <div class="form-check d-flex justify-content-start gap-5 ms-4">
                <input class="form-check-input" type="radio" name="beneficiaries_choice" id="id_charity_choice" checked>
                <label class="form-check-label" for="id_charity_choice">
                  ترك الاختيار للجمعية
                </label>
              </div>
              <div class="form-check d-flex justify-content-start gap-5 ms-4 mt-2">
                <input class="form-check-input" type="radio" name="beneficiaries_choice" id="id_personal_choice">
                <label class="form-check-label" for="id_personal_choice">
                  اختار بنفسك
                </label>
              </div>
            </div>

            <div class="row" id="charity_choice_section">
              <h4 class="font-normal mb-3 mt-4">معلومات اليتيم/الأرملة</h4>
              <div class="row row-cols-lg-2">
                <div class="mb-4">
                  <label for="id_charitychoice_orphan_number" class="form-label"
                    >عدد الايتام</label
                  >
                  <input type="number" value=0 min="0" max="99" class="form-control" id="id_charitychoice_orphan_number" name="charitychoice_orphan_number" onchange="isThereOrphan(this);"/>
                </div>
                <div class="mb-4">
                  <label for="id_charitychoice_widower_number" class="form-label"
                    >عدد الارامل</label
                  >
                  <input type="number" value="0" min="0" max="99" class="form-control" id="id_charitychoice_widower_number" name="charitychoice_widower_number" onchange="isThereWidower(this);"/>
                </div>
                <div class="input-group mb-4" id="id_orphan_duration_group_info" style="display: none;">
                  <label for="id_charitychoice_orphan_donation_type" class="form-label col-12">مدة الدعم (ايتام)</label>
                  <span class="col-6 input-group-text" id="basic-addon1">
                    <input id="id_charitychoice_orphan_donation_number" type="number" value="0" min="0" max="99" class="form-control form-control-sm">
                  </span>
                  <select id="id_charitychoice_orphan_donation_type" class="col-6 form-select form-select form-select-sm" name="charitychoice_orphan_donation_type"> 
                    <option selected>اختار...</option>
                    <option value="سنة">سنة</option>
                    <option value="شهر">شهر</option>
                  </select>
                </div>
              </div>
              <div class="row row-cols-lg-2">
                <div class="input-group mb-4" id="id_widower_duration_group_info" style="display: none;">
                  <label for="id_charitychoice_widower_donation_type" class="form-label col-12">مدة الدعم (ارامل)</label>
                  <span class="col-6 input-group-text" id="basic-addon1">
                    <input id="id_charitychoice_widower_donation_number" type="number" value="0" min="0" max="99" class="form-control form-control-sm">
                  </span>
                  <select id="id_charitychoice_widower_donation_type" class="col-6 form-select form-select form-select-sm" name="charitychoice_widower_donation_type"> 
                    <option selected>اختار...</option>
                    <option value="سنة">سنة</option>
                    <option value="شهر">شهر</option>
                  </select>
                </div>
              </div>
            </div>


            <!-- Step 3 input fields -->
            <div class="" id="personal_choice_section">
              <h4 class="font-normal mb-3 mt-4">معلومات اليتيم/الأرملة</h4>

              <div class="row">
                <div class="row">
                  <div class="ageContainer mb-3 text-nowrap col">
                    <div class="row">
                      <label class="ms-2 me-0">العمر: </label>
                    </div>
                    <div class="min-value numberVal">
                      <input id="minAge" type="number" min="0" max="150" value="12" disabled>
                    </div>
                    &nbsp; - 
                    <div class="range-slider">
                      <div class="progress"></div>
                      <input type="range" class="range-min" min="0" max="150" value="12">
                      <input type="range" class="range-min" min="0" max="150" value="50">
                    </div>
                    - &nbsp;
                    <div class="max-value numberVal">
                      <input id="maxAge" type="number" min="0" max="150" value="50" disabled>
                    </div>
                  </div>
                  <div class="col">
                    <div class="row">
                      <div class="col mb-4 form-group">
                        <label for="id_sponsorship_info_nationality" class="form-label"
                          >الجنسية</label
                        >
                        <select
                          name="sponsorship_info_nationality"
                          class="form-control form-control-sm"
                          id="id_sponsorship_info_nationality"
                        >
                          <option value selected>الكل</option>
                          <option value="السعودية">السعودية</option>
                          <option value="أفغانستان">أفغانستان</option>
                          <option value="ألبانيا">ألبانيا</option>
                          <option value="الجزائر">الجزائر</option>
                          <option value="أندورا">أندورا</option>
                          <option value="أنغولا">أنغولا</option>
                          <option value="أنتيغوا وباربودا">أنتيغوا وباربودا</option>
                          <option value="الأرجنتين">الأرجنتين</option>
                          <option value="أرمينيا">أرمينيا</option>
                          <option value="أستراليا">أستراليا</option>
                          <option value="النمسا">النمسا</option>
                          <option value="أذربيجان">أذربيجان</option>
                          <option value="البهاما">البهاما</option>
                          <option value="البحرين">البحرين</option>
                          <option value="بنغلاديش">بنغلاديش</option>
                          <option value="باربادوس">باربادوس</option>
                          <option value="بيلاروسيا">بيلاروسيا</option>
                          <option value="بلجيكا">بلجيكا</option>
                          <option value="بليز">بليز</option>
                          <option value="بنين">بنين</option>
                          <option value="بوتان">بوتان</option>
                          <option value="بوليفيا">بوليفيا</option>
                          <option value="البوسنة والهرسك ">البوسنة والهرسك</option>
                          <option value="بوتسوانا">بوتسوانا</option>
                          <option value="البرازيل">البرازيل</option>
                          <option value="بروناي">بروناي</option>
                          <option value="بلغاريا">بلغاريا</option>
                          <option value="بوركينا فاسو ">بوركينا فاسو</option>
                          <option value="بوروندي">بوروندي</option>
                          <option value="كمبوديا">كمبوديا</option>
                          <option value="الكاميرون">الكاميرون</option>
                          <option value="كندا">كندا</option>
                          <option value="الرأس الأخضر">الرأس الأخضر</option>
                          <option value="جمهورية أفريقيا الوسطى ">
                            جمهورية أفريقيا الوسطى
                          </option>
                          <option value="تشاد">تشاد</option>
                          <option value="تشيلي">تشيلي</option>
                          <option value="الصين">الصين</option>
                          <option value="كولومبيا">كولومبيا</option>
                          <option value="جزر القمر">جزر القمر</option>
                          <option value="كوستاريكا">كوستاريكا</option>
                          <option value="ساحل العاج">ساحل العاج</option>
                          <option value="كرواتيا">كرواتيا</option>
                          <option value="كوبا">كوبا</option>
                          <option value="قبرص">قبرص</option>
                          <option value="التشيك">التشيك</option>
                          <option value="جمهورية الكونغو الديمقراطية">
                            جمهورية الكونغو الديمقراطية
                          </option>
                          <option value="الدنمارك">الدنمارك</option>
                          <option value="جيبوتي">جيبوتي</option>
                          <option value="دومينيكا">دومينيكا</option>
                          <option value="جمهورية الدومينيكان">
                            جمهورية الدومينيكان
                          </option>
                          <option value="تيمور الشرقية ">تيمور الشرقية</option>
                          <option value="الإكوادور">الإكوادور</option>
                          <option value="مصر">مصر</option>
                          <option value="السلفادور">السلفادور</option>
                          <option value="غينيا الاستوائية">غينيا الاستوائية</option>
                          <option value="إريتريا">إريتريا</option>
                          <option value="إستونيا">إستونيا</option>
                          <option value="إثيوبيا">إثيوبيا</option>
                          <option value="فيجي">فيجي</option>
                          <option value="فنلندا">فنلندا</option>
                          <option value="فرنسا">فرنسا</option>
                          <option value="الغابون">الغابون</option>
                          <option value="غامبيا">غامبيا</option>
                          <option value="جورجيا">جورجيا</option>
                          <option value="ألمانيا">ألمانيا</option>
                          <option value="غانا">غانا</option>
                          <option value="اليونان">اليونان</option>
                          <option value="جرينادا">جرينادا</option>
                          <option value="غواتيمالا">غواتيمالا</option>
                          <option value="غينيا">غينيا</option>
                          <option value="غينيا بيساو">غينيا بيساو</option>
                          <option value="غويانا">غويانا</option>
                          <option value="هايتي">هايتي</option>
                          <option value="هندوراس">هندوراس</option>
                          <option value="المجر">المجر</option>
                          <option value="آيسلندا">آيسلندا</option>
                          <option value="الهند">الهند</option>
                          <option value="إندونيسيا">إندونيسيا</option>
                          <option value="إيران">إيران</option>
                          <option value="العراق">العراق</option>
                          <option value="جمهورية أيرلندا ">جمهورية أيرلندا</option>
                          <option value="فلسطين">فلسطين</option>
                          <option value="إيطاليا">إيطاليا</option>
                          <option value="جامايكا">جامايكا</option>
                          <option value="اليابان">اليابان</option>
                          <option value="الأردن">الأردن</option>
                          <option value="كازاخستان">كازاخستان</option>
                          <option value="كينيا">كينيا</option>
                          <option value="كيريباتي">كيريباتي</option>
                          <option value="الكويت">الكويت</option>
                          <option value="قرغيزستان">قرغيزستان</option>
                          <option value="لاوس">لاوس</option>
                          <option value="لاوس">لاوس</option>
                          <option value="لاتفيا">لاتفيا</option>
                          <option value="لبنان">لبنان</option>
                          <option value="ليسوتو">ليسوتو</option>
                          <option value="ليبيريا">ليبيريا</option>
                          <option value="ليبيا">ليبيا</option>
                          <option value="ليختنشتاين">ليختنشتاين</option>
                          <option value="ليتوانيا">ليتوانيا</option>
                          <option value="لوكسمبورغ">لوكسمبورغ</option>
                          <option value="مدغشقر">مدغشقر</option>
                          <option value="مالاوي">مالاوي</option>
                          <option value="ماليزيا">ماليزيا</option>
                          <option value="جزر المالديف">جزر المالديف</option>
                          <option value="مالي">مالي</option>
                          <option value="مالطا">مالطا</option>
                          <option value="جزر مارشال">جزر مارشال</option>
                          <option value="موريتانيا">موريتانيا</option>
                          <option value="موريشيوس">موريشيوس</option>
                          <option value="المكسيك">المكسيك</option>
                          <option value="مايكرونيزيا">مايكرونيزيا</option>
                          <option value="مولدوفا">مولدوفا</option>
                          <option value="موناكو">موناكو</option>
                          <option value="منغوليا">منغوليا</option>
                          <option value="الجبل الأسود">الجبل الأسود</option>
                          <option value="المغرب">المغرب</option>
                          <option value="موزمبيق">موزمبيق</option>
                          <option value="بورما">بورما</option>
                          <option value="ناميبيا">ناميبيا</option>
                          <option value="ناورو">ناورو</option>
                          <option value="نيبال">نيبال</option>
                          <option value="هولندا">هولندا</option>
                          <option value="نيوزيلندا">نيوزيلندا</option>
                          <option value="نيكاراجوا">نيكاراجوا</option>
                          <option value="النيجر">النيجر</option>
                          <option value="نيجيريا">نيجيريا</option>
                          <option value="كوريا الشمالية ">كوريا الشمالية</option>
                          <option value="النرويج">النرويج</option>
                          <option value="سلطنة عمان">سلطنة عمان</option>
                          <option value="باكستان">باكستان</option>
                          <option value="بالاو">بالاو</option>
                          <option value="بنما">بنما</option>
                          <option value="بابوا غينيا الجديدة">
                            بابوا غينيا الجديدة
                          </option>
                          <option value="باراغواي">باراغواي</option>
                          <option value="بيرو">بيرو</option>
                          <option value="الفلبين">الفلبين</option>
                          <option value="بولندا">بولندا</option>
                          <option value="البرتغال">البرتغال</option>
                          <option value="قطر">قطر</option>
                          <option value="جمهورية الكونغو">جمهورية الكونغو</option>
                          <option value="جمهورية مقدونيا">جمهورية مقدونيا</option>
                          <option value="رومانيا">رومانيا</option>
                          <option value="روسيا">روسيا</option>
                          <option value="رواندا">رواندا</option>
                          <option value="سانت كيتس ونيفيس">سانت كيتس ونيفيس</option>
                          <option value="سانت لوسيا">سانت لوسيا</option>
                          <option value="سانت فنسينت والجرينادينز">
                            سانت فنسينت والجرينادينز
                          </option>
                          <option value="ساموا">ساموا</option>
                          <option value="سان مارينو">سان مارينو</option>
                          <option value="ساو تومي وبرينسيب">
                            ساو تومي وبرينسيب
                          </option>
                          <option value="السنغال">السنغال</option>
                          <option value="صربيا">صربيا</option>
                          <option value="سيشيل">سيشيل</option>
                          <option value="سيراليون">سيراليون</option>
                          <option value="سنغافورة">سنغافورة</option>
                          <option value="سلوفاكيا">سلوفاكيا</option>
                          <option value="سلوفينيا">سلوفينيا</option>
                          <option value="جزر سليمان">جزر سليمان</option>
                          <option value="الصومال">الصومال</option>
                          <option value="جنوب أفريقيا">جنوب أفريقيا</option>
                          <option value="كوريا الجنوبية">كوريا الجنوبية</option>
                          <option value="جنوب السودان">جنوب السودان</option>
                          <option value="إسبانيا">إسبانيا</option>
                          <option value="سريلانكا">سريلانكا</option>
                          <option value="السودان">السودان</option>
                          <option value="سورينام">سورينام</option>
                          <option value="سوازيلاند">سوازيلاند</option>
                          <option value="السويد">السويد</option>
                          <option value="سويسرا">سويسرا</option>
                          <option value="سوريا">سوريا</option>
                          <option value="طاجيكستان">طاجيكستان</option>
                          <option value="تنزانيا">تنزانيا</option>
                          <option value="تايلاند">تايلاند</option>
                          <option value="توغو">توغو</option>
                          <option value="تونجا">تونجا</option>
                          <option value="ترينيداد وتوباغو">ترينيداد وتوباغو</option>
                          <option value="تونس">تونس</option>
                          <option value="تركيا">تركيا</option>
                          <option value="تركمانستان">تركمانستان</option>
                          <option value="توفالو">توفالو</option>
                          <option value="أوغندا">أوغندا</option>
                          <option value="أوكرانيا">أوكرانيا</option>
                          <option value="الإمارات العربية المتحدة">
                            الإمارات العربية المتحدة
                          </option>
                          <option value="المملكة المتحدة">المملكة المتحدة</option>
                          <option value="الولايات المتحدة">الولايات المتحدة</option>
                          <option value="أوروغواي">أوروغواي</option>
                          <option value="أوزبكستان">أوزبكستان</option>
                          <option value="فانواتو">فانواتو</option>
                          <option value="فنزويلا">فنزويلا</option>
                          <option value="فيتنام">فيتنام</option>
                          <option value="اليمن">اليمن</option>
                          <option value="زامبيا">زامبيا</option>
                          <option value="زيمبابوي">زيمبابوي</option>
                        </select>
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col mb-4 form-group">
                      <label for="id_sponsorship_info_health_status" class="form-label"
                        >الحالة الصحية</label
                      >
                      <select
                        name="sponsorship_info_health_status"
                        class="form-control form-control-sm"
                        id="id_sponsorship_info_health_status"
                      >
                        <option value selected>الكل</option>
                        <option value="غير جيدة">غير جيدة</option>
                        <option value="جيدة">جيدة</option>
                      </select>
                    </div>
                    <div class="col mb-4 form-group">
                      <label for="id_sponsorship_info_gender" class="form-label"
                        >الجنس</label
                      >
                      <select
                        name="sponsorship_info_gender"
                        class="form-control form-control-sm"
                        id="id_sponsorship_info_gender"
                      >
                        <option value selected>الكل</option>
                        <option value="ذكر">ذكر</option>
                        <option value="انثى">انثى</option>
                      </select>
                    </div>
                  </div>
                  <hr>
                </div>
                
                <table id="beneficiaries_table" class="table table-striped table-hover table-bordered text-nowrap">
                  <thead>
                    <tr>
                      <th>اختار</th>
                      {% for header in beneficiary_headers %}
                        <th scope="col" class="col">{{ header }}</th>
                      {% endfor %}
                    </tr> 
                  </thead>
                  <tbody>
                    {% for data in beneficiary_data %}
                      <tr>
                        <td><div class="form-check d-flex justify-content-center">
                          <input class="form-check-input" type="checkbox" value="" id="id_beneficiary_check{{data.id}}">
                        </div></td>
                        <th class="col">{{ data.id }}</th>
                        <td class="col">{{ data.gender }}</td>
                        <td class="col">{{ data.in_ex_diff }}</td>
                        <td class="col">{{ data.health_status }}</td>
                        <td class="col">{{ data.age }}</td>
                        <td class="col">{{ data.nationality }}</td>
                      </tr>
                    {% endfor %} 
                  </tbody>
                </table>
              </div>

              <hr>

              <div class="row row-cols-sm-1 row-cols-md-2 row-cols-lg-2 row-cols-xl-2 mt-2">
                <div class="mb-4 form-group">
                  <label for="id_sponsorship_info_duration" class="form-label"
                    >مدة الدعم<span style="color: red"
                    >*</span
                  ></label
                  >
                  <select
                    name="sponsorship_info_duration"
                    class="form-control"
                    id="id_sponsorship_info_duration"
                  >
                    <option value selected>---------</option>
                    <option value="3 أشهر">3 أشهر</option>
                    <option value="6 أشهر">6 أشهر</option>
                    <option value="سنة كاملة">سنة كاملة</option>
                  </select>
                </div>
                <div class="mb-4 form-group">
                  <label for="id_sponsorship_info_donation_type" class="form-label"
                    >نوع الدعم<span style="color: red"
                    >*</span
                  ></label
                  >
                  <select
                    name="sponsorship_info_donation_type"
                    class="form-control"
                    id="id_sponsorship_info_donation_type"
                  >
                    <option value selected>---------</option>
                    <option value="مبلغ مقطوع (مقيد)">مبلغ مقطوع (مقيد)</option>
                    <option value="مبلغ مقطوع (غير مقيد)">مبلغ مقطوع (غير مقيد)</option>
                    <option value="كفالة أسرة">كفالة أسرة</option>
                    <option value="كفالة يتيم">كفالة يتيم</option>
                    <option value="كفالة أرملة">كفالة أرملة</option>
                  </select>
                </div>
              </div>
            </div>

            <hr class="mb-4 mt-2">

            <div class="row row-cols-1 row-cols-sm-1 row-cols-md-2 me-sm-0 ms-sm-3 me-1 ms-3">
              <div class="col mb-4 form-check form-switch">
                <label 
                  class="form-check-label" 
                  for="id_sponsorship_info_was_sponsor_check"
                >
                هل سبق أن كفلت يتيم أو أرملة في وقت سابق أو حالي؟
                </label>
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  role="switch" 
                  name="sponsorship_info_was_sponsor_check" 
                  id="id_sponsorship_info_was_sponsor_check"
                >
              </div>
              <div class="col mb-4 form-check form-switch">
                <label 
                  class="form-check-label ms-md-3" 
                  for="id_sponsorship_info_status_notify_check"
                >
                هل ترغب بتقرير عن اليتيم / الأرملة؟
                </label>
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  role="switch" 
                  name="sponsorship_info_status_notify_check" 
                  id="id_sponsorship_info_status_notify_check"
                >
              </div>
              <div class="col mb-4 form-check form-switch">
                <label 
                  class="form-check-label" 
                  for="id_sponsorship_info_invite_beneficiary_check"
                >
                هل ترغب بإشراك اليتيم في مناسباتكم العائلية؟
                </label>
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  role="switch" 
                  name="sponsorship_info_invite_beneficiary_check" 
                  id="id_sponsorship_info_invite_beneficiary_check"
                >
              </div>
              <div class="col mb-4 form-check form-switch">
                <label 
                  class="form-check-label ms-md-3" 
                  for="id_sponsorship_info_visit_beneficiary_check"
                >
                هل ترغب بزيارة لأسرة اليتيم / الأرملة؟
                </label>
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  role="switch" 
                  name="sponsorship_info_visit_beneficiary_check" 
                  id="id_sponsorship_info_visit_beneficiary_check"
                >
              </div>
            </div>
            <div class="mt-3 row row-cols-1 row-cols-sm-1 row-cols-md-2 row-cols-xl-2">
              <div class="mt-3 d-flex column-gap-2">
                <div class="col-6">
                  <button
                    class="col-12 button btn-navigate-form-step previous"
                    type="button"
                    step_number="1"
                  >
                    السابق
                  </button>
                </div>
                <div class="col-6">
                <button
                  class="col-12 button btn-navigate-form-step next next-table"
                  type="button"
                  step_number="3"
                >
                  التالي
                </button>
                </div>
              </div>
              <div class="order-first order-md-last">
                <div class="input-group mt-4">
                  <span class="input-group-text" id="id_basic_addon2">الإجمالي: </span>
                  <input class="form-control" id="id_sponsorship_info_total_price_2" name="sponsorship_info_total_price_2" type="number"  step="0.01" min="0" max="9999999999" value="0.00" disabled>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <fieldset id="payment_and_submit_confirmation" class="form-step bg-light px-3 px-lg-5">
          <h2 class="fs-2 fw-bold mb-5">تقديم الطلب</h2>
          <!-- Step 5 input fields -->
          <div class="mt-3">
            
            <div class="row mt-5 justify-content-start column-gap-4">
              <div class="alert alert-warning" role="alert" id="checkboxError">
                يرجى إرفاق صورة من مرفق الحوالة لقبول الطلب.
              </div>
              <div class="col-12 col-md-8 col-lg-6 col-xl-5">
                <div class="input-group mt-2 mb-4">
                  <span class="input-group-text" id="id_basic_addon1">الإجمالي: </span>
                  <input class="form-control" id="id_sponsorship_info_total_price_1" name="sponsorship_info_total_price_1" type="number"  step="0.01" min="0" max="9999999999" value="0.00" disabled>
                </div>
              </div>
              <div
              class="col-12 col-md-9 col-lg-6 col-xl-5 mb-4 row column-gap-4"
              id="id_attachmentSocialWarrantyInquiry_group_info"
              >
              <div class="col d-flex flex-column">
                <label class="form-label" id="id_bank_transfer"
                  >صورة إيصال الحوالة البنكية<span style="color: red">*</span></label
                >
                <div
                  class="col text-muted"
                  id="id_file_names_bank_transfer"
                ></div>
                <!--- Place of showing file names -->
              </div>
              <div class="col-4 d-flex justify-content-center">
                <label
                  class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                  for="id_form_file_bank_transfer"
                  >إرفاق ملفات</label
                >
              </div>
                <input
                  class="form-control d-none"
                  type="file"
                  id="id_form_file_bank_transfer"
                  name="file_bank_transfer"
                  multiple
                />
              </div>
            </div>
            <h3 class="fs-3 fw-bold mb-3 mt-5">الحسابات البنكية</h3>
            <div class="row row-cols-1 row-cols-md-3 g-4">
              <div class="col">
                <div class="card h-100">
                  <img src="{% static 'imgs/snb.jpg' %}" class="card-img-top" alt="Saudi National Bank">
                  <div class="card-body">
                    <h5 class="card-title">البنك الأهلي السعودي (SNB)</h5>
                    <p class="card-text" ><strong>رقم الإيبان:</strong><p class="" id="id_user_select_all_snb" value="SA4210000012254451000110">SA42 100 0001 225 445 100 0110</p>
                    </p>
                  </div>
                  <div class="card-footer">
                    <button class="btn btn-primary col-12" onclick="copyToClipboard('id_user_select_all_snb');">نسخ الإيبان</button>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="card h-100">
                  <img src="{% static 'imgs/alrajhibank.png' %}" class="card-img-top h-50" alt="Al Rajhi Bank">
                  <div class="card-body">
                    <h5 class="card-title">بنك الراجحي</h5>
                    <p class="card-text" ><strong>رقم الإيبان:</strong><p class="" id="id_user_select_all_alrajhibank" value="SA59800003766608010409999">SA59 800 003 766 608 010 409 999</p>
                    </p>
                  </div>
                  <div class="card-footer">
                    <button class="btn btn-primary col-12" onclick="copyToClipboard('id_user_select_all_alrajhibank');">نسخ الإيبان</button>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="card h-100">
                  <img src="{% static 'imgs/البلاد.png' %}" class="card-img-top" alt="Al inma Bank">
                  <div class="card-body">
                    <h5 class="card-title">بنك البلاد</h5>
                    <p class="card-text" ><strong>رقم الإيبان:</strong><p class="" id="id_user_select_all_alinmabank" value="SA0615000999131809850004">SA06 150 009 991 318 098 500 04</p>
                    </p>
                  </div>
                  <div class="card-footer justify-content-center">
                    <button class="btn btn-primary col-12" onclick="copyToClipboard('id_user_select_all_alinmabank');">نسخ الإيبان</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <hr>
          <div class="mt-3 row row-cols-1 row-cols-sm-1 row-cols-md-2 row-cols-xl-2">
            <div class="mt-3 d-flex column-gap-2">
              <div class="col-6">
                <button
                  class="col-12 button btn-navigate-form-step previous"
                  type="button"
                  step_number="2"
                >
                  السابق
                </button>
              </div>
              <div class="col-6">
                <button
                  class="col-12 button submit-btn next"
                  id="submit-btn"
                  type="submit"
                >
                  تقديم الطلب
                </button>
              </div>
            </div>
            <div class="order-first order-md-last text-right align-self-center">
              <small class="text-danger">يرجى التأكد من جميع المعلومات قبل تقديم الطلب!</small>
            </div>
          </div>
        </fieldset>
    </form>
  </div>
</div>

<script>
  $(document).ready(function () {

    const banks = [
      {
        samaCode: "55",
        bankName: "Banque Saudi Fransi",
        nameEn: "Banque Saudi Fransi",
        nameAr: "السعودي الفرنسي",
      },
      {
        name: "Alrajhi Bank",
        samaCode: "80",
        nameEn: "Alrajhi Bank",
        nameAr: "الراجحي",
      },
      {
        samaCode: "10",
        bankName: "National Commercial Bank",
        nameEn: "National Commertial Bank",
        nameAr: "الأهلي السعودي",
      },
      {
        samaCode: "45",
        bankName: "Saudi British Bank",
        nameEn: "SABB",
        nameAr: "ساب",
      },
      {
        samaCode: "20",
        bankName: "Riyadh Bank",
        nameEn: "Riyad Bank",
        nameAr: "الرياض",
      },
      {
        samaCode: "05",
        bankName: "Alinma Bank",
        nameEn: "AL Inma Bank",
        nameAr: "الإنماء",
      },
      {
        samaCode: "60",
        bankName: "Bank AlJazira",
        nameEn: "Bank Aljazerah",
        nameAr: "الجزيرة",
      },
      {
        samaCode: "15",
        bankName: "Bank AlBilad ",
        nameEn: "BANK ALBELAD",
        nameAr: "البلاد",
      },
      {
        samaCode: "30",
        bankName: "Arab National Bank",
        nameEn: "Arab National Bank",
        nameAr: "العربي",
      },
    ];

    /**
     * validates IBAN
     * @return {boolean}
     */
    function validateIBAN(iban) {
      if (!iban) {
        return false;
      }

      iban = iban.trim();

      if (iban.length !== 24) {
        return false;
      }

      if (!iban.startsWith("SA")) {
        return false;
      }

      const bankCode = iban.substring(4, 6);

      return banks.some((b) => b.samaCode === bankCode);
    }

    /**
     * Returns the bank object
     * @return {Object}
     */
    function getBankByIBAN(iban) {
      if (!validateIBAN(iban)) return null;

      const bankCode = iban.substring(4, 6);
      const bank = banks.find((b) => b.samaCode === bankCode);
      return bank ? bank.nameAr : null;
    }

    $("#id_beneficiaryinfo_iban").on("input", function () {
      var iban = $(this).val();
      var bankNameAr = getBankByIBAN(iban);

      if (bankNameAr) {
        $("#id_beneficiaryinfo_bank").val(bankNameAr).change();
      } else {
        $("#id_beneficiaryinfo_bank").val("").change(); // Reset to default if IBAN is invalid
      }
    });

    /**
     * Mark all form steps as unfinished.
     */
    document
      .querySelectorAll(".form-stepper-list")
      .forEach((formStepHeader) => {
        formStepHeader.classList.add("form-stepper-unfinished");
        formStepHeader.classList.remove(
          "form-stepper-active",
          "form-stepper-completed"
        );
      });
    let stepNumber = 1;
    /**
     * Select the form step circle (progress bar).
     */
    const formStepCircle = document.querySelector(
      'li[step="' + stepNumber + '"]'
    );

    /**
     * Mark the current form step as active.
     */
    formStepCircle.classList.remove(
      "form-stepper-unfinished",
      "form-stepper-completed"
    );
    formStepCircle.classList.add("form-stepper-active");

    
    // Validator method for first, second, and last name fields in the form
    $.validator.addMethod(
      "nameRegex",
      function (value, element) {
        return (
          this.optional(element) || /^[a-zA-Z0-9\u0621-\u064A]*$/i.test(value)
        );
      },
      "يحتوي الأسم على حروف فقط."
    );

    $.validator.addMethod(
      "fullNameRegex",
      function (value, element) {
        return (
          this.optional(element) ||
          /^[a-zA-Z\u0621-\u064A]+([ '-][a-zA-Z\u0621-\u064A]+)*$/i.test(value)
        );
      },
      "يجب أن يتكون الاسم الكامل من الاسم الأول والأوسط والأخير."
    );

    // Validate Saudi Arabia IDs (Iqama/Saudi Natioanl Id)
    function validateSAID(id) {
      let type = id.substr(0, 1);
      let sum = 0;
      const _idLength = 10;
      const _type1 = "1";
      const _type2 = "2";
      id = id.trim();
      if (
        isNaN(parseInt(id)) ||
        id.length !== _idLength ||
        (type !== _type2 && type !== _type1)
      ) {
        return false;
      }
      for (let num = 0; num < 10; num++) {
        const digit = Number(id[num]);
        if (num % 2 === 0) {
          const doubled = digit * 2;
          const ZFOdd = `00${doubled}`.slice(-2);
          sum += Number(ZFOdd[0]) + Number(ZFOdd[1]);
        } else {
          sum += digit;
        }
      }
      return sum % 10 !== 0 ? false : true;
    }

    // Validator method for the national id (Iqama/Saudi)
    $.validator.addMethod(
      "nationalidRegex",
      function (value, element) {
        // console.log(value, validateSAID(value));
        return this.optional(element) || validateSAID(value);
      },
      "أدخل رقم هوية/إقامة صحيح."
    );

    // Validator method for the phone number [Saudi Arabia Only]
    $.validator.addMethod(
      "saudiPhoneRegex",
      function (value, element) {
        return (
          this.optional(element) || /^(?:\+966\s?5\d{8}|05\d{8})$/i.test(value)
        );
      },
      "الرجاء إدخال رقم جوال صحيح في المملكة العربية السعودية."
    );

    // Email address validator
    $.validator.addMethod(
      "emailRegex",
      function (value, element) {
        return (
          this.optional(element) ||
          /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(value)
        );
      },
      "الرجاء إدخال بريد إلكتروني صحيح."
    );

    // The below code will change the default validation messages
    $.extend($.validator.messages, {
      required: "هذا الحقل مطلوب.",
      remote: "الرجاء اصلاح هذا الحقل.",
      email: "الرجاء إدخال بريد الكتروني صالح.",
      url: "الرجاء إدخال رابط صحيح وفعال.",
      date: "الرجاء إدخال تاريخ صالح.",
      dateISO: "الرجاء إدخال تاريخ صحيح (بصيغة ISO).",
      number: "الرجاء إدخال رقم صحيح.",
      digits: "الرجاء إدخال أرقام فقط.",
      creditcard: "الرجاء إدخال رقم بطاقة ائتمان صالحة.",
      equalTo: "رجاء أدخل نفس القيمة مره أخرى.",
      accept: "الرجاء إدخال قيمة بإمتداد صحيح.",
      maxlength: $.validator.format("الرجاء عدم إدخال أكثر من {0} أحرف."),
      minlength: $.validator.format("الرجاء إدخال على الأقل {0} حروف."),
      rangelength: $.validator.format(
        "الرجاء إدخال قيمة طولها يكون من {0} إلى {1} أحرف."
      ),
      range: $.validator.format("الرجاء إدخال رقم بين {0} و {1}."),
      max: $.validator.format(" الرجاء إدخال قيمة أقل من أو تساوي {0}."),
      min: $.validator.format("الرجاء إدخال قيمة أعلى من أو تساوي {0}."),
    });

    // When ".next" button is clicked, the following function is executed
    $(".next").click(function () {
      var form = $("#supporter_form");
      form.validate({
        errorElement: "span",
        errorClass: "help-block invalid-feedback",
        highlight: function (element, errorClass, validClass) {
          $(element).closest(".form-group").addClass("has-error");
          //$(element).fadeOut(function() {
          //  $(element).fadeIn();
          //  });
        },
        unhighlight: function (element, errorClass, validClass) {
          $(element).closest(".form-group").removeClass("has-error");
        },
        errorPlacement: function (error, element) {
          // Check if the element is inside an input-group
          if (element.parent(".input-group").length) {
            // Place the error after the input-group
            error.insertAfter(element.parent(".input-group"));
          } else {
            // Default placement for other elements
            error.insertAfter(element);
          }
        },
        focusInvalid: true,

        // Adding the rules (validations) for each input in the form.
        rules: {
          personalinfo_first_name: {
            required: false,
            nameRegex: true,
            minlength: 2,
            maxlength: 20,
          },
          personalinfo_second_name: {
            required: false,
            nameRegex: true,
            minlength: 2,
            maxlength: 20,
          },
          personalinfo_last_name: {
            required: false,
            nameRegex: true,
            minlength: 2,
            maxlength: 20,
          },
          personalinfo_date_of_birth: {
            required: false,
            dateISO: true,
          },
          personalinfo_gender: {
            required: false,
          },
          personalinfo_national_id: {
            required: false,
            nationalidRegex: true,
          },
          personalinfo_national_id_exp_date: {
            required: false,
            dateISO: true,
          },
          personalinfo_nationality: {
            required: false,
            maxlength: 30,
          },
          personalinfo_marital_status: {
            required: false,
          },
          personalinfo_educational_level: {
            required: false,
          },
          personalinfo_work_status: {
            required: false,
          },
          personalinfo_employer: {
            required: false,
          },
          personalinfo_phone_number: {
            required: false,
            saudiPhoneRegex: true,
          },
          personalinfo_email: {
            //emailRegex: true,
          },
        },
        messages: {
          personalinfo_first_name: {
            required: "هذا الحقل مطلوب.",
          },
        },
      });

      // In case of a valid form inputs, ".next" button will show the next step in the form
      if (form.valid() === true) {
        if ($("#personal_information").is(":visible")) {
          current_fs = $("#personal_information");
          next_fs = $("#sponsorship_information"); // Proceed to the third stepas usual

        } else if ($("#sponsorship_information").is(":visible")) {
          current_fs = $("#sponsorship_information");
          next_fs = $("#payment_and_submit_confirmation");
        }

        next_fs.show();
        current_fs.hide();
      }
    });

    // When ".previous" button is clicked, the following function is called
    $(".previous").click(function () {
      if ($("#sponsorship_information").is(":visible")) {
        current_fs = $("#sponsorship_information");
        next_fs = $("#personal_information"); 
      } else if ($("#payment_and_submit_confirmation").is(":visible")) {
        current_fs = $("#payment_and_submit_confirmation");
        next_fs = $("#sponsorship_information");
      }

      next_fs.show();
      current_fs.hide();
    });

    // Call updateFormStep if one of the selected elements is clicked
    $(".next, .previous").click(function () {
      updateFormStep();
    });

    function updateFormStep() {
      // Check which div is visible and update form steps accordingly
      if ($("#personal_information").is(":visible")) {
        updateSteps(1);;
      } else if ($("#sponsorship_information").is(":visible")) {
        updateSteps(2);
      } else if ($("#payment_and_submit_confirmation").is(":visible")) {
        updateSteps(3);
      }
    }

    // Update the class names based on the currentStep
    function updateSteps(currentStep) {
      // Reset all steps
      $(".form-stepper-list")
        .removeClass("form-stepper-active form-stepper-completed")
        .addClass("form-stepper-unfinished");

      // Activate and complete relevant steps
      for (let step = 1; step <= currentStep; step++) {
        $(`li[step="${step}"]`)
          .removeClass("form-stepper-unfinished")
          .addClass(
            step === currentStep
              ? "form-stepper-active"
              : "form-stepper-completed"
          );
      }
    }

  }); // (document).ready() end line

  var table = $('#beneficiaries_table').DataTable({
    'language': {
      url: "{% static '/Arabic.json' %}"
    },
    'columnDefs': [
        {
            'targets': 0, // Targeting the first column (checkbox column)
            'checkboxes': {
                'selectRow': true
            }
        }
    ],
    'select': {
        'style': 'multi'
    }
  });

  // JS for age range input with MIN-MAX
  const range = document.querySelectorAll('.range-slider input');
  progress = document.querySelector('.range-slider .progress');
  let gap = 0;
  const inputValue = document.querySelectorAll('.numberVal input');

  range.forEach(input => {
    input.addEventListener('input', e =>{
      let minrange = parseInt(range[0].value),
      maxrange = parseInt(range[1].value);

      if (maxrange - minrange < gap) {
        if (e.target.className === "range-min"){
          range[0].value = maxrange - gap;
        }
        else {
          range[1].value = minrange + gap;
        }
      }
      else {
        progress.style.right = ((minrange / range[0].max) * 100)+ 1 + '%';
        progress.style.left = (100 - (maxrange / range[1].max) * 100) - 1 + '%';
        inputValue[0].value = minrange;
        inputValue[1].value = maxrange;
      }

      // Changes to the inputs will trigger a redraw to update the table
      // Trigger a redraw of the DataTable
      table.draw();

      console.log(inputValue[0].value, inputValue[1].value);
    })
  })
  
  // Custom range filtering function
  DataTable.ext.search.push(function (settings, data, dataIndex) {
      let min = parseInt(inputValue[0].value, 10);
      let max = parseInt(inputValue[1].value, 10);
      let age = parseFloat(data[5]) || 0; // use data for the age column
  
      if (
          (isNaN(min) && isNaN(max)) ||
          (isNaN(min) && age <= max) ||
          (min <= age && isNaN(max)) ||
          (min <= age && age <= max)
      ) {
          return true;
      }
  
      return false;
  });

  // Variables for gender and nationality form-input
  const genderEl = document.querySelector('#id_sponsorship_info_gender');
  const nationalityEl = document.querySelector('#id_sponsorship_info_nationality');
  const healthStatusEl = document.querySelector('#id_sponsorship_info_health_status');
  
  // Custom range filtering function
  DataTable.ext.search.push(function (settings, data, dataIndex) {
      let nationality = (data[6]) || 0; // use data for the age column
  
      if (nationalityEl.value === '' || nationality === nationalityEl.value) {
          return true;
      }
      
      return false;

  });

  nationalityEl.addEventListener('change', function () {
    table.draw();
  });

  // Custom range filtering function
  DataTable.ext.search.push(function (settings, data, dataIndex) {
    let gender = (data[2]) || 0; // use data for the age column

    if (genderEl.value === '' || gender === genderEl.value) {
        return true;
    }
    
    return false;

  });

  genderEl.addEventListener('change', function () {
    table.draw();
  });



  // Event delegation to handle checkbox clicks
  $('#beneficiaries_table tbody').on('click', 'input[type="checkbox"]', function() {
    var row = $(this).closest('tr');
    if ($(this).prop('checked')) {
        row.addClass('selected');
    } else {
        row.removeClass('selected');
    }
  });

  // Event delegation to handle row clicks
  $('#beneficiaries_table tbody').on('click', 'tr', function() {
    var checkbox = $(this).find('input[type="checkbox"]');
    checkbox.prop('checked', !checkbox.prop('checked')); // Toggle checkbox state
    table.row(this).select(!checkbox.prop('checked')); // Toggle row selection based on checkbox state
    $(this).toggleClass('selected'); // Toggle selected class for the row
  });

  // Remove checkbox click event to prevent conflicts
  $('#beneficiaries_table tbody').on('click', 'input[type="checkbox"]', function(e) {
    e.stopPropagation(); // Prevent the row click event from firing
  });

  // Make the row selected whenever it is clicked
  table.on('click', 'tbody tr', function (e) {
    e.currentTarget.classList.toggle('selected');
  });
  
  // Print an array of the selected rows
  document.querySelector('.next-table').addEventListener('click', function () {
      var selectedRows = table.rows('.selected').data().toArray();
      console.log(selectedRows);
  });

  // Custom range filtering function
  DataTable.ext.search.push(function (settings, data, dataIndex) {
    let health_status = (data[4]) || 0; // use data for the age column

    if (healthStatusEl.value === '' || health_status === healthStatusEl.value) {
        return true;
    }
    
    return false;

  });

  healthStatusEl.addEventListener('change', function () {
    table.draw();
  });

  // JS to change the step 2 content based on user choice
  document.addEventListener('DOMContentLoaded', function () {
    const charityChoiceRadio = document.getElementById('id_charity_choice');
    const personalChoiceRadio = document.getElementById('id_personal_choice');
    const personalChoiceSection = document.getElementById('personal_choice_section');
    const charityChoiceSection = document.getElementById('charity_choice_section');

    // Initial check for default radio state
    if (charityChoiceRadio.checked) {
        personalChoiceSection.style.display = 'none';
        charityChoiceSection.style.display = 'block';
    }

    // Event listener for radio button change
    charityChoiceRadio.addEventListener('change', function () {
        personalChoiceSection.style.display = 'none';
        charityChoiceSection.style.display = 'block';
    });

    personalChoiceRadio.addEventListener('change', function () {
        personalChoiceSection.style.display = 'block';
        charityChoiceSection.style.display = 'none';
    });
  });

  // Function (triggered on click) to copy text into Clipboard
  const copyToClipboard = async (elementId) => {
    event.preventDefault();
    try {
      const element = document.getElementById(elementId);
      const valueToCopy = element.getAttribute('value');
      await navigator.clipboard.writeText(valueToCopy);
      alert("تم نسخ رقم الإيبان!");
      // Optional: Display a success message to the user
    } catch (error) {
      alert("حصل خطأ اثناء نسخ رقم الإيبان:", error);
      // Optional: Display an error message to the user
    }
  };

  // Add an event listener to the form to prevent submission on Enter key press (or copy to clipboard)
  document.getElementById('supporter_form').addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
      e.preventDefault();
    }
  });

  // Function to update the names of the uploaded files for each file input
  function updateFileNamesDisplay(fileInputId, fileNamesDivId) {
    var fileInput = document.getElementById(fileInputId);
    var fileNamesDiv = document.getElementById(fileNamesDivId);

    // Initialize with a message indicating no file is uploaded
    fileNamesDiv.innerHTML = "[لم يتم إرفاق أي ملفات]";

    fileInput.addEventListener("change", function () {
      if (this.files.length > 0) {
        fileNamesDiv.innerHTML = ""; // Clear the initial message
        for (var i = 0; i < this.files.length; i++) {
          fileNamesDiv.innerHTML += this.files[i].name + "<br>";
        }
      } else {
        // Show the no files uploaded message if no file is selected
        fileNamesDiv.innerHTML = "[لم يتم إرفاق أي ملفات]";
      }
    });
  }

  // Initialize for each file input (fileInputId, fileNamesDivId)
  updateFileNamesDisplay(
    "id_form_file_bank_transfer",
    "id_file_names_bank_transfer"
  );

  // Handle form submission [not complete yet]
  document.getElementById('supporter_form').addEventListener('submit', function(event) {
    event.preventDefault();

    const formData = new FormData(this);

    // Find the selected rows in the DataTable
    const selectedRows = $('#beneficiaries_table').DataTable().rows('.selected').data();

    // Collect the data from the selected rows
    const selectedRowsData = selectedRows.toArray();

    // Increment total price by 300.0 for each selected row
    const totalPriceInput = document.getElementById('id_sponsorship_info_total_price_1');
    const currentTotalPrice = parseFloat(totalPriceInput.value) || 0.0;
    const updatedTotalPrice = currentTotalPrice + (selectedRowsData.length * 300.0);

    // Update the total price in the form data
    formData.append('total_price', updatedTotalPrice);

    // Find the selected radio button
    const radioChoice = document.querySelector('input[name="beneficiaries_choice"]:checked');

    // Append form data
    formData.append('beneficiaries_choice', radioChoice ? radioChoice.id : '');

    // Append selected rows' data
    formData.append('selectedRowsData', JSON.stringify(selectedRowsData));

    fetch('http://127.0.0.1:8000/supporters/individuals/new_request', {
        method: 'POST',
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        console.log('Success:', data);
        // Handle success, if needed
    })
    .catch((error) => {
        console.error('Error:', error);
        // Handle errors, if needed
    });
});

</script>
{% endblock %}
