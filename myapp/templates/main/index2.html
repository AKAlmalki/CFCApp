{% extends "base.html" %} {% load static %} {% load humanize %} {% block head %}
<link rel="stylesheet" href="{% static 'css/custom_form2.css' %}" />
<!-- Include jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Include jQuery Validation Plugin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>

<script src="{% static 'js/index2.js' %}"></script>

<style type="text/css">
  #dependent_information,
  #housing_income_need_information,
  #attachments_information,
  #submit_confirmation {
    display: none;
  }
</style>
{% endblock %} {% block content %}
<div class="container mt-5 px-0 mb-4 p-5 rounded-3">
  <div>
    <h1 class="fw-bold">تقديم طلب دعم</h1>
    <div id="multi-step-form-container">
      <!-- Form Steps / Progress Bar -->
      <ul
        class="form-stepper form-stepper-horizontal text-center justify-content-center px-0 ps-lg-3 ps-xl-5 ps-md-0 mx-auto pl-0 d-flex justify-content-center row row-cols-md-5 row-cols-3"
      >
        <!-- Step 1 -->
        <li
          class="form-stepper-active text-center form-stepper-list"
          step="1"
          id="form-list-1"
        >
          <a class="mx-2 text-decoration-none">
            <span class="form-stepper-circle">
              <span>1</span>
            </span>
            <div class="label">بيانات مقدم الطلب</div>
          </a>
        </li>
        <!-- Step 2 -->
        <li
          class="form-stepper-unfinished text-center form-stepper-list"
          step="2"
          id="form-list-2"
        >
          <a class="mx-2 text-decoration-none">
            <span class="form-stepper-circle text-muted">
              <span>2</span>
            </span>
            <div class="label text-muted">بيانات المرافقين</div>
          </a>
        </li>
        <!-- Step 3 -->
        <li
          class="form-stepper-unfinished text-center form-stepper-list"
          step="3"
          id="form-list-3"
        >
          <a class="mx-2 text-decoration-none">
            <span class="form-stepper-circle text-muted">
              <span>3</span>
            </span>
            <div class="label text-muted">
              <p class="p-0 m-0">بيانات السكن</p>
              <p>والدخل والاحتياج</p>
            </div>
          </a>
        </li>
        <!-- Step 4 -->
        <li
          class="form-stepper-unfinished text-center form-stepper-list"
          step="4"
          id="form-list-4"
        >
          <a class="mx-2 text-decoration-none">
            <span class="form-stepper-circle text-muted">
              <span>4</span>
            </span>
            <div class="label text-muted">المرفقات</div>
          </a>
        </li>
        <!-- Step 5 -->
        <li
          class="form-stepper-unfinished text-center form-stepper-list"
          step="5"
          id="form-list-5"
        >
          <a class="mx-2 text-decoration-none">
            <span class="form-stepper-circle text-muted">
              <span>5</span>
            </span>
            <div class="label text-muted text-decoration-none">تقديم الطلب</div>
          </a>
        </li>
      </ul>
      <!-- Step Wise Form Content -->
      <form
        id="myform"
        name="myform"
        enctype="multipart/form-data"
        method="POST"
        action="/beneficiaries/new"
        class="needs-validation bg-light"
        novalidate
      >
        {% csrf_token %}
        <!-- Step 1 Content -->
        <fieldset id="personal_information" class="form-step px-3 px-lg-5">
          <legend class="fs-2 fw-bold mb-5">بيانات مقدم الطلب</legend>
          <!-- Step 1 input fields -->
          <div class="mt-3">
            <div class="">
              <div class="container">
                <div class="row row-cols-md-2 row-cols-xl-4">
                  <div class="col-md-6 mb-4 form-group">
                    <label for="id_personalinfo_first_name" class="form-label"
                      >الاسم الأول<span style="color: red">*</span></label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="id_personalinfo_first_name"
                      maxlength="55"
                      required
                      name="personalinfo_first_name"
                    />
                  </div>
                  <div class="col-md-6 mb-4 form-group">
                    <label for="id_personalinfo_second_name" class="form-label"
                      >الاسم الثاني<span style="color: red">*</span></label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="id_personalinfo_second_name"
                      maxlength="55"
                      required
                      name="personalinfo_second_name"
                    />
                  </div>
                  <div class="col-md-6 mb-4 form-group">
                    <label for="id_personalinfo_last_name" class="form-label"
                      >الاسم الاخير<span style="color: red">*</span> (اسم
                      العائلة)</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="id_personalinfo_last_name"
                      maxlength="55"
                      required
                      name="personalinfo_last_name"
                    />
                  </div>
                  <div class="col-md-6 mb-4 form-group">
                    <label
                      for="id_personalinfo_date_of_birth"
                      class="form-label"
                      >تاريخ الميلاد<span style="color: red">*</span></label
                    >
                    <input
                      type="date"
                      class="form-control"
                      id="id_personalinfo_date_of_birth"
                      maxlength="55"
                      required
                      name="personalinfo_date_of_birth"
                    />
                  </div>
                </div>

                <hr />
                <div class="row row-cols-md-2 row-cols-xl-4">
                  <div class="col-md-6 mb-4 form-group">
                    <label for="id_personalinfo_gender" class="form-label"
                      >الجنس<span style="color: red">*</span></label
                    >
                    <select
                      name="personalinfo_gender"
                      class="form-select"
                      id="id_personalinfo_gender"
                      required
                    >
                      <option value selected>---------</option>
                      <option value="ذكر">ذكر</option>
                      <option value="انثى">انثى</option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-4 form-group">
                    <label for="id_personalinfo_national_id" class="form-label"
                      >رقم الهوية الوطنية \ الإقامة<span style="color: red"
                        >*</span
                      ></label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="id_personalinfo_national_id"
                      maxlength="20"
                      name="personalinfo_national_id"
                      required
                    />
                  </div>
                  <div class="col-md-6 mb-4 form-group">
                    <label
                      for="id_personalinfo_national_id_exp_date"
                      class="form-label"
                      >تاريخ انتهاء الهوية \ الإقامة<span style="color: red"
                        >*</span
                      ></label
                    >
                    <input
                      type="date"
                      class="form-control"
                      id="id_personalinfo_national_id_exp_date"
                      name="personalinfo_national_id_exp_date"
                      required
                    />
                  </div>
                  <div class="col-md-6 mb-4 form-group">
                    <label for="id_personalinfo_nationality" class="form-label"
                      >الجنسية<span style="color: red">*</span></label
                    >
                    <select
                      name="personalinfo_nationality"
                      class="form-select"
                      id="id_personalinfo_nationality"
                    >
                      <option value selected>إختر</option>
                      <option value="السعودية">السعودية</option>
                      <option value="أفغانستان">أفغانستان</option>
                      <option value="ألبانيا">ألبانيا</option>
                      <option value="الجزائر">الجزائر</option>
                      <option value="أندورا">أندورا</option>
                      <option value="أنغولا">أنغولا</option>
                      <option value="أنتيغوا وباربودا">أنتيغوا وباربودا</option>
                      <option value="الأرجنتين">الأرجنتين</option>
                      <option value="أرمينيا">أرمينيا</option>
                      <option value="أستراليا">أستراليا</option>
                      <option value="النمسا">النمسا</option>
                      <option value="أذربيجان">أذربيجان</option>
                      <option value="البهاما">البهاما</option>
                      <option value="البحرين">البحرين</option>
                      <option value="بنغلاديش">بنغلاديش</option>
                      <option value="باربادوس">باربادوس</option>
                      <option value="بيلاروسيا">بيلاروسيا</option>
                      <option value="بلجيكا">بلجيكا</option>
                      <option value="بليز">بليز</option>
                      <option value="بنين">بنين</option>
                      <option value="بوتان">بوتان</option>
                      <option value="بوليفيا">بوليفيا</option>
                      <option value="البوسنة والهرسك ">البوسنة والهرسك</option>
                      <option value="بوتسوانا">بوتسوانا</option>
                      <option value="البرازيل">البرازيل</option>
                      <option value="بروناي">بروناي</option>
                      <option value="بلغاريا">بلغاريا</option>
                      <option value="بوركينا فاسو ">بوركينا فاسو</option>
                      <option value="بوروندي">بوروندي</option>
                      <option value="كمبوديا">كمبوديا</option>
                      <option value="الكاميرون">الكاميرون</option>
                      <option value="كندا">كندا</option>
                      <option value="الرأس الأخضر">الرأس الأخضر</option>
                      <option value="جمهورية أفريقيا الوسطى ">
                        جمهورية أفريقيا الوسطى
                      </option>
                      <option value="تشاد">تشاد</option>
                      <option value="تشيلي">تشيلي</option>
                      <option value="الصين">الصين</option>
                      <option value="كولومبيا">كولومبيا</option>
                      <option value="جزر القمر">جزر القمر</option>
                      <option value="كوستاريكا">كوستاريكا</option>
                      <option value="ساحل العاج">ساحل العاج</option>
                      <option value="كرواتيا">كرواتيا</option>
                      <option value="كوبا">كوبا</option>
                      <option value="قبرص">قبرص</option>
                      <option value="التشيك">التشيك</option>
                      <option value="جمهورية الكونغو الديمقراطية">
                        جمهورية الكونغو الديمقراطية
                      </option>
                      <option value="الدنمارك">الدنمارك</option>
                      <option value="جيبوتي">جيبوتي</option>
                      <option value="دومينيكا">دومينيكا</option>
                      <option value="جمهورية الدومينيكان">
                        جمهورية الدومينيكان
                      </option>
                      <option value="تيمور الشرقية ">تيمور الشرقية</option>
                      <option value="الإكوادور">الإكوادور</option>
                      <option value="مصر">مصر</option>
                      <option value="السلفادور">السلفادور</option>
                      <option value="غينيا الاستوائية">غينيا الاستوائية</option>
                      <option value="إريتريا">إريتريا</option>
                      <option value="إستونيا">إستونيا</option>
                      <option value="إثيوبيا">إثيوبيا</option>
                      <option value="فيجي">فيجي</option>
                      <option value="فنلندا">فنلندا</option>
                      <option value="فرنسا">فرنسا</option>
                      <option value="الغابون">الغابون</option>
                      <option value="غامبيا">غامبيا</option>
                      <option value="جورجيا">جورجيا</option>
                      <option value="ألمانيا">ألمانيا</option>
                      <option value="غانا">غانا</option>
                      <option value="اليونان">اليونان</option>
                      <option value="جرينادا">جرينادا</option>
                      <option value="غواتيمالا">غواتيمالا</option>
                      <option value="غينيا">غينيا</option>
                      <option value="غينيا بيساو">غينيا بيساو</option>
                      <option value="غويانا">غويانا</option>
                      <option value="هايتي">هايتي</option>
                      <option value="هندوراس">هندوراس</option>
                      <option value="المجر">المجر</option>
                      <option value="آيسلندا">آيسلندا</option>
                      <option value="الهند">الهند</option>
                      <option value="إندونيسيا">إندونيسيا</option>
                      <option value="إيران">إيران</option>
                      <option value="العراق">العراق</option>
                      <option value="جمهورية أيرلندا ">جمهورية أيرلندا</option>
                      <option value="فلسطين">فلسطين</option>
                      <option value="إيطاليا">إيطاليا</option>
                      <option value="جامايكا">جامايكا</option>
                      <option value="اليابان">اليابان</option>
                      <option value="الأردن">الأردن</option>
                      <option value="كازاخستان">كازاخستان</option>
                      <option value="كينيا">كينيا</option>
                      <option value="كيريباتي">كيريباتي</option>
                      <option value="الكويت">الكويت</option>
                      <option value="قرغيزستان">قرغيزستان</option>
                      <option value="لاوس">لاوس</option>
                      <option value="لاوس">لاوس</option>
                      <option value="لاتفيا">لاتفيا</option>
                      <option value="لبنان">لبنان</option>
                      <option value="ليسوتو">ليسوتو</option>
                      <option value="ليبيريا">ليبيريا</option>
                      <option value="ليبيا">ليبيا</option>
                      <option value="ليختنشتاين">ليختنشتاين</option>
                      <option value="ليتوانيا">ليتوانيا</option>
                      <option value="لوكسمبورغ">لوكسمبورغ</option>
                      <option value="مدغشقر">مدغشقر</option>
                      <option value="مالاوي">مالاوي</option>
                      <option value="ماليزيا">ماليزيا</option>
                      <option value="جزر المالديف">جزر المالديف</option>
                      <option value="مالي">مالي</option>
                      <option value="مالطا">مالطا</option>
                      <option value="جزر مارشال">جزر مارشال</option>
                      <option value="موريتانيا">موريتانيا</option>
                      <option value="موريشيوس">موريشيوس</option>
                      <option value="المكسيك">المكسيك</option>
                      <option value="مايكرونيزيا">مايكرونيزيا</option>
                      <option value="مولدوفا">مولدوفا</option>
                      <option value="موناكو">موناكو</option>
                      <option value="منغوليا">منغوليا</option>
                      <option value="الجبل الأسود">الجبل الأسود</option>
                      <option value="المغرب">المغرب</option>
                      <option value="موزمبيق">موزمبيق</option>
                      <option value="بورما">بورما</option>
                      <option value="ناميبيا">ناميبيا</option>
                      <option value="ناورو">ناورو</option>
                      <option value="نيبال">نيبال</option>
                      <option value="هولندا">هولندا</option>
                      <option value="نيوزيلندا">نيوزيلندا</option>
                      <option value="نيكاراجوا">نيكاراجوا</option>
                      <option value="النيجر">النيجر</option>
                      <option value="نيجيريا">نيجيريا</option>
                      <option value="كوريا الشمالية ">كوريا الشمالية</option>
                      <option value="النرويج">النرويج</option>
                      <option value="سلطنة عمان">سلطنة عمان</option>
                      <option value="باكستان">باكستان</option>
                      <option value="بالاو">بالاو</option>
                      <option value="بنما">بنما</option>
                      <option value="بابوا غينيا الجديدة">
                        بابوا غينيا الجديدة
                      </option>
                      <option value="باراغواي">باراغواي</option>
                      <option value="بيرو">بيرو</option>
                      <option value="الفلبين">الفلبين</option>
                      <option value="بولندا">بولندا</option>
                      <option value="البرتغال">البرتغال</option>
                      <option value="قطر">قطر</option>
                      <option value="جمهورية الكونغو">جمهورية الكونغو</option>
                      <option value="جمهورية مقدونيا">جمهورية مقدونيا</option>
                      <option value="رومانيا">رومانيا</option>
                      <option value="روسيا">روسيا</option>
                      <option value="رواندا">رواندا</option>
                      <option value="سانت كيتس ونيفيس">سانت كيتس ونيفيس</option>
                      <option value="سانت لوسيا">سانت لوسيا</option>
                      <option value="سانت فنسينت والجرينادينز">
                        سانت فنسينت والجرينادينز
                      </option>
                      <option value="ساموا">ساموا</option>
                      <option value="سان مارينو">سان مارينو</option>
                      <option value="ساو تومي وبرينسيب">
                        ساو تومي وبرينسيب
                      </option>
                      <option value="السنغال">السنغال</option>
                      <option value="صربيا">صربيا</option>
                      <option value="سيشيل">سيشيل</option>
                      <option value="سيراليون">سيراليون</option>
                      <option value="سنغافورة">سنغافورة</option>
                      <option value="سلوفاكيا">سلوفاكيا</option>
                      <option value="سلوفينيا">سلوفينيا</option>
                      <option value="جزر سليمان">جزر سليمان</option>
                      <option value="الصومال">الصومال</option>
                      <option value="جنوب أفريقيا">جنوب أفريقيا</option>
                      <option value="كوريا الجنوبية">كوريا الجنوبية</option>
                      <option value="جنوب السودان">جنوب السودان</option>
                      <option value="إسبانيا">إسبانيا</option>
                      <option value="سريلانكا">سريلانكا</option>
                      <option value="السودان">السودان</option>
                      <option value="سورينام">سورينام</option>
                      <option value="سوازيلاند">سوازيلاند</option>
                      <option value="السويد">السويد</option>
                      <option value="سويسرا">سويسرا</option>
                      <option value="سوريا">سوريا</option>
                      <option value="طاجيكستان">طاجيكستان</option>
                      <option value="تنزانيا">تنزانيا</option>
                      <option value="تايلاند">تايلاند</option>
                      <option value="توغو">توغو</option>
                      <option value="تونجا">تونجا</option>
                      <option value="ترينيداد وتوباغو">ترينيداد وتوباغو</option>
                      <option value="تونس">تونس</option>
                      <option value="تركيا">تركيا</option>
                      <option value="تركمانستان">تركمانستان</option>
                      <option value="توفالو">توفالو</option>
                      <option value="أوغندا">أوغندا</option>
                      <option value="أوكرانيا">أوكرانيا</option>
                      <option value="الإمارات العربية المتحدة">
                        الإمارات العربية المتحدة
                      </option>
                      <option value="المملكة المتحدة">المملكة المتحدة</option>
                      <option value="الولايات المتحدة">الولايات المتحدة</option>
                      <option value="أوروغواي">أوروغواي</option>
                      <option value="أوزبكستان">أوزبكستان</option>
                      <option value="فانواتو">فانواتو</option>
                      <option value="فنزويلا">فنزويلا</option>
                      <option value="فيتنام">فيتنام</option>
                      <option value="اليمن">اليمن</option>
                      <option value="زامبيا">زامبيا</option>
                      <option value="زيمبابوي">زيمبابوي</option>
                    </select>
                  </div>
                </div>

                <hr />

                <div class="row row-cols-md-2 row-cols-xl-3">
                  <div class="col-md-6 mb-4 form-group">
                    <label for="id_personalinfo_category" class="form-label"
                      >التصنيف الرئيسي<span style="color: red">*</span></label
                    >
                    <select
                      name="personalinfo_category"
                      class="form-select"
                      required
                      id="id_personalinfo_category"
                      onchange="categoryCheck(this);"
                    >
                      <option value selected>---------</option>
                      <option value="أسرة عادية">أسرة عادية</option>
                      <option value="أسرة أيتام">أسرة أيتام</option>
                      <option value="أسرة أرملة">أسرة أرملة</option>
                      <option value="أسرة سجناء">أسرة سجناء</option>
                      <option value="أسرة مطلقة">أسرة مطلقة</option>
                      <option value="فرد">فرد</option>
                    </select>
                  </div>
                  <div class="col-md-6 mb-4 form-group">
                    <label
                      for="id_personalinfo_marital_status"
                      class="form-label"
                      >الحالة الاجتماعية<span style="color: red">*</span></label
                    >
                    <select
                      name="personalinfo_marital_status"
                      class="form-select"
                      required
                      id="id_personalinfo_marital_status"
                      onchange="widowerCheck(this);"
                    >
                      <option value selected>---------</option>
                      <option value="متزوج/ـة">متزوج/ـة</option>
                      <option value="أعزب/ـة">أعزب/ـة</option>
                      <option value="أرمل/ـة">أرمل/ـة</option>
                      <option value="مطلقة">مطلقة</option>
                      <option value="مهجورة">مهجورة</option>
                    </select>
                  </div>
                  <div class="col-md-12 mb-4 form-group">
                    <label
                      for="id_personalinfo_educational_level"
                      class="form-label"
                      >المؤهل التعليمي<span style="color: red">*</span></label
                    >
                    <select
                      name="personalinfo_educational_level"
                      class="form-select"
                      id="id_personalinfo_educational_level"
                    >
                      <option value="" selected>---------</option>
                      <option value="أول ابتدائي">أول ابتدائي</option>
                      <option value="ثاني ابتدائي">ثاني ابتدائي</option>
                      <option value="ثالث ابتدائي">ثالث ابتدائي</option>
                      <option value="رابع ابتدائي">رابع ابتدائي</option>
                      <option value="خامس ابتدائي">خامس ابتدائي</option>
                      <option value="سادس ابتدائي">سادس ابتدائي</option>
                      <option value="أول متوسط">أول متوسط</option>
                      <option value="ثاني متوسط">ثاني متوسط</option>
                      <option value="ثالث متوسط">ثالث متوسط</option>
                      <option value="أول ثانوي">أول ثانوي</option>
                      <option value="ثاني ثانوي">ثاني ثانوي</option>
                      <option value="ثالث ثانوي">ثالث ثانوي</option>
                      <option value="جامعي">جامعي</option>
                      <option value="لا يدرس">لا يدرس</option>
                    </select>
                  </div>
                </div>

                <hr />
                <div
                  class="row"
                  id="id_personalinfo_widower_group_info"
                  style="display: none !important"
                >
                  <div class="col-md-6 mb-4 form-group">
                    <label
                      for="id_personalinfo_date_of_death_of_father_or_husband"
                      class="form-label"
                      >تاريخ وفاة الأب \ الزوج<span style="color: red">*</span>
                      (عند اختيار أرمله)</label
                    >
                    <input
                      type="date"
                      name="personalinfo_date_of_death_of_father_or_husband"
                      class="form-control"
                      id="id_personalinfo_date_of_death_of_father_or_husband"
                    />
                  </div>
                  <div class="col-md-6 mb-4 form-group">
                    <label
                      for="id_personalinfo_washing_place"
                      class="form-label"
                      >المغسلة التي تم التجهيز فيها<span style="color: red"
                        >*</span
                      ></label
                    >
                    <select
                      name="personalinfo_washing_place"
                      class="form-select"
                      id="id_personalinfo_washing_place"
                    >
                      <option value="" selected>---------</option>
                      <option value="إكرام فلسطين">إكرام فلسطين</option>
                      <option value="الثنيان">الثنيان</option>
                      <option value="العمودي">العمودي</option>
                      <option value="ابن القيم">ابن القيم</option>
                      <option value="الأمير منصور">الأمير منصور</option>
                      <option value="الملك فهد">الملك فهد</option>
                      <option value="الملك عبدالعزيز">الملك عبدالعزيز</option>
                      <option value="اللامي">اللامي</option>
                      <option value="طيبة">طيبة</option>
                      <option value="القريقري">القريقري</option>
                      <option value="شرق جدة">شرق جدة</option>
                      <option value="أخرى">أخرى</option>
                    </select>
                  </div>
                </div>

                <hr id="widower_hr" style="display: none"/>

                <div class="row">
                  <div class="col-md-6 mb-4 form-group">
                    <label
                      for="id_personalinfo_health_status"
                      class="form-label"
                      >الحالة الصحية<span style="color: red">*</span></label
                    >
                    <select
                      name="personalinfo_health_status"
                      class="form-select"
                      id="id_personalinfo_health_status"
                      onchange="personalInfoHealthCheck(this);"
                    >
                      <option value="" selected>---------</option>
                      <option value="جيدة">جيدة</option>
                      <option value="غير جيدة">غير جيدة</option>
                    </select>
                  </div>
                  <div
                    class="col-md-6 mb-4 form-group"
                    id="id_personalinfo_disease_type_group_info"
                    style="display: none"
                  >
                    <label for="id_personalinfo_disease_type" class="form-label"
                      >نوع المرض<span style="color: red">*</span> (عند اختيار
                      غير جيدة)</label
                    >
                    <input
                      type="text"
                      name="personalinfo_disease_type"
                      maxlength="100"
                      class="form-control"
                      id="id_personalinfo_disease_type"
                    />
                  </div>
                </div>

                <hr />

                <div class="row">
                  <div class="col-md-6 mb-4 form-group">
                    <label for="id_personalinfo_work_status" class="form-label"
                      >هل تعمل؟<span style="color: red">*</span></label
                    >
                    <select
                      name="personalinfo_work_status"
                      class="form-select"
                      required
                      id="id_personalinfo_work_status"
                      onchange="workCheck(this);"
                    >
                      <option value="" selected>---------</option>
                      <option value="نعم">نعم</option>
                      <option value="لا">لا</option>
                    </select>
                  </div>
                  <div
                    class="col-md-6 mb-4 form-group"
                    id="id_personalinfo_employer_group_info"
                    style="display: none"
                  >
                    <label for="id_personalinfo_employer" class="form-label"
                      >جهة العمل<span style="color: red">*</span> (عند اختيار
                      نعم)</label
                    >
                    <input
                      type="text"
                      name="personalinfo_employer"
                      maxlength="100"
                      class="form-control"
                      id="id_personalinfo_employer"
                    />
                  </div>
                </div>

                <hr />

                <div class="row">
                  <div class="col-md-6 mb-4 form-group">
                    <label for="id_personalinfo_phone_number" class="form-label"
                      >رقم التواصل<span style="color: red">*</span></label
                    >
                    <input
                      type="tel"
                      name="personalinfo_phone_number"
                      class="form-control"
                      required
                      id="id_personalinfo_phone_number"
                    />
                  </div>
                  <div class="col-md-6 mb-4 form-group">
                    <label for="id_personalinfo_email" class="form-label"
                      >البريد الالكتروني<span style="color: red">*</span></label
                    >
                    <input
                      type="email"
                      name="personalinfo_email"
                      maxlength="254"
                      class="form-control"
                      id="id_personalinfo_email"
                      required
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="form-group">
            <div class="col-lg-8 col-lg-offset-4">
              <div class="checkbox form-check">
                <label class="form-check-label fs-6" for="skip-step"
                  >هل لديك أبناء/مرافقين ترغب بإضافتهم كمستفيدين؟</label
                >
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="skip-step"
                  name="addDependent"
                />
                <p class="text-muted" style="font-size: 0.8rem">
                  في حال الاختيار سوف تظهر نافذة المرافقين
                </p>
              </div>
            </div>
          </div>
          <div class="mt-3">
            <button
              class="button btn-navigate-form-step next"
              type="button"
              step_number="2"
            >
              التالي
            </button>
          </div>
        </fieldset>
        <!-- Step 2 Content, default hidden on page load. -->
        <fieldset id="dependent_information" class="form-step px-3 px-lg-5">
          <h2 class="fs-2 fw-bold mb-5">بيانات المرافقين</h2>
          <!-- Step 2 input fields -->
          <div class="mt-3">
            <div id="family-form">
              <div class="row row-cols-md-2 row-cols-xl-4">
                <div class="col-md-6 mb-4 form-group">
                  <label for="id_dependent_info_first_name" class="form-label"
                    >الأسم الأول<span style="color: red">*</span
                    ></label
                  >
                  <input
                    type="text"
                    id="id_dependent_info_first_name"
                    class="form-control"
                    name="dependent_info_first_name"
                  />
                </div>
                <div class="col-md-6 mb-4 form-group">
                  <label for="id_dependent_info_second_name" class="form-label"
                    >الأسم الثاني<span style="color: red">*</span
                    ></label
                  >
                  <input
                    type="text"
                    id="id_dependent_info_second_name"
                    class="form-control"
                    name="dependent_info_second_name"
                  />
                </div>
                <div class="col-md-6 mb-4 form-group">
                  <label for="id_dependent_info_last_name" class="form-label"
                    >الأسم الأخير<span style="color: red">*</span
                    ><span style="font-size: 0.9rem">
                      (أسم العائلة)</span
                    ></label
                  >
                  <input
                    type="text"
                    id="id_dependent_info_last_name"
                    class="form-control"
                    name="dependent_info_last_name"
                  />
                </div>
                <div class="col-md-6 mb-4 form-group">
                  <label
                    for="id_dependent_info_date_of_birth"
                    class="form-label"
                    >تاريخ الميلاد<span style="color: red">*</span></label
                  >
                  <input
                    type="date"
                    class="form-control"
                    id="id_dependent_info_date_of_birth"
                    maxlength="55"
                    name="dependent_info_date_of_birth"
                  />
                </div>
              </div>

              <hr>

              <div class="row row-cols-md-2 row-cols-xl-3">
                <div class="col-md-6 mb-4 form-group">
                  <label for="id_dependent_info_gender" class="form-label"
                    >الجنس<span style="color: red">*</span></label
                  >
                  <select
                    name="dependent_info_gender"
                    class="form-select"
                    id="id_dependent_info_gender"
                  >
                    <option value selected>---------</option>
                    <option value="ذكر">ذكر</option>
                    <option value="انثى">انثى</option>
                  </select>
                </div>
                <div class="col-md-6 mb-4 form-group">
                  <label for="id_dependent_info_relationship" class="form-label"
                    >صلة القرابة<span style="color: red">*</span></label
                  >
                  <select
                    name="dependent_info_relationship"
                    class="form-select"
                    id="id_dependent_info_relationship"
                  >
                    <option value selected>---------</option>
                    <option value="ابن">ابن</option>
                    <option value="ابنة">ابنة</option>
                    <option value="أخ">أخ</option>
                    <option value="أخت">أخت</option>
                    <option value="زوج/ـة">زوج/ـة</option>
                    <option value="خال/ـة">خال/ـة</option>
                    <option value="عم/ـة">عم/ـة</option>
                    <option value="جد/ـة">جد/ـة</option>
                  </select>
                </div>
                <div class="col-md-12 mb-4 form-group">
                  <label
                    for="id_dependent_info_marital_status"
                    class="form-label"
                    >الحالة الاجتماعية<span style="color: red">*</span></label
                  >
                  <select
                    name="dependent_info_marital_status"
                    class="form-select"
                    id="id_dependent_info_marital_status"
                  >
                    <option value selected>---------</option>
                    <option value="طالب/ـة">طالب/ـة</option>
                    <option value="طفل/ـة">طفل/ـة</option>
                    <option value="ربة منزل">ربة منزل</option>
                    <option value="متزوج/ـة">متزوج/ـة</option>
                    <option value="أعزب/ـة">أعزب/ـة</option>
                    <option value="أرملة/ـة">أرمل/ـة</option>
                    <option value="مطلقة">مطلقة</option>
                    <option value="مهجورة">مهجورة</option>
                  </select>
                </div>
              </div>

              <hr />

              <div class="row row-cols-md-2">
                <div class="col-md-6 mb-4 form-group">
                  <label
                    for="id_dependent_info_educational_status"
                    class="form-label"
                    >الحالة الدراسية<span style="color: red">*</span></label
                  >
                  <select
                    name="dependent_info_educational_status"
                    class="form-select"
                    id="id_dependent_info_educational_status"
                    onchange="educationalStatusCheck(this);"
                  >
                    <option value selected>---------</option>
                    <option value="يدرس">يدرس</option>
                    <option value="لا يدرس">لا يدرس</option>
                  </select>
                </div>
                <div class="col-md-6 mb-4 form-group" style="display: none;" id="id_dependent_info_educational_level_group_info">
                  <label
                    for="id_dependent_info_educational_level"
                    class="form-label"
                    >المرحلة الدراسية<span style="color: red">*</span></label
                  >
                  <select
                    name="dependent_info_educational_level"
                    class="form-select"
                    id="id_dependent_info_educational_level"
                  >
                    <option value selected>---------</option>
                    <option value="أول ابتدائي">أول ابتدائي</option>
                    <option value="ثاني ابتدائي">ثاني ابتدائي</option>
                    <option value="ثالث ابتدائي">ثالث ابتدائي</option>
                    <option value="رابع ابتدائي">رابع ابتدائي</option>
                    <option value="خامس ابتدائي">خامس ابتدائي</option>
                    <option value="سادس ابتدائي">سادس ابتدائي</option>
                    <option value="اول متوسط">اول متوسط</option>
                    <option value="ثاني متوسط">ثاني متوسط</option>
                    <option value="ثالث متوسط">ثالث متوسط</option>
                    <option value="اول ثانوي">اول ثانوي</option>
                    <option value="ثاني ثانوي">ثاني ثانوي</option>
                    <option value="ثالث ثانوي">ثالث ثانوي</option>
                    <option value="جامعي">جامعي</option>
                  </select>
                </div>
                <div class="col-md-6 mb-4 form-group" style="display: none;" id="id_dependent_info_educational_degree_group_info">
                  <label
                    for="id_dependent_info_educational_degree"
                    class="form-label"
                    >المؤهل التعليمي<span style="color: red">*</span></label
                  >
                  <select
                    name="dependent_info_educational_degree"
                    class="form-select"
                    id="id_dependent_info_educational_degree"
                  >
                    <option value selected>---------</option>
                    <option value="لا يوجد">لا يوجد</option>
                    <option value="ابتدائي">ابتدائي</option>
                    <option value="متوسط">متوسط</option>
                    <option value="ثانوي">ثانوي</option>
                    <option value="جامعي">جامعي</option>
                  </select>
                </div>
              </div>

              <hr />

              <div class="row">
                <div class="col-md-6 mb-4 form-group">
                  <label for="id_dependent_info_national_id" class="form-label"
                    >رقم الهوية الوطنية \ الإقامة<span style="color: red"
                      >*</span
                    ></label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="id_dependent_info_national_id"
                    maxlength="20"
                    name="dependent_info_national_id"
                  />
                </div>
                <div class="col-md-6 mb-4 form-group">
                  <label
                    for="id_dependent_info_national_id_exp_date"
                    class="form-label"
                    >تاريخ انتهاء الهوية \ الإقامة<span style="color: red"
                      >*</span
                    ></label
                  >
                  <input
                    type="date"
                    class="form-control"
                    id="id_dependent_info_national_id_exp_date"
                    name="dependent_info_national_id_exp_date"
                  />
                </div>
              </div>

              <hr />

              <h4 class="mb-4">مصادر الدخل</h4>
              <div class="row justify-content-center">
                <div class="col-md-4 mb-2 form-group">
                  <label for="id_dependent_info_monthly_income" class="form-label">دخل المرافق (شهريا)</label>
                  <div class="input-group mb-3">
                    <input type="number" name="dependent_info_monthly_income" max="9999999999999999" min="0" class="form-control" id="id_dependent_info_monthly_income" />
                    <span class="input-group-text" id="basic-addon1">ر.س.</span>
                  </div>
                </div>
                <div class="col-md-4 col-lg-5 mb-2 form-group">
                  <label for="id_dependent_info_income_source" class="form-label">مصدر الدخل</label>
                  <select name="dependent_info_income_source" class="form-select" id="id_dependent_info_income_source">
                    <option value selected>---------</option>
                    <option value="الراتب">الراتب</option>
                    <option value="التأمينات الاجتماعية">التأمينات الاجتماعية</option>
                    <option value="الضمان الاجتماعي">الضمان الاجتماعي</option>
                    <option value="مصلحة التقاعد">مصلحة التقاعد</option>
                    <option value="حساب المواطن">حساب المواطن</option>
                    <option value="التأهيل الشامل">التأهيل الشامل</option>
                    <option value="جمعية خيرية">جمعية خيرية</option>
                    <option value="فاعل خير">فاعل خير</option>
                    <option value="اخرى">اخرى</option>
                  </select>
                </div>
                <div class="col-md-4 col-lg-3 mb-sm-5 mb-md-3 mb-3 mt-4 row justify-content-center align-items-center" id="id_add_row_income_table">
                  <button type="button" class="btn btn-primary" onclick="addRowToIncomeInfoTable()">إضافة مصدر الدخل</button>
                </div>
              </div>
              
              {% comment %} Dependent Income Table {% endcomment %}
              <div>
                <table class="table table-striped table-hover mb-5" id="incomeInfoTable">
                  <thead>
                    <tr>
                      <th scope="col">دخل المرافق الشهري (ر.س.)</th>
                      <th scope="col">مصدر الدخل للمرافق</th>
                      <th scope="col">الإجراءات</th>
                    </tr>
                  </thead>
                  <tbody id="incomeInfoTableBody"></tbody>
                </table>
              </div>

              <hr />

              <div class="row">
                <div class="col-md-6 mb-4 form-group">
                  <label
                    for="id_dependent_info_health_status"
                    class="form-label"
                    >الحالة الصحية<span style="color: red">*</span></label
                  >
                  <select
                    name="dependent_info_health_status"
                    class="form-select"
                    id="id_dependent_info_health_status"
                    onchange="dependentInfoHealthCheck(this);"
                  >
                    <option value selected>---------</option>
                    <option value="جيدة">جيدة</option>
                    <option value="غير جيدة">غير جيدة</option>
                  </select>
                </div>
                <div
                  class="col-md-6 mb-4 form-group"
                  id="id_dependentinfo_disease_type_group_info"
                  style="display: none"
                >
                  <label for="id_dependent_info_disease_type" class="form-label"
                    >نوع المرض<span style="color: red">*</span> (عند اختيار غير
                    جيدة)</label
                  >
                  <input
                    type="text"
                    name="dependent_info_disease_type"
                    maxlength="100"
                    class="form-control"
                    id="id_dependent_info_disease_type"
                  />
                </div>
              </div>

              <hr />

              <div class="row">
                <div class="col-md-12 mb-4 form-group">
                  <label class="form-label"
                    >نوع الاحتياج للمرافق<span style="color: red"
                      >*</span
                    > <span style="font-size: 0.9rem">
                      (إختيار متعدد)</span
                    ></label
                  >
                  <div
                    name="dependent_info_needs_type"
                    class="d-grid gap-2"
                    style="grid-template-columns: 1fr 1fr 1fr;"
                    id="id_dependent_info_needs_type"
                  >
                    <input type="checkbox" class="btn-check" id="id_dependent_info_needs_type_economical" autocomplete="off" name="dependent_info_needs_type_economical" value="اقتصادي">
                    <label class="btn btn-outline-primary" for="id_dependent_info_needs_type_economical">اقتصادي</label>

                    <input type="checkbox" class="btn-check" id="id_dependent_info_needs_type_educational" autocomplete="off" name="dependent_info_needs_type_educational" value="تعليمي">
                    <label class="btn btn-outline-primary" for="id_dependent_info_needs_type_educational">تعليمي</label>

                    <input type="checkbox" class="btn-check" id="id_dependent_info_needs_type_employment" autocomplete="off" name="dependent_info_needs_type_employment" value="توظيف">
                    <label class="btn btn-outline-primary" for="id_dependent_info_needs_type_employment">توظيف</label>

                    <input type="checkbox" class="btn-check" id="id_dependent_info_needs_type_sponsorship" autocomplete="off" name="dependent_info_needs_type_sponsorship" value="كفالة">
                    <label class="btn btn-outline-primary" for="id_dependent_info_needs_type_sponsorship">كفالة</label>

                    <input type="checkbox" class="btn-check" id="id_dependent_info_needs_type_healthy" autocomplete="off" name="dependent_info_needs_type_healthy" value="صحي">
                    <label class="btn btn-outline-primary" for="id_dependent_info_needs_type_healthy">صحي</label>
                  </div>
                </div>
                <div class="col-md-12 mb-4 form-group">
                  <label for="id_dependent_info_needs_description" class="form-label">وصف الاحتياج</label>
                  <textarea type="textarea" class="form-control form-control-lg" id="id_dependent_info_needs_description" rows="5" name="dependentinfo_needs_description" maxlength="2000"></textarea>
                </div>
              </div>

              <button
                id="addChildButton"
                type="button"
                class="btn addChildBtn btn-success mb-4 mt-3 px-4 py-3"
              >
                إضافة مرافق
              </button>

              <hr class="mb-4">

              <h3 class="mb-3">المرافقين</h3>
              <div class="table-responsive-xl">
                <table
                  id="family-table"
                  class="table table-striped table-hover"
                  style="overflow-x: scroll"
                >
                  <thead>
                    <tr>
                      <th scope="col">الأسم الأول</th>
                      <th scope="col" class="d-none">الأسم الثاني</th>
                      <th scope="col" class="d-none">الأسم الأخير</th>
                      <th scope="col">الجنس</th>
                      <th scope="col">صلة القرابة</th>
                      <th scope="col">الحالة الدراسية</th>
                      <th scope="col">الحالة الاجتماعية</th>
                      <th scope="col">رقم الهوية</th>
                      <th scope="col">الحالة الصحية</th>
                      <th scope="col" class="d-none">دخل المرافق (شهريا)</th>
                      <th scope="col" class="d-none">مصدر الدخل</th>
                      <th scope="col" class="d-none">نوع الاحتياج</th>
                      <th scope="col" class="d-none">المؤهل التعليمي</th>
                      <th scope="col" class="d-none">تاريخ الميلاد</th>
                      <th scope="col" class="d-none">
                        تاريح انتهاء الهوية/الإقامة
                      </th>
                      <th scope="col" class="d-none">وصف الاحتياج</th>
                      <th scope="col" class="text-center">خيارات</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Child rows will be added here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="mt-5 d-flex column-gap-2 d-lg-block">
            <button
              class="col button btn-navigate-form-step previous"
              type="button"
              step_number="1"
            >
              السابق
            </button>
            <button
              class="col button btn-navigate-form-step nextDependent"
              type="button"
              step_number="3"
            >
              التالي
            </button>
          </div>
        </fieldset>
        <!-- Step 3 Content, default hidden on page load. -->
        <fieldset
          id="housing_income_need_information"
          class="form-step px-3 px-lg-5"
        >
          <h2 class="fs-2 fw-bold mb-5">بيانات السكن والدخل والاحتياج</h2>

          <!-- Step 3 input fields -->
          <div class="mt-5">
            <h4 class="font-normal">بيانات العنوان الوطني</h4>
            <div class="row row-cols-md-2 row-cols-xl-4 mt-4">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_houseinfo_building_number" class="form-label"
                  >رقم المبنى<span style="color: red"
                  >*</span
                ></label
                >
                <input
                  type="number"
                  name="houseinfo_building_number"
                  min="0"
                  max="9999999"
                  class="form-control"
                  id="id_houseinfo_building_number"
                />
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_houseinfo_street_name" class="form-label"
                  >اسم الشارع<span style="color: red"
                  >*</span
                ></label
                >
                <input
                  type="text"
                  name="houseinfo_street_name"
                  maxlength="50"
                  class="form-control"
                  id="id_houseinfo_street_name"
                />
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_houseinfo_neighborhood" class="form-label"
                  >الحي<span style="color: red"
                  >*</span
                ></label
                >
                <input
                  type="text"
                  name="houseinfo_neighborhood"
                  maxlength="50"
                  class="form-control"
                  id="id_houseinfo_neighborhood"
                />
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_houseinfo_city" class="form-label"
                  >المدينة<span style="color: red"
                  >*</span
                ></label
                >
                <input
                  type="text"
                  name="houseinfo_city"
                  maxlength="50"
                  class="form-control"
                  id="id_houseinfo_city"
                />
              </div>
            </div>
            <div class="row row-cols-md-2 row-cols-xl-4 mt-4">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_houseinfo_postal_code" class="form-label"
                  >الرمز البريدي<span style="color: red"
                  >*</span
                ></label
                >
                <input
                  type="number"
                  name="houseinfo_postal_code"
                  min="0"
                  max="9999999"
                  class="form-control"
                  id="id_houseinfo_postal_code"
                />
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_houseinfo_additional_number" class="form-label"
                  >الرقم الإضافي<span style="color: red"
                  >*</span
                ></label
                >
                <input
                  type="number"
                  name="houseinfo_additional_number"
                  min="0"
                  max="9999999"
                  class="form-control"
                  id="id_houseinfo_additional_number"
                />
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_houseinfo_unit" class="form-label">الوحدة<span style="color: red"
                  >*</span
                ></label>
                <input
                  type="text"
                  name="houseinfo_unit"
                  maxlength="50"
                  class="form-control"
                  id="id_houseinfo_unit"
                />
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_houseinfo_location_url" class="form-label"
                  >رابط موقع المنزل (google maps)<span style="color: red"
                  >*</span
                ></label
                >
                <input
                  type="url"
                  name="houseinfo_location_url"
                  maxlength="250"
                  class="form-control"
                  id="id_houseinfo_location_url"
                />
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_houseinfo_housing_type" class="form-label"
                  >نوع السكن<span style="color: red">*</span></label
                >
                <select
                  name="houseinfo_housing_type"
                  class="form-select"
                  id="id_houseinfo_housing_type"
                >
                  <option value selected>---------</option>
                  <option value="شعبي">شعبي</option>
                  <option value="شقة">شقة</option>
                  <option value="فيلا">فيلا</option>
                  <option value="ملحق">ملحق</option>
                </select>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_houseinfo_housing_ownership" class="form-label"
                  >ملكية السكن<span style="color: red">*</span></label
                >
                <select
                  name="houseinfo_housing_ownership"
                  class="form-select"
                  id="id_houseinfo_housing_ownership"
                >
                  <option value selected>---------</option>
                  <option value="ملك">ملك</option>
                  <option value="وقف">وقف</option>
                  <option value="إيجار">إيجار</option>
                </select>
              </div>
            </div>

            <hr />

            <h4 class="font-normal">مصادر دخل رب الأسرة (المعيل - شهريًا)</h4>
            <div
              class="alert alert-warning mt-3"
              role="alert"
              id="checkboxError"
            >
              الرجاء إدخال مصادر الدخل ادناه, وفي حال عدم وجود الدخل المسمى,
              يرجى ادخال قيمة صفر (0)
            </div>
            <div class="row row-cols-md-2 row-cols-xl-4 mt-4">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_incomeinfo_salary" class="form-label"
                  >الراتب<span style="color: red">*</span></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="incomeinfo_salary"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_incomeinfo_salary"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_incomeinfo_social_insurance" class="form-label"
                  >التأمينات الاجتماعية<span style="color: red">*</span></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="incomeinfo_social_insurance"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_incomeinfo_social_insurance"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_incomeinfo_charity" class="form-label"
                  >جمعيات خيرية<span style="color: red">*</span></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="incomeinfo_charity"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_incomeinfo_charity"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_incomeinfo_social_warranty" class="form-label"
                  >الضمان الاجتماعي<span style="color: red">*</span></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="incomeinfo_social_warranty"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_incomeinfo_social_warranty"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
            </div>
            <div class="row row-cols-md-2 row-cols-xl-4">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_incomeinfo_pension_agency" class="form-label"
                  >مصلحة التقاعد<span style="color: red">*</span></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="incomeinfo_pension_agency"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_incomeinfo_pension_agency"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_incomeinfo_citizen_account" class="form-label"
                  >حساب المواطن<span style="color: red">*</span></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="incomeinfo_citizen_account"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_incomeinfo_citizen_account"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_incomeinfo_benefactor" class="form-label"
                  >فاعل خير<span style="color: red"
                  >*</span
                ></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="incomeinfo_benefactor"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_incomeinfo_benefactor"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_incomeinfo_other" class="form-label">أخرى<span style="color: red"
                  >*</span
                ></label>
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="incomeinfo_other"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_incomeinfo_other"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col mb-4 form-group">
                <label for="id_incomeinfo_total" class="form-label"
                  >إجمالي الدخل</label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="incomeinfo_total"
                    min="0.00"
                    max="99999999.00"
                    step="0.01"
                    class="form-control"
                    id="id_incomeinfo_total"
                    disabled
                    readonly
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
            </div>

            <hr />

            <h4 class="font-normal">مصروفات الأسرة (شهريًا)</h4>
            <div
              class="alert alert-warning mt-3"
              role="alert"
              id="checkboxError"
            >
              الرجاء ادخال مصروفات الأسرة ادناه, وفي حال عدم وجود الدخل المسمى, يرجى ادخال قيمة صفر (0)
            </div>
            <div class="row row-cols-md-2 row-cols-xl-4 mt-4">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_expensesinfo_housing_rent" class="form-label"
                  >إيجار السكن<span style="color: red">*</span></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="expensesinfo_housing_rent"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_expensesinfo_housing_rent"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label
                  for="id_expensesinfo_electricity_bills"
                  class="form-label"
                  >فواتير كهرباء<span style="color: red">*</span></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="expensesinfo_electricity_bills"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_expensesinfo_electricity_bills"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_expensesinfo_water_bills" class="form-label"
                  >فواتير ماء<span style="color: red">*</span></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="expensesinfo_water_bills"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_expensesinfo_water_bills"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_expensesinfo_transportation" class="form-label"
                  >مواصلات<span style="color: red">*</span></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="expensesinfo_transportation"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_expensesinfo_transportation"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
            </div>
            <div class="row row-cols-md-2 row-cols-xl-4">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_expensesinfo_health_supplies" class="form-label"
                  >مستلزمات صحية<span style="color: red">*</span></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="expensesinfo_health_supplies"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_expensesinfo_health_supplies"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_expensesinfo_food_supplies" class="form-label"
                  >مستلزمات غذائية<span style="color: red">*</span></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="expensesinfo_food_supplies"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_expensesinfo_food_supplies"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label
                  for="id_expensesinfo_educational_supplies"
                  class="form-label"
                  >مستلزمات دراسية<span style="color: red">*</span></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="expensesinfo_educational_supplies"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_expensesinfo_educational_supplies"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_expensesinfo_proven_debts" class="form-label"
                  >ديون مثبتة<span style="color: red"
                  >*</span
                ></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="expensesinfo_proven_debts"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_expensesinfo_proven_debts"
                    oninput="provenDebtValueCheck(this);"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_expensesinfo_other" class="form-label"
                  >أخرى<span style="color: red"
                  >*</span
                ></label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="expensesinfo_other"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_expensesinfo_other"
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_expensesinfo_total" class="form-label"
                  >إجمالي المصروفات</label
                >
                <div class="input-group mb-3">
                  <input
                    type="number"
                    name="expensesinfo_total"
                    min="0.00"
                    max="99999999.00"
                    class="form-control"
                    id="id_expensesinfo_total"
                    disabled
                    readonly
                  />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
            </div>

            <hr />

            <div class="row mt-3">
              <div class="col-md-6 mb-4 form-group">
                <label class="form-label"
                  >المشكلات التي تعاني منها الأسرة<span style="color: red"
                    >*</span
                  > <span style="font-size: 0.9rem">
                    (إختيار متعدد)</span
                  ></label
                >
                  <div
                    name="familyinfo_family_issues"
                    class="d-grid gap-2"
                    style="grid-template-columns: 1fr 1fr;"
                    id="id_familyinfo_family_issues"
                  >
                    <input type="checkbox" class="btn-check" id="id_familyinfo_issues_economical" autocomplete="off" name="familyinfo_issues_economical" value="اقتصادية">
                    <label class="btn btn-outline-primary" for="id_familyinfo_issues_economical">اقتصادية</label>

                    <input type="checkbox" class="btn-check" id="id_familyinfo_issues_educational" autocomplete="off" name="familyinfo_issues_educational" value="تعليمية">
                    <label class="btn btn-outline-primary" for="id_familyinfo_issues_educational">تعليمية</label>

                    <input type="checkbox" class="btn-check" id="id_familyinfo_issues_employment" autocomplete="off" name="familyinfo_issues_employment" value="توظيف">
                    <label class="btn btn-outline-primary" for="id_familyinfo_issues_employment">توظيف</label>

                    <input type="checkbox" class="btn-check" id="id_familyinfo_issues_sponsorship" autocomplete="off" name="familyinfo_issues_sponsorship" value="كفالة">
                    <label class="btn btn-outline-primary" for="id_familyinfo_issues_sponsorship">كفالة</label>

                    <input type="checkbox" class="btn-check" id="id_familyinfo_issues_healthy" autocomplete="off" name="familyinfo_issues_healthy" value="صحية">
                    <label class="btn btn-outline-primary" for="id_familyinfo_issues_healthy">صحية</label>
                  </div>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label class="form-label"
                  >نوع الاحتياج<span style="color: red">*</span> <span style="font-size: 0.9rem">
                    (إختيار متعدد)</span
                  ></label
                >
                <div
                  name="familyinfo_needs_type"
                  class="d-grid gap-2"
                  style="grid-template-columns: 1fr 1fr;"
                  id="id_familyinfo_needs_type"
                >
                  <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_food_baskets" autocomplete="off" name="familyinfo_needs_type_food_baskets" value="سلال غذائية">
                  <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_food_baskets">سلال غذائية</label>

                  <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_clothing" autocomplete="off" name="familyinfo_needs_type_clothing" value="كسوة">
                  <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_clothing">كسوة</label>

                  <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_school_bags"  autocomplete="off" name="familyinfo_needs_type_school_bags" value="حقائب مدرسية">
                  <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_school_bags">حقائب مدرسية</label>

                  <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_water_filters"  autocomplete="off" name="familyinfo_needs_type_water_filters" value="فلاتر مياه">
                  <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_water_filters">فلاتر مياه</label>

                  <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_rent_payment"  autocomplete="off" name="familyinfo_needs_type_rent_payment" value="سداد إيجار">
                  <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_rent_payment">سداد إيجار</label>

                  <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_electricity_payment"  autocomplete="off" name="familyinfo_needs_type_electricity_payment" value="سداد كهرباء">
                  <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_electricity_payment">سداد كهرباء</label>

                  <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_dept_payment" autocomplete="off" name="familyinfo_needs_type_dept_payment" value="سداد دين">
                  <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_dept_payment">سداد دين</label>

                  <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_training"  autocomplete="off" name="familyinfo_needs_type_training" value="تدريب">
                  <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_training">تدريب</label>

                  <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_electronic_devices" autocomplete="off" name="familyinfo_needs_type_electronic_devices" value="أجهزة كهربائية">
                  <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_electronic_devices">أجهزة كهربائية</label>

                  <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_furniture" autocomplete="off" name="familyinfo_needs_type_furniture" value="أثاث">
                  <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_furniture">أثاث</label>

                  <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_home_renovation" autocomplete="off" name="familyinfo_needs_type_home_renovation" value="ترميم">
                  <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_home_renovation">ترميم</label>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_beneficiaryinfo_iban" class="form-label"
                  >الحساب البنكي للمستفيد<span style="color: red">*</span>
                  (IBAN)</label
                >
                <input
                  type="text"
                  name="beneficiaryinfo_iban"
                  maxlength="50"
                  class="form-control"
                  id="id_beneficiaryinfo_iban"
                  placeholder=""
                />
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_beneficiaryinfo_bank" class="form-label"
                  >البنك<span style="color: red">*</span></label
                >
                <select
                  name="beneficiaryinfo_bank"
                  class="form-select"
                  id="id_beneficiaryinfo_bank"
                >
                  <option value selected>---------</option>
                  <option value="الأهلي السعودي">الأهلي السعودي</option>
                  <option value="الراجحي">الراجحي</option>
                  <option value="الجزيرة">الجزيرة</option>
                  <option value="الإنماء">الإنماء</option>
                  <option value="البلاد">البلاد</option>
                  <option value="الرياض">الرياض</option>
                  <option value="ساب">ساب</option>
                  <option value="السعودي الفرنسي">السعودي الفرنسي</option>
                  <option value="العربي">العربي</option>
                  <option value="مسقط">مسقط</option>
                  <option value="الإمارات دبي الوطني">الإمارات دبي الوطني</option>
                  <option value="الخليج الدولي">الخليج الدولي</option>
                  <option value="البحرين الوطني">البحرين الوطني</option>
                  <option value="الكويت الوطني">الكويت الوطني</option>
                  <option value="باكستان الوطني">باكستان الوطني</option>
                  <option value="الأول">الأول</option>
                  <option value="السعودي للاستثمار">السعودي للاستثمار</option>
                  <option value="زراعات">زراعات</option>
                  <option value="أخرى">أخرى</option>
                </select>
              </div>
            </div>

            <hr />
          </div>
          <div class="mt-3 d-flex column-gap-2 d-lg-block">
            <button
              class="col button btn-navigate-form-step previous"
              type="button"
              step_number="2"
            >
              السابق
            </button>
            <button
              class="col button btn-navigate-form-step next"
              type="button"
              step_number="4"
            >
              التالي
            </button>
          </div>
        </fieldset>
        <!-- Step 4 Content, default hidden on page load. -->
        <fieldset id="attachments_information" class="form-step px-3 px-lg-5">
          <h2 class="fs-2 fw-bold mb-5">المرفقات</h2>
          <!-- Step 4 input fields -->
          <div class="row mt-3">

            <div
              class="alert alert-warning mt-3"
              role="alert"
              id="checkboxError"
            >
              جميع المرفقات ادناه مطلوبة وهي إلزامية لإكمال الطلب
            </div>

            <div class="col-12 col-lg-6 row-gap-3 mb-3 mt-2">

              <div class="mb-4 row column-gap-4 fileInputContainer">
                <div class="col d-flex flex-column">
                  <label class="form-label" id="id_beneficiaryNationalIDTitle"
                    >صورة الهوية الوطنية/الإقامة<span style="color: red">*</span></label
                  >
                  <div
                    class="col text-muted"
                    id="id_fileNamesBeneficiaryNationalID"
                  ></div>
                  <!--- Place of showing file names -->
                </div>
                <div class="col-4 d-flex justify-content-center">
                  <label
                    class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                    for="id_formFileBeneficiaryNationalID"
                    >إرفاق ملف</label
                  >
                </div>
                <input
                  class="form-control d-none"
                  type="file"
                  id="id_formFileBeneficiaryNationalID"
                  name="fileBeneficiaryNationalID"
                  accept="application/pdf,image/png, image/jpg, image/jpeg"
                />
              </div>

              <hr />

              <div class="mb-4 row column-gap-4 fileInputContainer">
                <div class="col d-flex flex-column">
                  <label class="form-label">العنوان الوطني<span style="color: red">*</span></label>
                  <div
                    class="col text-muted"
                    id="id_fileNamesNationalAddress"
                  ></div>
                  <!--- Place of showing file names -->
                </div>
                <div class="col-4 d-flex justify-content-center">
                  <label
                    class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                    for="id_formFileBeneficiaryNationalAddress"
                    >إرفاق ملف</label
                  >
                </div>
                <input
                  class="form-control d-none"
                  type="file"
                  id="id_formFileBeneficiaryNationalAddress"
                  name="fileBeneficiaryNationalAddress"
                  accept="application/pdf,image/png, image/jpg, image/jpeg"
                />
              </div>

              <hr />

              <div class="mb-4 row column-gap-4 fileInputContainer">
                <div class="col d-flex flex-column">
                  <label class="form-label">صك الدين<span style="color: red">*</span> (في حال وجود دين)</label>
                  <div
                    class="col text-muted"
                    id="id_fileNamesDeptInstrument"
                  ></div>
                  <!--- Place of showing file names -->
                </div>
                <div class="col-4 d-flex justify-content-center">
                  <label
                    class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                    for="id_formFileDeptInstrument"
                    >إرفاق ملفات</label
                  >
                </div>
                <input
                  class="form-control d-none"
                  type="file"
                  id="id_formFileDeptInstrument"
                  name="fileDeptInstrument"
                  accept="application/pdf,image/png, image/jpg, image/jpeg"
                  multiple
                />
              </div>

              <hr />

              <div
                class="mb-4 row column-gap-4 fileInputContainer"
                id="id_attachmentPensionOrSocialInsuranceInquiry_group_info"
                style="display: none"
              >
                <div class="col d-flex flex-column">
                  <label
                    class="form-label"
                    id="id_PensionOrSocialInsuranceInquiryTitle"
                    >مشهد التقاعد أو التأمينات الاجتماعية<span style="color: red">*</span></label
                  >
                  <div
                    class="col text-muted"
                    id="id_fileNamesPensionOrSocialInsuranceInquiry"
                  ></div>
                  <!--- Place of showing file names -->
                </div>
                <div class="col-4 d-flex justify-content-center">
                  <label
                    class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                    for="id_formFilePensionOrSocialInsuranceInquiry"
                    >إرفاق ملفات</label
                  >
                </div>
                <input
                  class="form-control d-none"
                  type="file"
                  id="id_formFilePensionOrSocialInsuranceInquiry"
                  name="filePensionOrSocialInsuranceInquiry"
                  accept="application/pdf,image/png, image/jpg, image/jpeg"
                  multiple
                />
              </div>

              <hr
                id="id_attachmentPensionOrSocialInsuranceInquiry_group_info_hr"
                style="display: none"
              />

              <div
                class="mb-4 row column-gap-4 fileInputContainer"
                id="id_attachmentFatherOrHusbandDeathCertificate_group_info"
                style="display: none"
              >
                <div class="col d-flex flex-column">
                  <label class="form-label">شهادة الوفاة للزوج / الأب<span style="color: red">*</span></label>
                  <div
                    class="col text-muted"
                    id="id_fileNamesFatherOrHusbandDeathCertificate"
                  ></div>
                  <!--- Place of showing file names -->
                </div>
                <div class="col-4 d-flex justify-content-center">
                  <label
                    class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                    for="id_formFileFatherOrHusbandDeathCertificate"
                    >إرفاق ملف</label
                  >
                </div>
                <input
                  class="form-control d-none"
                  type="file"
                  id="id_formFileFatherOrHusbandDeathCertificate"
                  name="fileFatherOrHusbandDeathCertificate"
                  accept="application/pdf,image/png, image/jpg, image/jpeg"
                />
              </div>

              <hr
                id="id_attachmentFatherOrHusbandDeathCertificate_group_info_hr"
                style="display: none"
              />

              <div
                class="mb-4 row column-gap-4 fileInputContainer"
                id="id_attachmentLetterFromPrison_group_info"
                style="display: none"
              >
                <div class="col d-flex flex-column">
                  <label class="form-label"
                    >خطاب من السجن<span style="color: red">*</span> (في حال أسرة سجين)</label
                  >
                  <div
                    class="col text-muted"
                    id="id_fileNamesLetterFromPrison"
                  ></div>
                  <!--- Place of showing file names -->
                </div>
                <div class="col-4 d-flex justify-content-center">
                  <label
                    class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                    for="id_formFileLetterFromPrison"
                    >إرفاق ملفات</label
                  >
                </div>
                <input
                  class="form-control d-none"
                  type="file"
                  id="id_formFileLetterFromPrison"
                  name="fileLetterFromPrison"
                  accept="application/pdf,image/png, image/jpg, image/jpeg"
                  multiple
                />
              </div>

              <hr
                id="id_attachmentLetterFromPrison_group_info_hr"
                style="display: none"
              />

              <div
                class="mb-4 row column-gap-4 fileInputContainer"
                id="id_attachmentDivorceDeed_group_info"
                style="display: none"
              >
                <div class="col d-flex flex-column">
                  <label class="form-label">صك الطلاق<span style="color: red">*</span></label>
                  <div
                    class="col text-muted"
                    id="id_fileNamesDivorceDeed"
                  ></div>
                  <!--- Place of showing file names -->
                </div>
                <div class="col-4 d-flex justify-content-center">
                  <label
                    class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                    for="id_formFileDivorceDeed"
                    >إرفاق ملف</label
                  >
                </div>
                <input
                  class="form-control d-none"
                  type="file"
                  id="id_formFileDivorceDeed"
                  name="fileDivorceDeed"
                  accept="application/pdf,image/png, image/jpg, image/jpeg"
                />
              </div>

              <hr
                id="id_attachmentDivorceDeed_group_info_hr"
                style="display: none"
              />

              <div
                class="mb-4 row column-gap-4 fileInputContainer"
                id="id_attachmentChildrenResponsibilityDeed_group_info"
                style="display: none"
              >
                <div class="col d-flex flex-column">
                  <label class="form-label"
                    >صك إعالة الأبناء<span style="color: red">*</span> (في حال كانوا مرافقين)</label
                  >
                  <div
                    class="col text-muted"
                    id="id_fileNamesChildrenResponsibilityDeed"
                  ></div>
                  <!--- Place of showing file names -->
                </div>
                <div class="col-4 d-flex justify-content-center">
                  <label
                    class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                    for="id_formFileChildrenResponsibilityDeed"
                    >إرفاق ملفات</label
                  >
                </div>
                <input
                  class="form-control d-none"
                  type="file"
                  id="id_formFileChildrenResponsibilityDeed"
                  name="fileChildrenResponsibilityDeed"
                  accept="application/pdf,image/png, image/jpg, image/jpeg"
                  multiple
                />
              </div>

              <hr
                id="id_attachmentChildrenResponsibilityDeed_group_info_hr"
                style="display: none"
              />

              <div class="mb-4 row column-gap-4 fileInputContainer">
                <div class="col d-flex flex-column">
                  <label class="form-label">إرفاق مستندات أخرى<span style="color: red">*</span></label>
                  <div class="col text-muted" id="id_fileNamesOther"></div>
                  <!--- Place of showing file names -->
                </div>
                <div class="col-4 d-flex justify-content-center">
                  <label
                    class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                    for="id_formFileOther"
                    >إرفاق ملفات</label
                  >
                </div>
                <input
                  class="form-control d-none"
                  type="file"
                  id="id_formFileOther"
                  name="fileOther"
                  accept="application/pdf,image/png, image/jpg, image/jpeg"
                  multiple
                />
              </div>

              <hr />
            </div>

            <div class="col-12 col-lg-6 row-gap-3 mb-3 mt-2">

              <div class="mb-4 row column-gap-4 fileInputContainer">
                <div class="col d-flex flex-column">
                  <label class="form-label"
                    >عقد الإيجار الالكتروني من منصة إيجار أو صك ملكية<span style="color: red">*</span></label
                  >
                  <div
                    class="col text-muted"
                    id="id_fileNamesLeaseContractOrTitleDeed"
                  ></div>
                  <!--- Place of showing file names -->
                </div>
                <div class="col-4 d-flex justify-content-center">
                  <label
                    class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                    for="id_formFileLeaseContractOrTitleDeed"
                    >إرفاق ملفات</label
                  >
                </div>
                <input
                  class="form-control d-none"
                  type="file"
                  id="id_formFileLeaseContractOrTitleDeed"
                  name="fileLeaseContractOrTitleDeed"
                  accept="application/pdf,image/png, image/jpg, image/jpeg"
                  multiple
                />
              </div>

              <hr />

              <div class="mb-4 row column-gap-4 fileInputContainer">
                <div class="col d-flex flex-column">
                  <label class="form-label">الفواتير<span style="color: red">*</span> (كهرباء - ماء)</label>
                  <div
                    class="col text-muted"
                    id="id_fileNamesWaterOrElectricityBills"
                  ></div>
                  <!--- Place of showing file names -->
                </div>
                <div class="col-4 d-flex justify-content-center">
                  <label
                    class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                    for="id_formFileWaterOrElectricityBills"
                    >إرفاق ملفات</label
                  >
                </div>
                <input
                  class="form-control d-none"
                  type="file"
                  id="id_formFileWaterOrElectricityBills"
                  name="fileWaterOrElectricityBills"
                  accept="application/pdf,image/png, image/jpg, image/jpeg"
                  multiple
                />
              </div>

              <hr />

              <div
                class="mb-4 row column-gap-4 fileInputContainer"
                id="id_attachmentNationalIDForBeneficiaryForDependents_group_info"
                style="display: none"
              >
                <div class="col d-flex flex-column">
                  <label
                    class="form-label"
                    id="id_NationalIDForBeneficiaryForDependentsTitle"
                    >صورة الهوية الوطنية/الإقامة للمرافقين<span style="color: red">*</span></label
                  >
                  <div
                    class="col text-muted"
                    id="id_fileNamesNationalIDForBeneficiaryForDependents"
                  ></div>
                  <!--- Place of showing file names -->
                </div>
                <div class="col-4 d-flex justify-content-center">
                  <label
                    class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                    for="id_formFileNationalIDForBeneficiaryForDependents"
                    >إرفاق ملفات</label
                  >
                </div>
                <input
                  class="form-control d-none"
                  type="file"
                  id="id_formFileNationalIDForBeneficiaryForDependents"
                  name="fileNationalIDForBeneficiaryDependents"
                  accept="application/pdf,image/png, image/jpg, image/jpeg"
                  multiple
                />
              </div>

              <hr
                id="id_attachmentNationalIDForBeneficiaryForDependents_group_info_hr"
                style="display: none"
              />

              <div
                class="mb-4 row column-gap-4 fileInputContainer"
                id="id_attachmentSocialWarrantyInquiry_group_info"
                style="display: none"
              >
                <div class="col d-flex flex-column">
                  <label class="form-label" id="id_SocialWarrantyInquiryTitle"
                    >مشهد الضمان الاجتماعي<span style="color: red">*</span></label
                  >
                  <div
                    class="col text-muted"
                    id="id_fileNamesSocialWarrantyInquiry"
                  ></div>
                  <!--- Place of showing file names -->
                </div>
                <div class="col-4 d-flex justify-content-center">
                  <label
                    class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                    for="id_formFileSocialWarrantyInquiry"
                    >إرفاق ملفات</label
                  >
                </div>
                <input
                  class="form-control d-none"
                  type="file"
                  id="id_formFileSocialWarrantyInquiry"
                  name="fileSocialWarrantyInquiry"
                  accept="application/pdf,image/png, image/jpg, image/jpeg"
                  multiple
                />
              </div>

              <hr
                id="id_attachmentSocialWarrantyInquiry_group_info_hr"
                style="display: none"
              />
            </div>
          </div>
          <div class="mt-3 d-flex column-gap-2 d-lg-block">
            <button
              class="col button btn-navigate-form-step previous"
              type="button"
              step_number="3"
            >
              السابق
            </button>
            <button
              class="col button btn-navigate-form-step next"
              type="button"
              step_number="5"
            >
              التالي
            </button>
          </div>
        </fieldset>

        <fieldset id="submit_confirmation" class="form-step px-3 px-lg-5">
          <h2 class="fs-2 fw-bold mb-5">تقديم الطلب</h2>
          <!-- Step 5 input fields -->
          <div class="mt-3">
            <div class="alert alert-primary" role="alert" id="checkboxError">
              يرجى الموافقة على جميع الشروط قبل تقديم الطلب.
            </div>
            <ul class="list-group">
              <li class="list-group-item d-flex gap-2">
                <input
                  class="form-check-input me-1"
                  type="checkbox"
                  value=""
                  id="id_agreement1"
                  name="agreement1"
                />
                <p class="form-check-label" for="id_agreement1">
                  أتعهد بأن كافة البيانات والمعلومات سواء الفنية أو المالية أو
                  القانونية وغيرها التي قدمتها في هذا الطلب جميعها صحيحة لا لبس
                  فيها ولا تحريف ولا تحوير وتطابق صحيح الواقع والقانون.
                </p>
              </li>
              <li class="list-group-item d-flex gap-2">
                <input
                  class="form-check-input me-1"
                  type="checkbox"
                  value=""
                  id="id_agreement2"
                  name="agreement2"
                />
                <p class="form-check-label" for="id_agreement2">
                  أقر بالتزامي ومسؤوليتي الكاملة عن عدم صحة كل أو بعض هذه
                  البيانات والمعلومات أو عن الخطأ أو النقص أو عدم الدقة.
                </p>
              </li>
              <li class="list-group-item d-flex gap-2">
                <input
                  class="form-check-input me-1"
                  type="checkbox"
                  value=""
                  id="id_agreement3"
                  name="agreement3"
                />
                <p class="form-check-label" for="id_agreement3">
                  أقبل النتائج المترتبة عن كافة هذه الأمور بما فيها استبعادي من
                  الجمعية.
                </p>
              </li>
              <li class="list-group-item d-flex gap-2">
                <input
                  class="form-check-input me-1"
                  type="checkbox"
                  value=""
                  id="id_agreement4"
                  name="agreement4"
                />
                <p class="form-check-label" for="id_agreement4">
                  أوافق على قيام الجمعية في حال قبول طلبي بعمل بحث ميداني عن
                  حالتي.
                </p>
              </li>
            </ul>
          </div>
          <div class="mt-5 d-flex column-gap-2 d-lg-block">
            <button
              class="col button btn-navigate-form-step previous"
              type="button"
              step_number="4"
            >
              السابق
            </button>
            <button
              class="col button submit-btn next"
              id="submit-btn"
              type="submit"
              disabled
            >
              تقديم الطلب
            </button>
          </div>
        </fieldset>
      </form>
    </div>
  </div>
</div>
<!-- Edit Modal -->
<div
  class="modal fade"
  id="editModal"
  tabindex="-1"
  aria-labelledby="editModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel">تعديل معلومات المرافق</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body bg-light">
        <!-- Loading state content -->
        <div id="loadingStateEditModal" style="display: none; text-align: center;">
          <div class="spinner-border text-primary mt-5" role="status">
            <span class="sr-only visually-hidden">Loading...</span>
          </div>
          <p>Loading...</p>
        </div>

        <!-- Actual modal content -->
        <div id="editModalContent" style="display: none;">
          <form
            id="editModalForm"
            name="editModalForm"
            method="POST"
            action="/handle_test2"
            class="needs-validation"
            novalidate
          >
            {% csrf_token %}
            <div class="row row-cols-md-2 row-cols-xl-4">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_dependent_edit_info_first_name" class="form-label"
                  >الأسم الأول<span style="color: red">*</span
                  ></label
                >
                <input
                  type="text"
                  id="id_dependent_edit_info_first_name"
                  class="form-control"
                  name="dependent_edit_info_first_name"
                />
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_dependent_edit_info_second_name" class="form-label"
                  >الأسم الثاني<span style="color: red">*</span
                  ></label
                >
                <input
                  type="text"
                  id="id_dependent_edit_info_second_name"
                  class="form-control"
                  name="dependent_edit_info_second_name"
                />
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_dependent_edit_info_last_name" class="form-label"
                  >الأسم الأخير<span style="color: red">*</span
                  ><span style="font-size: 0.9rem">
                    (أسم العائلة)</span
                  ></label
                >
                <input
                  type="text"
                  id="id_dependent_edit_info_last_name"
                  class="form-control"
                  name="dependent_edit_info_last_name"
                />
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label
                  for="id_dependent_edit_info_date_of_birth"
                  class="form-label"
                  >تاريخ الميلاد<span style="color: red">*</span></label
                >
                <input
                  type="date"
                  class="form-control"
                  id="id_dependent_edit_info_date_of_birth"
                  maxlength="55"
                  name="dependent_edit_info_date_of_birth"
                />
              </div>
            </div>

            <hr>

            <div class="row row-cols-md-2 row-cols-xl-3">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_dependent_edit_info_gender" class="form-label"
                  >الجنس<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_gender"
                  class="form-select"
                  id="id_dependent_edit_info_gender"
                >
                  <option value selected>---------</option>
                  <option value="ذكر">ذكر</option>
                  <option value="انثى">انثى</option>
                </select>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_dependent_edit_info_relationship" class="form-label"
                  >صلة القرابة<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_relationship"
                  class="form-select"
                  id="id_dependent_edit_info_relationship"
                >
                  <option value selected>---------</option>
                  <option value="ابن">ابن</option>
                  <option value="ابنة">ابنة</option>
                  <option value="أخ">أخ</option>
                  <option value="أخت">أخت</option>
                  <option value="زوج/ـة">زوج/ـة</option>
                  <option value="خال/ـة">خال/ـة</option>
                  <option value="عم/ـة">عم/ـة</option>
                  <option value="جد/ـة">جد/ـة</option>
                </select>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label
                  for="id_dependent_edit_info_marital_status"
                  class="form-label"
                  >الحالة الاجتماعية<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_marital_status"
                  class="form-select"
                  id="id_dependent_edit_info_marital_status"
                >
                  <option value selected>---------</option>
                  <option value="طالب/ـة">طالب/ـة</option>
                  <option value="طفل/ـة">طفل/ـة</option>
                  <option value="ربة منزل">ربة منزل</option>
                  <option value="متزوج/ـة">متزوج/ـة</option>
                  <option value="أعزب/ـة">أعزب/ـة</option>
                  <option value="أرملة/ـة">أرمل/ـة</option>
                  <option value="مطلقة">مطلقة</option>
                  <option value="مهجورة">مهجورة</option>
                </select>
              </div>
            </div>

            <hr />

            <div class="row row-cols-md-2">
              <div class="col-md-6 mb-4 form-group">
                <label
                  for="id_dependent_edit_info_educational_status"
                  class="form-label"
                  >الحالة الدراسية<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_educational_status"
                  class="form-select"
                  id="id_dependent_edit_info_educational_status"
                  onchange="educationalStatusEditInfoCheck(this);"
                >
                  <option value selected>---------</option>
                  <option value="يدرس">يدرس</option>
                  <option value="لا يدرس">لا يدرس</option>
                </select>
              </div>
              <div class="col-md-6 mb-4 form-group" style="display: none;" id="id_dependent_edit_info_educational_level_group_info">
                <label
                  for="id_dependent_edit_info_educational_level"
                  class="form-label"
                  >المرحلة الدراسية<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_educational_level"
                  class="form-select"
                  id="id_dependent_edit_info_educational_level"
                >
                  <option value selected>---------</option>
                  <option value="أول ابتدائي">أول ابتدائي</option>
                  <option value="ثاني ابتدائي">ثاني ابتدائي</option>
                  <option value="ثالث ابتدائي">ثالث ابتدائي</option>
                  <option value="رابع ابتدائي">رابع ابتدائي</option>
                  <option value="خامس ابتدائي">خامس ابتدائي</option>
                  <option value="سادس ابتدائي">سادس ابتدائي</option>
                  <option value="اول متوسط">اول متوسط</option>
                  <option value="ثاني متوسط">ثاني متوسط</option>
                  <option value="ثالث متوسط">ثالث متوسط</option>
                  <option value="اول ثانوي">اول ثانوي</option>
                  <option value="ثاني ثانوي">ثاني ثانوي</option>
                  <option value="ثالث ثانوي">ثالث ثانوي</option>
                  <option value="جامعي">جامعي</option>
                </select>
              </div>
              <div class="col-md-6 mb-4 form-group" style="display: none;" id="id_dependent_edit_info_educational_degree_group_info">
                <label
                  for="id_dependent_edit_info_educational_degree"
                  class="form-label"
                  >المؤهل التعليمي<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_educational_degree"
                  class="form-select"
                  id="id_dependent_edit_info_educational_degree"
                >
                  <option value selected>---------</option>
                  <option value="لا يوجد">لا يوجد</option>
                  <option value="ابتدائي">ابتدائي</option>
                  <option value="متوسط">متوسط</option>
                  <option value="ثانوي">ثانوي</option>
                  <option value="جامعي">جامعي</option>
                </select>
              </div>
            </div>

            <hr />

            <div class="row">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_dependent_edit_info_national_id" class="form-label"
                  >رقم الهوية الوطنية \ الإقامة<span style="color: red"
                  >*</span
                ></label
                >
                <input
                  type="text"
                  class="form-control"
                  id="id_dependent_edit_info_national_id"
                  maxlength="20"
                  name="dependent_edit_info_national_id"
                />
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label
                  for="id_dependent_edit_info_national_id_exp_date"
                  class="form-label"
                  >تاريخ انتهاء الهوية \ الإقامة<span style="color: red"
                  >*</span
                ></label
                >
                <input
                  type="date"
                  class="form-control"
                  id="id_dependent_edit_info_national_id_exp_date"
                  name="dependent_edit_info_national_id_exp_date"
                />
              </div>
            </div>

            <hr />

            <h4 class="mb-4">مصادر الدخل</h4>
                <div class="row row-cols-xl-3 justify-content-center">
                  <div class="col-md-4 mb-2 form-group">
                    <label for="id_dependent_edit_info_monthly_income" class="form-label">دخل المرافق (شهريا)</label>
                    <div class="input-group mb-3">
                      <input type="number" name="dependent_edit_info_monthly_income" max="9999999999999999" min="0" class="form-control" id="id_dependent_edit_info_monthly_income" />
                      <span class="input-group-text" id="basic-addon1">ر.س.</span>
                    </div>
                  </div>
                  <div class="col-md-4 col-lg-5 mb-2 form-group">
                    <label for="id_dependent_edit_info_income_source" class="form-label">مصدر الدخل للمرافق</label>
                    <select name="dependent_edit_info_income_source" class="form-select" id="id_dependent_edit_info_income_source">
                      <option value selected>---------</option>
                      <option value="الراتب">الراتب</option>
                      <option value="التأمينات الاجتماعية">التأمينات الاجتماعية</option>
                      <option value="الضمان الاجتماعي">الضمان الاجتماعي</option>
                      <option value="مصلحة التقاعد">مصلحة التقاعد</option>
                      <option value="حساب المواطن">حساب المواطن</option>
                      <option value="التأهيل الشامل">التأهيل الشامل</option>
                      <option value="جمعية خيرية">جمعية خيرية</option>
                      <option value="فاعل خير">فاعل خير</option>
                      <option value="اخرى">اخرى</option>
                    </select>
                  </div>
                  <div class="col-md-4 col-lg-3 mb-sm-5 mb-md-3 mb-3 mt-4 row justify-content-center align-items-center" id="id_add_row_edit_income_table">
                    <button type="button" class="btn btn-primary" id="id_add_row_income_edit_info" onclick="addRowToIncomeEditInfoTable()">إضافة مصدر الدخل</button>
                  </div>
                </div>
                
                {% comment %} Dependent Income Table {% endcomment %}
                <table class="table table-striped table-hover mb-5" id="incomeEditInfoTable">
                  <thead>
                    <tr>
                      <th scope="col">دخل المرافق الشهري (ر.س.)</th>
                      <th scope="col">مصدر الدخل</th>
                      <th scope="col">الإجراءات</th>
                    </tr>
                  </thead>
                  <tbody id="incomeEditInfoTableBody"></tbody>
                </table>

            <hr />

            <div class="row">
              <div class="col-md-6 mb-4 form-group">
                <label
                  for="id_dependent_edit_info_health_status"
                  class="form-label"
                  >الحالة الصحية<span style="color: red"
                  >*</span
                ></label
                >
                <select
                  name="dependent_edit_info_health_status"
                  class="form-select"
                  id="id_dependent_edit_info_health_status"
                  onchange="dependentEditInfoHealthCheck(this);"
                >
                  <option value selected>---------</option>
                  <option value="جيدة">جيدة</option>
                  <option value="غير جيدة">غير جيدة</option>
                </select>
              </div>
              <div
                class="col-md-6 mb-4 form-group"
                id="id_dependent_edit_info_disease_type_group_info"
                style="display: none"
              >
                <label
                  for="id_dependent_edit_info_disease_type"
                  class="form-label"
                  >نوع المرض<span style="color: red"
                  >*</span
                > (عند اختيار غير جيدة)</label
                >
                <input
                  type="text"
                  name="dependent_edit_info_disease_type"
                  maxlength="100"
                  class="form-control"
                  id="id_dependent_edit_info_disease_type"
                />
              </div>
            </div>

            <hr />

            <div class="row">
              <div class="col-md-12 mb-4 form-group">
                <label class="form-label"
                  >نوع الاحتياج للمرافق<span style="color: red"
                    >*</span
                  > <span style="font-size: 0.9rem">
                    (إختيار متعدد)</span
                  ></label
                >
                <div
                  name="dependent_edit_info_needs_type"
                  class="d-grid gap-2"
                  style="grid-template-columns: 1fr 1fr 1fr;"
                  id="id_dependent_edit_info_needs_type"
                >
                  <input type="checkbox" class="btn-check" id="id_dependent_edit_info_needs_type_economical" autocomplete="off" name="dependent_edit_info_needs_type_economical" value="اقتصادي">
                  <label class="btn btn-outline-primary" for="id_dependent_edit_info_needs_type_economical">اقتصادي</label>

                  <input type="checkbox" class="btn-check" id="id_dependent_edit_info_needs_type_educational" autocomplete="off" name="dependent_edit_info_needs_type_educational" value="تعليمي">
                  <label class="btn btn-outline-primary" for="id_dependent_edit_info_needs_type_educational">تعليمي</label>

                  <input type="checkbox" class="btn-check" id="id_dependent_edit_info_needs_type_employment" autocomplete="off" name="dependent_edit_info_needs_type_employment" value="توظيف">
                  <label class="btn btn-outline-primary" for="id_dependent_edit_info_needs_type_employment">توظيف</label>

                  <input type="checkbox" class="btn-check" id="id_dependent_edit_info_needs_type_sponsorship" autocomplete="off" name="dependent_edit_info_needs_type_sponsorship" value="كفالة">
                  <label class="btn btn-outline-primary" for="id_dependent_edit_info_needs_type_sponsorship">كفالة</label>

                  <input type="checkbox" class="btn-check" id="id_dependent_edit_info_needs_type_healthy" autocomplete="off" name="dependent_edit_info_needs_type_healthy" value="صحي">
                  <label class="btn btn-outline-primary" for="id_dependent_edit_info_needs_type_healthy">صحي</label>
                </div>
              </div>
              <div class="col-md-12 mb-4 form-group">
                <label
                  for="id_dependent_edit_info_needs_description"
                  class="form-label"
                  >وصف الاحتياج</label
                >
                <textarea
                  type="textarea"
                  class="form-control"
                  id="id_dependent_edit_info_needs_description"
                  name="dependent_edit_info_needs_description"
                  maxlength="2000"
                  rows="5"
                ></textarea>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          إلغاء
        </button>
        <button
          type="button"
          class="btn btn-primary savechangesofedit"
          id="saveChanges"
          disabled
        >
          حفظ التغييرات
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Confirmation Modal -->

<script>
  $(document).ready(function () {
     function getTableDataAsJSON() {
        const table = document.getElementById('family-table');
        const rows = document.querySelectorAll('#family-table tr');
        let dependentsData = [];
    
        for (let i = 1; i < rows.length; i++) { // Start from 1 to skip table header
            const cells = rows[i].getElementsByTagName('td');
            let dependent = {
                firstName: cells[0].innerText, // Assuming first cell contains the first name
                secondName: cells[1].innerText,
                lastName: cells[2].innerText,
                gender: cells[3].innerText,
                relationship: cells[4].innerText,
                educationalStatus: cells[5].innerText,
                martialStatus: cells[6].innerText,
                nationalID: cells[7].innerText,
                healthStatus: cells[8].innerText,
                dependentIncomeTable: cells[9].innerText,
                needsType: cells[10].innerText,
                educationalDegree: cells[11].innerText,
                dateOfBitrh: cells[12].innerText,
                nationalIDExpDate: cells[13].innerText,
                needsDescription: cells[14].innerText,
                educationalLevel: cells[15].innerText,
                diseaseType: cells[16].innerText,
            };
            dependentsData.push(dependent);
        }
    
        return JSON.stringify(dependentsData);
    }
    
    // Use this function to get JSON when you need it
    const dependentsJSON = getTableDataAsJSON();
    //console.log(dependentsJSON); // Logs the JSON string
    
    document.getElementById('myform').addEventListener('submit', function(e) {
      e.preventDefault();
  
      const formData = new FormData(this);
  
      // Collecting checkbox values
      let dependentNeedsType = [];
      document.querySelectorAll('#id_dependent_info_needs_type input[type=checkbox]').forEach((checkbox) => {
          if (checkbox.checked) {
              dependentNeedsType.push(checkbox.value);
          }
      });
      formData.append('dependent_info_needs_type', JSON.stringify(dependentNeedsType));
  
      // Collecting checkbox values
      let familyIssue = [];
      document.querySelectorAll('#id_familyinfo_family_issues input[type=checkbox]').forEach((checkbox) => {
          if (checkbox.checked) {
              familyIssue.push(checkbox.value);
          }
      });
      formData.append('familyinfo_family_issues', JSON.stringify(familyIssue));
  
      // Collecting checkbox values
      let familyNeedsType = [];
      document.querySelectorAll('#id_familyinfo_needs_type input[type=checkbox]').forEach((checkbox) => {
          if (checkbox.checked) {
              familyNeedsType.push(checkbox.value);
          }
      });
      formData.append('familyinfo_needs_type', JSON.stringify(familyNeedsType));
  
      // Adding information of the dependents table to the FormData
      formData.append('dependents-table', getTableDataAsJSON());
  
      // Remove 'Content-Type' header to allow the browser to add it
      // along with the correct 'boundary'
      // delete options.headers['Content-Type'];
  
      fetch('http://127.0.0.1:8000/beneficiaries/new', {
          method: 'POST',
          body: formData,
      })
      .then(response => response.json())
      .then(data => {
          if (data.redirect) {
              window.location.href = data.redirect;
              // console.log(data);
          } else {
              // Handle other responses
          }
      })
      .catch((error) => {
          console.error('Error:', error);
          // Handle error
      });
    });

    var $modalForm = $("#editModalForm");
    var $saveChangesButton = $("#saveChanges");

    $.validator.addMethod(
      "fullNameRegex",
      function (value, element) {
        return (
          this.optional(element) ||
          /^[a-zA-Z\u0621-\u064A]+([ '-][a-zA-Z\u0621-\u064A]+)*$/i.test(value)
        );
      },
      "يجب أن يتكون الاسم الكامل من الاسم الأول والأوسط والأخير."
    );

    // Validate Saudi Arabia IDs (Iqama/Saudi Natioanl Id)
    function validateSAID(id) {
      let type = id.substr(0, 1);
      let sum = 0;
      const _idLength = 10;
      const _type1 = "1";
      const _type2 = "2";
      id = id.trim();
      if (
        isNaN(parseInt(id)) ||
        id.length !== _idLength ||
        (type !== _type2 && type !== _type1)
      ) {
        return false;
      }
      for (let num = 0; num < 10; num++) {
        const digit = Number(id[num]);
        if (num % 2 === 0) {
          const doubled = digit * 2;
          const ZFOdd = `00${doubled}`.slice(-2);
          sum += Number(ZFOdd[0]) + Number(ZFOdd[1]);
        } else {
          sum += digit;
        }
      }
      return sum % 10 !== 0 ? false : true;
    }

    // Validator method for the national id (Iqama/Saudi)
    $.validator.addMethod(
      "nationalidRegex",
      function (value, element) {
        console.log(value, validateSAID(value));
        return this.optional(element) || validateSAID(value);
      },
      "أدخل رقم هوية/إقامة صحيح."
    );

    $.validator.addMethod(
      "dependentNameRegex",
      function (value, element) {
        return (
          this.optional(element) || /^[a-zA-Z0-9\u0621-\u064A]*$/i.test(value)
        );
      },
      "يحتوي الأسم على حروف فقط."
    );

    // Define your validation rules here
    $modalForm.validate({
      // Your validation rules
      rules: {
        // rules for your fields
        // dependent_information ---------
        dependent_edit_info_first_name: {
          required: true,
          dependentNameRegex: true,
          minlength: 2,
          maxlength: 50,
        },
        dependent_edit_info_second_name: {
          required: true,
          dependentNameRegex: true,
          minlength: 2,
          maxlength: 50,
        },
        dependent_edit_info_last_name: {
          required: true,
          dependentNameRegex: true,
          minlength: 2,
          maxlength: 50,
        },
        dependent_edit_info_relationship: {
          required: true,
        },
        dependent_edit_info_national_id: {
          required: true,
          nationalidRegex: true,
        },
        dependent_edit_info_national_id_exp_date: {
          required: true,
          dateISO: true,
        },
        dependent_edit_info_gender: {
          required: true,
        },
        dependent_edit_info_marital_status: {
          required: true,
        },
        dependent_edit_info_educational_status: {
          required: true,
        },
        dependent_edit_info_educational_level: {
          required: true,
        },
        dependent_edit_info_educational_degree: {
          required: true,
        },
        dependent_edit_info_health_status: {
          required: true,
        },
        dependent_edit_info_disease_type: {
          required: true,
        },
        dependent_edit_info_date_of_birth: {
          required: true,
          dateISO: true,
        },
        dependent_edit_info_needs_type: {
          required: true,
        },
      },
      messages: {
        dependent_edit_info_first_name: {
          required: "الرجاء إدخال الاسم حسب الهوية/الإقامة",
          minlength: "يجب ألا يقل الاسم عن حرفين",
        },
        dependent_edit_info_second_name: {
          required: "الرجاء إدخال الاسم حسب الهوية/الإقامة",
          minlength: "يجب ألا يقل الاسم عن حرفين",
        },
        dependent_edit_info_last_name: {
          required: "الرجاء إدخال الاسم حسب الهوية/الإقامة",
          minlength: "يجب ألا يقل الاسم عن حرفين",
        },
        dependent_edit_info_gender: {
          required: "الرجاء اختيار الجنس",
        },
        dependent_edit_info_relationship: {
          required: "الرجاء اختيار صلة القرابة",
        },
        // Add other field messages here
      },
      errorElement: "div",
      errorClass: "invalid-feedback",
      highlight: function (element, errorClass, validClass) {
        //$(element).addClass('is-invalid');
        $(element).closest(".form-group").removeClass("has-error");
      },
      unhighlight: function (element, errorClass, validClass) {
        $(element).closest(".form-group").removeClass("has-error");
      },
      errorPlacement: function (error, element) {
        // Check if the element is inside an input-group
        if (element.parent(".input-group").length) {
          // Place the error after the input-group
          error.insertAfter(element.parent(".input-group"));
        } else {
          // Default placement for other elements
          error.insertAfter(element);
        }
      },
      // other options
    });


    // Check form validity on input change
    $modalForm.on("change keyup", function () {
      if ($modalForm.valid()) {
          $saveChangesButton.prop("disabled", false);
      } else {
          $saveChangesButton.prop("disabled", true);
      }
    });



    // Add an event listener to the dependent income table for add row btn
    $("#id_add_row_income_edit_info").on("click", function () {
      if ($modalForm.valid()) {
          $saveChangesButton.prop("disabled", false);
      } else {
          $saveChangesButton.prop("disabled", true);
      }
    });


    // Additionally, you may want to trigger the event when a row is removed from income table
    $(".removeIncomeEditInfoRow").on("click", function () {
      if ($modalForm.valid()) {
          $saveChangesButton.prop("disabled", false);
      } else {
          $saveChangesButton.prop("disabled", true);
      }
    });


    const banks = [
      {
        samaCode: "55",
        bankName: "Banque Saudi Fransi",
        nameEn: "Banque Saudi Fransi",
        nameAr: "السعودي الفرنسي",
      },
      {
        samaCode: "80",
        name: "Alrajhi Bank",
        nameEn: "Alrajhi Bank",
        nameAr: "الراجحي",
      },
      {
        samaCode: "10",
        bankName: "National Commercial Bank",
        nameEn: "National Commertial Bank",
        nameAr: "الأهلي السعودي",
      },
      {
        samaCode: "45",
        bankName: "Saudi British Bank",
        nameEn: "SABB",
        nameAr: "ساب",
      },
      {
        samaCode: "20",
        bankName: "Riyadh Bank",
        nameEn: "Riyad Bank",
        nameAr: "الرياض",
      },
      {
        samaCode: "05",
        bankName: "Alinma Bank",
        nameEn: "AL Inma Bank",
        nameAr: "الإنماء",
      },
      {
        samaCode: "60",
        bankName: "Bank AlJazira",
        nameEn: "Bank Aljazerah",
        nameAr: "الجزيرة",
      },
      {
        samaCode: "15",
        bankName: "Bank AlBilad ",
        nameEn: "BANK ALBELAD",
        nameAr: "البلاد",
      },
      {
        samaCode: "30",
        bankName: "Arab National Bank",
        nameEn: "Arab National Bank",
        nameAr: "العربي",
      },

      {
        samaCode: "76",
        bankName: "Bank Muscat",
        nameEn: "Bank Muscat",
        nameAr: "مسقط",
      },
      /*
      {
        samaCode: "98",
        bankName: "BNP Paribas",
        nameEn: "BNP Paribas",
        nameAr: "بي ان بي باريبا",
      },
      {
        samaCode: "81",
        bankName: "Deutsche Bank",
        nameEn: "Deutsche Bank",
        nameAr: "دويتشه",
      },
      */
      {
        samaCode: "95",
        bankName: "Emirates Bank",
        nameEn: "Emirates Bank",
        nameAr: "الإمارات دبي الوطني",
      },
      {
        samaCode: "90",
        bankName: "Gulf International Bank",
        nameEn: "Gulf International Bank",
        nameAr: "الخليج الدولي",
      },
      {
        samaCode: "71",
        bankName: "National Bank of Bahrain",
        nameEn: "National Bank of Bahrain",
        nameAr: "البحرين الوطني",
      },
      {
        samaCode: "75",
        bankName: "National Bank of Kuwait",
        nameEn: "National Bank of Kuwait",
        nameAr: "الكويت الوطني",
      },
      {
        samaCode: "82",
        bankName: "National Bank of Pakistan",
        nameEn: "National Bank of Pakistan",
        nameAr: "باكستان الوطني",
      },
      /*
      {
        samaCode: "40",
        bankName: "Samba Financial Services",
        nameEn: "Samba Financial Services",
        nameAr: "سامبا",
      },
      {
        samaCode: "01",
        bankName: "Saudi Arabian Monetary Agency",
        nameEn: "Saudi Arabian Monetary Agency",
        nameAr: "المركزي السعودي",
      },
      */
      {
        samaCode: "50",
        bankName: "Alawwal Bank",
        nameEn: "Alawwal Bank",
        nameAr: "الأول",
      },
      {
        samaCode: "65",
        bankName: "Saudi Investment Bank",
        nameEn: "Saudi Investment Bank",
        nameAr: "السعودي للاستثمار",
      },
      /*
      {
        samaCode: "83",
        bankName: "State Bank of India",
        nameEn: "State Bank of India",
        nameAr: "الهند الوطني",
      },
      */
      {
        samaCode: "84",
        bankName: "Turkiye Cumhuriyeti Ziraat Bankasi",
        nameEn: "Turkiye Cumhuriyeti Ziraat Bankasi",
        nameAr: "زراعات",
      },
      /*
      {
        samaCode: "87",
        bankName: "Industrial & Commercial Bank of China (Riyadh Branch)",
        nameEn: "Industrial & Commercial Bank of China (Riyadh Branch)",
        nameAr: "ICBC",
      },
      {
        samaCode: "86",
        bankName: "Saudi Arabian Monetary Agency",
        nameEn: "Saudi Arabian Monetary Agency",
        nameAr: "جي بي مورجان",
      },
      */
    ];

    // Function to update the names of the uploaded files for each file input
    function updateFileNamesDisplay(fileInputId, fileNamesDivId) {
      var fileInput = document.getElementById(fileInputId);
      var fileNamesDiv = document.getElementById(fileNamesDivId);

      // Initialize with a message indicating no file is uploaded
      fileNamesDiv.innerHTML = "[لم يتم إرفاق أي ملفات]";

      fileInput.addEventListener("change", function () {
        if (this.files.length > 0) {
          fileNamesDiv.innerHTML = ""; // Clear the initial message
          for (var i = 0; i < this.files.length; i++) {
            fileNamesDiv.innerHTML += this.files[i].name + "<br>";
          }
        } else {
          // Show the no files uploaded message if no file is selected
          fileNamesDiv.innerHTML = "[لم يتم إرفاق أي ملفات]";
        }
      });
    }

    // Initialize for each file input (fileInputId, fileNamesDivId)
    updateFileNamesDisplay(
      "id_formFileBeneficiaryNationalAddress",
      "id_fileNamesNationalAddress"
    );
    updateFileNamesDisplay(
      "id_formFileLeaseContractOrTitleDeed",
      "id_fileNamesLeaseContractOrTitleDeed"
    );
    updateFileNamesDisplay(
      "id_formFileDeptInstrument",
      "id_fileNamesDeptInstrument"
    );
    updateFileNamesDisplay(
      "id_formFileNationalIDForBeneficiaryForDependents",
      "id_fileNamesNationalIDForBeneficiaryForDependents"
    );
    updateFileNamesDisplay(
      "id_formFileBeneficiaryNationalID",
      "id_fileNamesBeneficiaryNationalID"
    );
    updateFileNamesDisplay(
      "id_formFileWaterOrElectricityBills",
      "id_fileNamesWaterOrElectricityBills"
    );
    updateFileNamesDisplay(
      "id_formFileSocialWarrantyInquiry",
      "id_fileNamesSocialWarrantyInquiry"
    );
    updateFileNamesDisplay(
      "id_formFilePensionOrSocialInsuranceInquiry",
      "id_fileNamesPensionOrSocialInsuranceInquiry"
    );
    updateFileNamesDisplay(
      "id_formFileFatherOrHusbandDeathCertificate",
      "id_fileNamesFatherOrHusbandDeathCertificate"
    );
    updateFileNamesDisplay(
      "id_formFileLetterFromPrison",
      "id_fileNamesLetterFromPrison"
    );
    updateFileNamesDisplay("id_formFileDivorceDeed", "id_fileNamesDivorceDeed");
    updateFileNamesDisplay(
      "id_formFileChildrenResponsibilityDeed",
      "id_fileNamesChildrenResponsibilityDeed"
    );
    updateFileNamesDisplay("id_formFileOther", "id_fileNamesOther");

    /**
     * validates IBAN
     * @return {boolean}
     */
    function validateIBAN(iban) {
      if (!iban) {
        return false;
      }

      iban = iban.trim();

      if (iban.length !== 24) {
        return false;
      }

      if (!iban.startsWith("SA")) {
        return false;
      }

      const bankCode = iban.substring(4, 6);

      return banks.some((b) => b.samaCode === bankCode);
    }

    /**
     * Returns the bank object
     * @return {Object}
     */
    function getBankByIBAN(iban) {
      if (!validateIBAN(iban)) return null;

      const bankCode = iban.substring(4, 6);
      const bank = banks.find((b) => b.samaCode === bankCode);
      return bank ? bank.nameAr : null;
    }

    $("#id_beneficiaryinfo_iban").on("input", function () {
      var iban = $(this).val();
      var bankNameAr = getBankByIBAN(iban);

      if (bankNameAr) {
        $("#id_beneficiaryinfo_bank").val(bankNameAr).change();
      } else {
        $("#id_beneficiaryinfo_bank").val("").change(); // Reset to default if IBAN is invalid
      }
    });

    // Validator method for the Saudi IBAN number
    $.validator.addMethod(
      "validateIBAN",
      function (value, element) {
        console.log(value, validateIBAN(value));
        return this.optional(element) || validateIBAN(value);
      },
      "الرجاء إدخال رقم إيبان صحيح"
    );

    // The Code segment to calculate the incomeinfo

    // Select all your input fields
    var incomeinfo_inputs = document.querySelectorAll(
      "input[type=number][name^=incomeinfo_]:not([name=incomeinfo_total])"
    );

    // Function to calculate the sum
    function calculateSumIncome() {
      let sum = 0;
      incomeinfo_inputs.forEach((input) => {
        const value = parseFloat(input.value) || 0;
        sum += value;
      });
      document.getElementById("id_incomeinfo_total").value = sum.toFixed(2);
    }

    // Add event listeners to all input fields
    incomeinfo_inputs.forEach((input) =>
      input.addEventListener("input", calculateSumIncome)
    );

    // Code segment ends

    // The Code segment to calculate the expensesinfo

    // Select all your input fields
    var expensesinfo_inputs = document.querySelectorAll(
      "input[type=number][name^=expensesinfo_]:not([name=expensesinfo_total])"
    );

    // Function to calculate the sum
    function calculateSumExpenses() {
      let sum = 0;
      expensesinfo_inputs.forEach((input) => {
        const value = parseFloat(input.value) || 0;
        sum += value;
      });
      document.getElementById("id_expensesinfo_total").value = sum.toFixed(2);
    }

    // Add event listeners to all input fields
    expensesinfo_inputs.forEach((input) =>
      input.addEventListener("input", calculateSumExpenses)
    );

    // Code segment ends

    /**
     * Mark all form steps as unfinished.
     */
    document
      .querySelectorAll(".form-stepper-list")
      .forEach((formStepHeader) => {
        formStepHeader.classList.add("form-stepper-unfinished");
        formStepHeader.classList.remove(
          "form-stepper-active",
          "form-stepper-completed"
        );
      });
    let stepNumber = 1;
    /**
     * Select the form step circle (progress bar).
     */
    const formStepCircle = document.querySelector(
      'li[step="' + stepNumber + '"]'
    );

    /**
     * Mark the current form step as active.
     */
    formStepCircle.classList.remove(
      "form-stepper-unfinished",
      "form-stepper-completed"
    );
    formStepCircle.classList.add("form-stepper-active");

    function validateCheckboxesAndShowError() {
      var allChecked = checkAllCheckboxes();

      if (!allChecked) {
        $("#checkboxError").removeClass("d-none"); // Remove 'd-none' to show the error message
        alert("الرجاء الموافقة على الإقرار"); // [NOT WORKING]
        return false; // Indicate validation failed
      } else {
        $("#checkboxError").addClass("d-none"); // Add 'd-none' to hide the error message
        return true; // Indicate validation passed
      }
    }

    // Function to check if all checkboxes are checked
    function checkAllCheckboxes() {
      return (
        $('#submit_confirmation input[type="checkbox"]').length ===
        $('#submit_confirmation input[type="checkbox"]:checked').length
      );
    }

    // Event listener for checkbox changes
    $('#submit_confirmation input[type="checkbox"]').change(function () {
      if (checkAllCheckboxes()) {
        $("#submit-btn").prop("disabled", false); // Enable submit button if all checkboxes are checked
      } else {
        $("#submit-btn").prop("disabled", true); // Keep submit button disabled otherwise
      }
    });

    // Handle the submit button click
    $("#submit-btn").click(function (e) {
      if (!validateCheckboxesAndShowError()) {
        e.preventDefault(); // Prevent form submission
      }
      // else form will be submitted as all checkboxes are checked
    });
    // Validator method for first, second, and last name fields in the form
    $.validator.addMethod(
      "nameRegex",
      function (value, element) {
        return (
          this.optional(element) || /^[a-zA-Z0-9\u0621-\u064A]*$/i.test(value)
        );
      },
      "يحتوي الأسم على حروف فقط."
    );

    $.validator.addMethod(
      "fullNameRegex",
      function (value, element) {
        return (
          this.optional(element) ||
          /^[a-zA-Z\u0621-\u064A]+([ '-][a-zA-Z\u0621-\u064A]+)*$/i.test(value)
        );
      },
      "يجب أن يتكون الاسم الكامل من الاسم الأول والأوسط والأخير."
    );

    // Validate Saudi Arabia IDs (Iqama/Saudi Natioanl Id)
    function validateSAID(id) {
      let type = id.substr(0, 1);
      let sum = 0;
      const _idLength = 10;
      const _type1 = "1";
      const _type2 = "2";
      id = id.trim();
      if (
        isNaN(parseInt(id)) ||
        id.length !== _idLength ||
        (type !== _type2 && type !== _type1)
      ) {
        return false;
      }
      for (let num = 0; num < 10; num++) {
        const digit = Number(id[num]);
        if (num % 2 === 0) {
          const doubled = digit * 2;
          const ZFOdd = `00${doubled}`.slice(-2);
          sum += Number(ZFOdd[0]) + Number(ZFOdd[1]);
        } else {
          sum += digit;
        }
      }
      return sum % 10 !== 0 ? false : true;
    }

    // Validator method for the national id (Iqama/Saudi)
    $.validator.addMethod(
      "nationalidRegex",
      function (value, element) {
        return this.optional(element) || validateSAID(value);
      },
      "أدخل رقم هوية/إقامة صحيح."
    );

    // Validator method for the phone number [Working - International Phone Numbers]
    /*
        $.validator.addMethod(
          "phonenumberRegex",
          function (value, element) {
              return this.optional(element) || /^(?:\+?\d{1,3}[\s-]?)?(0\d{9}|(?:\d{3}[\s-]?\d{3}[\s-]?\d{4})|\d{10})$/i.test(value);
          },
          "الرجاء إدخال رقم جوال صحيح."
        );
        */

    // Validator method for the phone number [Saudi Arabia Only]
    $.validator.addMethod(
      "saudiPhoneRegex",
      function (value, element) {
        return (
          this.optional(element) || /^(?:\+966\s?5\d{8}|05\d{8})$/i.test(value)
        );
      },
      "الرجاء إدخال رقم جوال صحيح في المملكة العربية السعودية."
    );

    // Email address validator
    $.validator.addMethod(
      "emailRegex",
      function (value, element) {
        return (
          this.optional(element) ||
          /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(value)
        );
      },
      "الرجاء إدخال بريد إلكتروني صحيح."
    );

    $.validator.addMethod('filesize', function (value, element, param) {
      return this.optional(element) || (element.files[0].size <= param * 1000000)
    }, 'حجم الملف يجب أن يكون أقل من {0} MB');

    // The below code will change the default validation messages
    $.extend($.validator.messages, {
      required: "هذا الحقل مطلوب.",
      remote: "الرجاء اصلاح هذا الحقل.",
      email: "الرجاء إدخال بريد الكتروني صالح.",
      url: "الرجاء إدخال رابط صحيح وفعال.",
      date: "الرجاء إدخال تاريخ صالح.",
      dateISO: "الرجاء إدخال تاريخ صحيح (بصيغة ISO).",
      number: "الرجاء إدخال رقم صحيح.",
      digits: "الرجاء إدخال أرقام فقط.",
      creditcard: "الرجاء إدخال رقم بطاقة ائتمان صالحة.",
      equalTo: "رجاء أدخل نفس القيمة مره أخرى.",
      accept: "الرجاء إدخال قيمة بإمتداد صحيح.",
      maxlength: $.validator.format("الرجاء عدم إدخال أكثر من {0} أحرف."),
      minlength: $.validator.format("الرجاء إدخال على الأقل {0} حروف."),
      rangelength: $.validator.format(
        "Please enter a value between {0} and {1} characters long."
      ),
      range: $.validator.format("الرجاء إدخال رقم بين {0} و {1}."),
      max: $.validator.format(" الرجاء إدخال قيمة أقل من أو تساوي {0}."),
      min: $.validator.format("الرجاء إدخال قيمة أعلى من أو تساوي {0}."),
    });

    // When ".next" button is clicked, the following function is executed
    $(".next").click(function () {
      // Check if on the dependent information step
      if ($("#dependent_information").is(":visible")) {
        // Check if the table has at least one row (one dependent)
        if ($("#family-table tbody tr").length === 0) {
          alert(
            "الرجاء إضافة مرافق واحد على الأقل قبل الانتقال الى الخطوة التالية. أو يمكنك الرجوع وإزالة خيار (إضافة ابناء / مرافقين)."
          );
          return false; // Prevent moving to next step
        }
      }

      var form = $("#myform");
      form.validate({
        errorElement: "span",
        errorClass: "help-block invalid-feedback",
        highlight: function (element, errorClass, validClass) {
          $(element).closest(".form-group").addClass("has-error");
          //$(element).fadeOut(function() {
          //  $(element).fadeIn();
          //  });
        },
        unhighlight: function (element, errorClass, validClass) {
          $(element).closest(".form-group").removeClass("has-error");
        },
        errorPlacement: function (error, element) {
          // Check if the element is inside an input-group
          if (element.parent(".input-group").length) {
            // Place the error after the input-group
            error.insertAfter(element.parent(".input-group"));
          } else {
            // Default placement for other elements
            error.insertAfter(element);
          }
        },
        focusInvalid: true,

        // Adding the rules (validations) for each input in the form.
        rules: {
          personalinfo_first_name: {
            required: true,
            nameRegex: true,
            minlength: 2,
            maxlength: 20,
          },
          personalinfo_second_name: {
            required: true,
            nameRegex: true,
            minlength: 2,
            maxlength: 20,
          },
          personalinfo_last_name: {
            required: true,
            nameRegex: true,
            minlength: 2,
            maxlength: 20,
          },
          personalinfo_date_of_birth: {
            required: true,
            dateISO: true,
          },
          personalinfo_gender: {
            required: true,
          },
          personalinfo_national_id: {
            required: true,
            nationalidRegex: true,
          },
          personalinfo_national_id_exp_date: {
            required: true,
            dateISO: true,
          },
          personalinfo_nationality: {
            required: true,
            maxlength: 30,
          },
          personalinfo_category: {
            required: true,
          },
          personalinfo_marital_status: {
            required: true,
          },
          personalinfo_educational_level: {
            required: true,
          },
          personalinfo_date_of_death_of_father_or_husband: {
            required: true,
            dateISO: true,
          },
          personalinfo_washing_place: {
            required: false,
          },
          personalinfo_health_status: {
            required: true,
          },
          personalinfo_disease_type: {
            required: true,
          },
          personalinfo_work_status: {
            required: true,
          },
          personalinfo_employer: {
            required: true,
          },
          personalinfo_phone_number: {
            required: true,
            saudiPhoneRegex: true,
          },
          personalinfo_email: {
            required: true,
            //emailRegex: true,
          },
          // dependent_information ---------
          dependent_info_name: {
            required: true,
            fullNameRegex: true,
            minlength: 2,
            maxlength: 50,
          },
          dependent_info_relationship: {
            required: true,
          },
          dependent_info_national_id: {
            required: true,
            nationalidRegex: true,
          },
          dependent_info_national_id_exp_date: {
            required: true,
            dateISO: true,
          },
          dependent_info_gender: {
            required: true,
          },
          dependent_info_marital_status: {
            required: true,
          },
          dependent_info_educational_status: {
            required: true,
          },
          dependent_info_educational_level: {
            required: true,
          },
          dependent_info_educational_degree: {
            required: true,
          },
          dependent_info_health_status: {
            required: true,
          },
          dependent_info_disease_type: {
            required: true,
          },
          dependent_info_date_of_birth: {
            required: true,
            dateISO: true,
          },
          dependent_info_needs_type: {
            required: true,
          },
          // housing_income_need_information ---------
          houseinfo_building_number: {
            required: true,
          },
          houseinfo_street_name: {
            required: true,
          },
          houseinfo_neighborhood: {
            required: true,
          },
          houseinfo_city: {
            required: true,
          },
          houseinfo_postal_code:{
            required: true,
          },
          houseinfo_additional_number: {
            required: true,
          },
          houseinfo_unit: {
            required: true,
          },
          houseinfo_location_url: {
            required: true,
          },
          houseinfo_housing_type: {
            required: true,
          },
          houseinfo_housing_ownership: {
            required: true,
          },
          incomeinfo_salary: {
            required: true,
          },
          incomeinfo_social_insurance: {
            required: true,
          },
          incomeinfo_charity: {
            required: true,
          },
          incomeinfo_social_warranty: {
            required: true,
          },
          incomeinfo_pension_agency: {
            required: true,
          },
          incomeinfo_citizen_account: {
            required: true,
          },
          incomeinfo_benefactor: {
            required: true,
          },
          incomeinfo_other: {
            required: true,
          },
          expensesinfo_housing_rent: {
            required: true,
          },
          expensesinfo_electricity_bills: {
            required: true,
          },
          expensesinfo_water_bills: {
            required: true,
          },
          expensesinfo_transportation: {
            required: true,
          },
          expensesinfo_health_supplies: {
            required: true,
          },
          expensesinfo_food_supplies: {
            required: true,
          },
          expensesinfo_educational_supplies: {
            required: true,
          },
          expensesinfo_proven_debts: {
            required: true,
          },
          expensesinfo_other: {
            required: true,
          },
          familyinfo_family_issues: {
            required: true,
          },
          familyinfo_needs_type: {
            required: true,
          },
          beneficiaryinfo_iban: {
            required: true,
            validateIBAN: true,
          },
          beneficiaryinfo_bank: {
            required: true,
          },
          // attachments_information --------- // File rules are currently not working
          fileBeneficiaryNationalID: {
            required: true,
            accept: "application/pdf, image/*",
            filesize : 5, // here we are working with MB
          },
          fileNationalIDForBeneficiaryDependents: {
            required: true,
            accept: "application/pdf, image/*",
          },
          fileBeneficiaryNationalAddress: {
            required: true,
            accept: "application/pdf, image/*",
          },
          filePensionOrSocialInsuranceInquiry: {
            required: true,
            accept: "application/pdf, image/*",
          },
          fileFatherOrHusbandDeathCertificate: {
            required: true,
            accept: "application/pdf, image/*",
          },
          fileLetterFromPrison: {
            required: true,
            accept: "application/pdf, image/*",
          },
          fileDivorceDeed: {
            required: true,
            accept: "application/pdf, image/*",
          },
          fileChildrenResponsibilityDeed: {
            required: true,
            accept: "application/pdf, image/*",
          },
          fileLeaseContractOrTitleDeed: {
            required: true,
            accept: "application/pdf, image/*",
          },
          fileWaterOrElectricityBills: {
            required: true,
            accept: "application/pdf, image/*",
          },
          fileSocialWarrantyInquiry: {
            required: true,
            accept: "application/pdf, image/*",
          },
        },
        messages: {
          personalinfo_first_name: {
            required: "هذا الحقل مطلوب.",
          },
          password: {
            required: "Password required",
          },
          conf_password: {
            required: "Password required",
            equalTo: "Password don't match",
          },
          name: {
            required: "Name required",
          },
          email: {
            required: "Email required",
          },
        },
      });

      // In case of a valid form inputs, ".next" button will show the next step in the form
      if (form.valid() === true) {
        if ($("#personal_information").is(":visible")) {
          current_fs = $("#personal_information");
          // Check if the 'Skip the second step' checkbox is checked
          if ($("#skip-step").is(":checked")) {
            next_fs = $("#dependent_information"); // Set next_fs to the second step
          } else {
            next_fs = $("#housing_income_need_information"); // Proceed to the third stepas usual
          }
        } else if ($("#dependent_information").is(":visible")) {
          current_fs = $("#dependent_information");
          next_fs = $("#housing_income_need_information");
        } else if ($("#housing_income_need_information").is(":visible")) {
          current_fs = $("#housing_income_need_information");
          next_fs = $("#attachments_information");
        } else if ($("#attachments_information").is(":visible")) {
          // Check if all attachments have at least one file
          var allAttachmentsValid = true;

          // Iterate over visible div containers with file input fields
          $('.fileInputContainer:visible input[type="file"]').each(function () {
            if (this.files.length === 0) {
                allAttachmentsValid = false;
                return false; // Exit the loop early since we already found an invalid attachment
            }
          });

          if (!allAttachmentsValid) {
              alert("الرجاء إرفاق ملف واحد على الأقل لكل مرفق مطلوب قبل الانتقال إلى الخطوة التالية.");
              return false;
          }

          current_fs = $("#attachments_information");
          next_fs = $("#submit_confirmation");
        }

        next_fs.show();
        current_fs.hide();
      }
    });

    // When ".previous" button is clicked, the following function is called
    $(".previous").click(function () {
      if ($("#dependent_information").is(":visible")) {
        current_fs = $("#dependent_information");
        next_fs = $("#personal_information");
      } else if ($("#housing_income_need_information").is(":visible")) {
        current_fs = $("#housing_income_need_information");
        // Check if the 'Skip the second step' checkbox is checked
        if ($("#skip-step").is(":checked")) {
          next_fs = $("#dependent_information"); // Set next_fs to the second step
        } else {
          next_fs = $("#personal_information"); // Proceed to the first step as usual (there's no dependents)
        }
      } else if ($("#attachments_information").is(":visible")) {
        current_fs = $("#attachments_information");
        next_fs = $("#housing_income_need_information");
      } else if ($("#submit_confirmation").is(":visible")) {
        current_fs = $("#submit_confirmation");
        next_fs = $("#attachments_information");
      }

      next_fs.show();
      current_fs.hide();
    });

    // When "add Child button" is clicked, the following function is called
    $(".addChildBtn").click(function () {
      // This line prevents the form from submitting
      event.preventDefault();

      var dependentFirstName = $("#id_dependent_info_first_name").val().trim();
      var dependentSecondName = $("#id_dependent_info_second_name").val().trim();
      var dependentLastName = $("#id_dependent_info_last_name").val().trim();
      var dependentGender = $("#id_dependent_info_gender").val();

      var dependentRelationship = $("#id_dependent_info_relationship").val();
      var dependentEducationalStatus = $(
        "#id_dependent_info_educational_status"
      ).val();
      var dependentMaritalStatus = $("#id_dependent_info_marital_status").val();
      var dependentNationalID = $("#id_dependent_info_national_id").val();

      var dependentHealthStatus = $("#id_dependent_info_health_status").val();
      var dependentMonthlyIncome = $("#id_dependent_info_monthly_income").val();
      var dependentIncomeSource = $("#id_dependent_info_income_source").val();
      var dependentNeedsType = $("#id_dependent_info_needs_type").val();

      var dependentEducationalLevel = $(
        "#id_dependent_info_educational_level"
      ).val();
      var dependentEducationalDegree = $(
        "#id_dependent_info_educational_degree"
      ).val();
      var dependentDateOfBirth = $("#id_dependent_info_date_of_birth").val();
      var dependentNationalIDExpDate = $(
        "#id_dependent_info_national_id_exp_date"
      ).val();

      var DependentDiseaseType = $("#id_dependent_info_disease_type").val();
      var DependentNeedsDescription = $(
        "#id_dependent_info_needs_description"
      ).val();

      // Collect dependent income information by looping over the income table
      function getDependentIncomeTableDataAsJSON() {
        // Create an array to store income information
        var incomeInfoArray = [];

        const dependentIncomeTable = document.getElementById('incomeInfoTable');
        const dependentIncomeTableRows = document.querySelectorAll('#incomeInfoTable tr');

        for (let i = 1; i < dependentIncomeTableRows.length; i++) {
          const cells = dependentIncomeTableRows[i].getElementsByTagName('td');

          // Create a JSON object to store income information
          var incomeInfo = {
            monthlyIncome: cells[0].innerText,
            incomeSource: cells[1].innerText,
          };

          incomeInfoArray.push(incomeInfo);
        }

        return JSON.stringify(incomeInfoArray);
      }

      let dependentIncomeJSON = getDependentIncomeTableDataAsJSON();

      // Get all checkboxes within the specified container
      var checkboxes = document.querySelectorAll('#id_dependent_info_needs_type input[type="checkbox"]');
      
      // Check if at least one checkbox is selected
      var atLeastOneChecked = Array.from(checkboxes).some(function(checkbox) {
        return checkbox.checked;
      });

      if (!atLeastOneChecked) {
        // Display an error message or perform any other action to indicate the requirement
        displayMinChoiceCountErrorMessage('الرجاء تحديد نوع واحد على الأقل.', 5000);
        return;
      }

      // Collecting and storing dependent needs type values
      var dependentNeedsTypeArray = [];
      $("#id_dependent_info_needs_type input[type=checkbox]:checked").each(function() {
        dependentNeedsTypeArray.push($(this).val());
      });

      if ($("#myform").valid() === true) {
        var $row = $("<tr></tr>");
        $row.append(
          $("<td></td>")
            .text(dependentFirstName)
            .attr("data-attr", "dependent_edit_info_first_name")
        );
        $row.append(
          $("<td></td>")
            .text(dependentSecondName)
            .addClass("d-none")
            .attr("data-attr", "dependent_edit_info_second_name")
        );
        $row.append(
          $("<td></td>")
            .text(dependentLastName)
            .addClass("d-none")
            .attr("data-attr", "dependent_edit_info_last_name")
        );
        $row.append(
          $("<td></td>")
            .text(dependentGender)
            .attr("data-attr", "dependent_edit_info_gender")
        );
        $row.append(
          $("<td></td>")
            .text(dependentRelationship)
            .attr("data-attr", "dependent_edit_info_relationship")
        );
        $row.append(
          $("<td></td>")
            .text(dependentEducationalStatus)
            .attr("data-attr", "dependent_edit_info_educational_status")
        );
        $row.append(
          $("<td></td>")
            .text(dependentMaritalStatus)
            .attr("data-attr", "dependent_edit_info_marital_status")
        );
        $row.append(
          $("<td></td>")
            .text(dependentNationalID)
            .attr("data-attr", "dependent_edit_info_national_id")
        );
        $row.append(
          $("<td></td>")
            .text(dependentHealthStatus)
            .attr("data-attr", "dependent_edit_info_health_status")
        );
        $row.append(
          $("<td></td>")
            .text(dependentIncomeJSON)
            .addClass("d-none dependent_income_json")
            .attr("data-attr", "dependent_edit_info_income_table_data")
        );
        /*
        $row.append(
          $("<td></td>")
            .text(dependentIncomeSource)
            .addClass("d-none")
            .attr("data-attr", "dependent_edit_info_income_source")
        );
        */
        // Add dependent needs type as a hidden cell or in any other way you prefer
        $row.append(
          $("<td></td>")
            .text(dependentNeedsTypeArray.join(','))
            .addClass("d-none")
            .attr("data-attr", "dependent_edit_info_needs_type")
        );
        $row.append(
          $("<td></td>")
            .text(dependentEducationalDegree)
            .addClass("d-none")
            .attr("data-attr", "dependent_edit_info_educational_degree")
        );
        $row.append(
          $("<td></td>")
            .text(dependentDateOfBirth)
            .addClass("d-none")
            .attr("data-attr", "dependent_edit_info_date_of_birth")
        );
        $row.append(
          $("<td></td>")
            .text(dependentNationalIDExpDate)
            .addClass("d-none")
            .attr("data-attr", "dependent_edit_info_national_id_exp_date")
        );
        $row.append(
          $("<td></td>")
            .text(DependentNeedsDescription)
            .addClass("d-none")
            .attr("data-attr", "dependent_edit_info_needs_description")
        );
        $row.append(
          $("<td></td>")
            .text(dependentEducationalLevel)
            .addClass("d-none")
            .attr("data-attr", "dependent_edit_info_educational_level")
        );
        $row.append(
          $("<td></td>")
            .text(DependentDiseaseType)
            .addClass("d-none")
            .attr("data-attr", "dependent_edit_info_disease_type")
        );


        // Edit Button
        var $editButton = $("<button>تفاصيل</button>")
          .addClass("edit btn btn-primary")
          .attr("data-bs-toggle", "modal")
          .attr("data-bs-target", "#editModal")
          .attr("id", "editModalButton")
          .click(function (event) {
            event.preventDefault();
            // Populate the modal fields with data from $row
            populateEditModal($row);
          });

        // Delete Button
        var $deleteButton = $('<button type="button">حذف</button>')
          .addClass("delete btn btn-danger")
          .click(function (event) {
            event.preventDefault();
            $row.remove();
          });

        // Action cell that containes Delete & Edit buttons
        var $actionsCell = $(
          '<td class="d-grid gap-2" style="grid-template-columns: 80px 80px; grid-template-rows: 50px;"></td>'
        ).append($deleteButton);
        $actionsCell.append($editButton);

        $row.append($actionsCell);

        $("#family-table tbody").append($row);

        // Clear checkboxes of dependent needs type
        $("#id_dependent_info_needs_type input[type=checkbox]").prop('checked', false);

        // Clear input fields
        $("#id_dependent_info_first_name").val("");
        $("#id_dependent_info_second_name").val("");
        $("#id_dependent_info_last_name").val("");
        $("#id_dependent_info_gender").val("");
        $("#id_dependent_info_relationship").val("");
        $("#id_dependent_info_educational_status").val("");
        $("#id_dependent_info_marital_status").val("");
        $("#id_dependent_info_national_id").val("");
        $("#id_dependent_info_health_status").val("");
        $("#id_dependent_info_monthly_income").val("");
        $("#id_dependent_info_income_source").val("");
        $("#id_dependent_info_needs_type").val("");
        $("#id_dependent_info_educational_level").val("");
        $("#id_dependent_info_educational_degree").val("");
        $("#id_dependent_info_date_of_birth").val("");
        $("#id_dependent_info_national_id_exp_date").val("");
        $("#id_dependent_info_needs_description").val("");
        $("#id_dependent_info_disease_type").val("");

        // Clear existing rows in the income table
        $("#incomeInfoTableBody").empty();

        // Remove error messages
        removeMaxRowErrorMessage();
        removeMinChoiceCountErrorMessage();

      } else {
        alert("الرجاء إدخال تفاصيل المرافقين!");
      }
    });

    // Function to remove the error message
    function removeMaxRowErrorMessage() {
      var errorMessageElement = document.getElementById('incomeTableErrorMessage');
      if (errorMessageElement) {
        errorMessageElement.remove();
      }
    }


    // Function to display an error message
    function displayMinChoiceCountErrorMessage(message, duration) {
      // Check if the error message element already exists
      var errorMessageElement = document.getElementById('minChoiceCountErrorMessage');
      
      // If not, create a new element and append it to the page
      if (!errorMessageElement) {
        errorMessageElement = document.createElement('div');
        errorMessageElement.id = 'minChoiceCountErrorMessage';
        errorMessageElement.classList.add('alert', 'alert-danger');

        // Get the parent node of the dependent income table
        var parentElement = document.getElementById('id_dependent_info_needs_type').parentNode;

        // Insert the error message element at the top of the parent node
        parentElement.insertBefore(errorMessageElement, parentElement.firstChild);

        // Focus on the error message
        errorMessageElement.focus();

        // Remove the error message after a specified duration
        //setTimeout(function () {
        //  removeMaxRowErrorMessage();
        //}, duration);
      }

      // Listen for changes in the checkboxes to update the error message
      var checkboxes = document.querySelectorAll('#id_dependent_info_needs_type input[type="checkbox"]');
      checkboxes.forEach(function (checkbox) {
        checkbox.addEventListener('change', function () {
          // Check if more than one checkbox is checked
          var checkedCount = Array.from(checkboxes).filter(function (checkbox) {
            return checkbox.checked;
          }).length;

          // If more than one checkbox is checked, remove the error message
          if (checkedCount > 0) {
            removeMinChoiceCountErrorMessage();
          }
        });
      });

      // Set the error message text
      errorMessageElement.textContent = message;
    }

    // Function to remove the error message
    function removeMinChoiceCountErrorMessage() {
      var errorMessageElement = document.getElementById('minChoiceCountErrorMessage');
      if (errorMessageElement) {
        errorMessageElement.remove();
      }
    }

    // Special button for dependent information step where the next button should work only of there's at least one dependent added to the list.
    $(".nextDependent").click(function () {
      // Check if on the dependent information step
      if ($("#dependent_information").is(":visible")) {
        // Check if the table has at least one row (one dependent)
        if ($("#family-table tbody tr").length === 0) {
          alert(
            "الرجاء إضافة مرافق واحد على الأقل قبل الانتقال الى الخطوة التالية. أو يمكنك الرجوع وإزالة خيار (إضافة ابناء / مرافقين)."
          );
          return false; // Prevent moving to next step
        }

        if ($("#personal_information").is(":visible")) {
          current_fs = $("#personal_information");
          // Check if the 'Skip the second step' checkbox is checked
          if ($("#skip-step").is(":checked")) {
            next_fs = $("#dependent_information"); // Set next_fs to the second step
          } else {
            next_fs = $("#housing_income_need_information"); // Proceed to the third stepas usual
          }
        } else if ($("#dependent_information").is(":visible")) {
          current_fs = $("#dependent_information");
          next_fs = $("#housing_income_need_information");
        }

        next_fs.show();
        current_fs.hide();
      }
    });


    $(".next, .previous, .nextDependent").click(function () {
      updateFormStep();
    });


    function updateFormStep() {
      // Check which div is visible and update form steps accordingly
      if ($("#personal_information").is(":visible")) {
        // Update for personal_information
        updateSteps(1);
      } else if ($("#dependent_information").is(":visible")) {
        // Update for dependent_information
        updateSteps(2);
      } else if ($("#housing_income_need_information").is(":visible")) {
        // Update for housing_income_need_information
        updateSteps(3);
      } else if ($("#attachments_information").is(":visible")) {
        updateSteps(4);
      } else if ($("#submit_confirmation").is(":visible")) {
        updateSteps(5);
      }
    }


    function updateSteps(currentStep) {
      // Reset all steps
      $(".form-stepper-list")
        .removeClass("form-stepper-active form-stepper-completed")
        .addClass("form-stepper-unfinished");

      // Activate and complete relevant steps
      for (let step = 1; step <= currentStep; step++) {
        $(`li[step="${step}"]`)
          .removeClass("form-stepper-unfinished")
          .addClass(
            step === currentStep
              ? "form-stepper-active"
              : "form-stepper-completed"
          );
      }
    }


    function populateEditModal($row) {
      // First, uncheck all checkboxes in the modal
      $("#editModal").find("input[type='checkbox']").prop('checked', false);
  
      $row.children("td").each(function () {
          var tdDataAttr = $(this).data("attr");
          var cellText = $(this).text();
          var $inputs = $("#editModal").find('[name^="' + tdDataAttr + '"]'); // Selects all inputs that start with tdDataAttr
  
          $inputs.each(function() {
              if ($(this).attr('type') === 'checkbox') {
                  // Splitting the comma-separated values
                  var values = cellText.split(',').map(function(item) {
                      return item.trim(); // Trimming any extra whitespace
                  });
  
                  // Check if the checkbox value is in the values array
                  if (values.includes($(this).val())) {
                      $(this).prop('checked', true);
                  }
              } else {
                  $(this).val(cellText);
              }
          });

          // Retrieve the stored income information array from the family table row
          var incomeInfoArrayText = "";

          if (tdDataAttr == "dependent_edit_info_income_table_data") {

            // Clear existing rows in the edit income table
            $("#incomeEditInfoTableBody").empty();

            incomeInfoArrayText = cellText;
            var incomeInfoArray = JSON.parse(incomeInfoArrayText) || [];

            // Add rows for each income information object in the array
            incomeInfoArray.forEach(function (incomeInfo) {
              var $incomeRow = $("<tr></tr>");
              $incomeRow.append($("<td></td>").text(incomeInfo.monthlyIncome));
              $incomeRow.append($("<td></td>").text(incomeInfo.incomeSource));

              // Add a delete button to each row
              var $deleteButton = $("<button>حذف</button>").addClass('btn btn-danger btn-sm removeIncomeEditInfoRow');
              $deleteButton.on("click", function () {
                  // Handle the delete button click event here
                  // You can remove the corresponding row from the table or perform any other action
                  $incomeRow.remove();

                  // Select save changes btn
                  var $saveChangesButton = $("#saveChanges");
                  var $modalForm = $("#editModalForm");

                  if ($modalForm.valid()) {
                      $saveChangesButton.prop("disabled", false);
                  } else {
                      $saveChangesButton.prop("disabled", true);
                  }
              });

              // Append the delete button column to the row
              $incomeRow.append($("<td></td>").append($deleteButton));

              // Append the row to the edit income table
              $("#incomeEditInfoTableBody").append($incomeRow);
            });
          }
      });
  
      $("#saveChanges").data("rowToEdit", $row);
    }

    // Collect dependent income information by looping over the income table
    function getDependentIncomeTableDataAsJSON() {
      // Create an array to store income information
      var incomeInfoArray = [];

      const dependentIncomeTable = document.getElementById('incomeEditInfoTable');
      const dependentIncomeTableRows = document.querySelectorAll('#incomeEditInfoTable tr');

      for (let i = 1; i < dependentIncomeTableRows.length; i++) {
        const cells = dependentIncomeTableRows[i].getElementsByTagName('td');

        // Create a JSON object to store income information
        var incomeInfo = {
          monthlyIncome: cells[0].innerText,
          incomeSource: cells[1].innerText,
        };

        incomeInfoArray.push(incomeInfo);
      }

      return JSON.stringify(incomeInfoArray);
    }

    
    // Onclick function to save the changes made to the dependent info
    $("#saveChanges").click(function (event) {
      event.preventDefault();

      // Get all checkboxes within the specified container
      var checkboxes = document.querySelectorAll('#id_dependent_edit_info_needs_type input[type="checkbox"]');
      
      // Check if at least one checkbox is selected
      var atLeastOneChecked = Array.from(checkboxes).some(function(checkbox) {
        return checkbox.checked;
      });

      if (!atLeastOneChecked) {
        // Display an error message or perform any other action to indicate the requirement
        displayMinChoiceCountEditErrorMessage('الرجاء تحديد نوع واحد على الأقل.', 5000);
        return;
      }
  
      var $rowToEdit = $(this).data("rowToEdit");
      var checkedValues = [];
  
      // Iterate over all inputs, selects, and textareas in the modal
      $("#editModal").find(".modal-body input, .modal-body select, .modal-body textarea").each(function () {
          // Get the name of the input field in the edit modal
          var inputName = $(this).attr("name");
          // Select the cell in the corresponding row of the dependent with data-attr as inputName
          var $cell = $rowToEdit.find('td[data-attr="' + inputName + '"]');
          
          if ($(this).attr('type') === 'checkbox') {
              // If it's a checkbox, gather all checked values with this name
              $('#editModal input[name="' + inputName + '"]:checked').each(function() {
                  checkedValues.push($(this).val());
              });
              // Select the cell that holds the dependent needs type as a list
              var $cell = $rowToEdit.find('td[data-attr="dependent_edit_info_needs_type"]');
              // Join the values with a comma and update the cell text
              $cell.text(checkedValues.join(','));
          } else {
              // For other input types, just update the cell text
              $cell.text($(this).val());
          }
      });

      // Get dependent income information from incomeEditInfoTable
      let dependentIncomeJSON = getDependentIncomeTableDataAsJSON();

      // Select the corresponding cell
      var $incomeTableCell = $rowToEdit.find('td[data-attr="dependent_edit_info_income_table_data"]');

      // Update the cell text (value)
      $incomeTableCell.text(dependentIncomeJSON);
  
      // Remove error messages
      removeMaxRowErrorMessage();
      removeMinChoiceCountEditErrorMessage();

      $("#editModal").modal("hide");
    });

    // Function to display an error message
    function displayMinChoiceCountEditErrorMessage(message, duration) {
      // Check if the error message element already exists
      var errorMessageElement = document.getElementById('minChoiceCountEditErrorMessage');
      
      // If not, create a new element and append it to the page
      if (!errorMessageElement) {
        errorMessageElement = document.createElement('div');
        errorMessageElement.id = 'minChoiceCountEditErrorMessage';
        errorMessageElement.classList.add('alert', 'alert-danger');

        // Get the parent node of the dependent income table
        var parentElement = document.getElementById('id_dependent_edit_info_needs_type').parentNode;

        // Insert the error message element at the top of the parent node
        parentElement.insertBefore(errorMessageElement, parentElement.firstChild);

        // Focus on the error message
        errorMessageElement.focus();

        // Remove the error message after a specified duration
        //setTimeout(function () {
        //  removeMaxRowErrorMessage();
        //}, duration);
      }

      // Listen for changes in the checkboxes to update the error message
      var checkboxes = document.querySelectorAll('#id_dependent_edit_info_needs_type input[type="checkbox"]');
      checkboxes.forEach(function (checkbox) {
        checkbox.addEventListener('change', function () {
          // Check if more than one checkbox is checked
          var checkedCount = Array.from(checkboxes).filter(function (checkbox) {
            return checkbox.checked;
          }).length;

          // If more than one checkbox is checked, remove the error message
          if (checkedCount > 0) {
            removeMinChoiceCountEditErrorMessage();
          }
        });
      });

      // Set the error message text
      errorMessageElement.textContent = message;
    }

    // Function to remove the error message
    function removeMinChoiceCountEditErrorMessage() {
      var errorMessageElement = document.getElementById('minChoiceCountEditErrorMessage');
      if (errorMessageElement) {
        errorMessageElement.remove();
      }
    }

    // Function to reset the values of the input fields after the modal is closed
    function resetInputFields() {
      // Reset the value of the monthly income input field
      $('#id_dependent_edit_info_monthly_income').val('');

      // Reset the value of the income source select field
      $('#id_dependent_edit_info_income_source').val('');
    }

    // Add an event listener for the modal's 'hidden.bs.modal' event
    $('#editModal').on('hidden.bs.modal', function () {
      // Call the function to reset the input fields
      resetInputFields();

      // Assuming your button has an ID "saveChanges"
      var saveChangesButton = document.getElementById('saveChanges');

      // Remove the 'disabled' attribute
      saveChangesButton.setAttribute('disabled', 'disabled');
    });


    // Function to convert non-English numbers to English numbers
    function convertToEnglishNumber(input) {
      const easternArabicNumerals = '٠١٢٣٤٥٦٧٨٩';
      const englishNumerals = '0123456789';

      for (let i = 0; i < easternArabicNumerals.length; i++) {
          const regex = new RegExp(easternArabicNumerals[i], 'g');
          input = input.replace(regex, englishNumerals[i]);
      }

      return input;
    }

    // Event listener for input field 'national id'
    document.getElementById('id_personalinfo_national_id').addEventListener('input', function (event) {
        const inputValue = event.target.value;
        const convertedValue = convertToEnglishNumber(inputValue);
        event.target.value = convertedValue;
    });

    // Event listener for input field 'phone number'
    document.getElementById('id_personalinfo_phone_number').addEventListener('input', function (event) {
      const inputValue = event.target.value;
      const convertedValue = convertToEnglishNumber(inputValue);
      event.target.value = convertedValue;
    });

    // Event listener for input field 'dependent national id'
    document.getElementById('id_dependent_info_national_id').addEventListener('input', function (event) {
      const inputValue = event.target.value;
      const convertedValue = convertToEnglishNumber(inputValue);
      event.target.value = convertedValue;
    });

    // Event listener for input field 'house unit number'
    document.getElementById('id_houseinfo_unit').addEventListener('input', function (event) {
      const inputValue = event.target.value;
      const convertedValue = convertToEnglishNumber(inputValue);
      event.target.value = convertedValue;
    });

    // Event listener for input field 'iben number'
    document.getElementById('id_beneficiaryinfo_iban').addEventListener('input', function (event) {
      const inputValue = event.target.value;
      const convertedValue = convertToEnglishNumber(inputValue);
      event.target.value = convertedValue;
    });

    // Function to handle the input event on the educational status dropdown
    function handleEducationalStatusEditInput() {
      // Get the selected value
      var selectedValue = document.getElementById('id_dependent_edit_info_educational_status').value;
      
      // Get the elements representing educational level and degree sections
      var educationalLevelGroup = document.getElementById('id_dependent_edit_info_educational_level_group_info');
      var educationalDegreeGroup = document.getElementById('id_dependent_edit_info_educational_degree_group_info');

      // Show or hide the sections based on the selected value
      if (selectedValue === 'يدرس') {
        // If يدرس is selected, show educational level and hide educational degree
        educationalLevelGroup.style.display = 'block';
        educationalDegreeGroup.style.display = 'none';
      } else if (selectedValue === 'لا يدرس') {
        // If لا يدرس is selected, show educational degree and hide educational level
        educationalLevelGroup.style.display = 'none';
        educationalDegreeGroup.style.display = 'block';
      } else {
        // If none is selected, hide both sections
        educationalLevelGroup.style.display = 'none';
        educationalDegreeGroup.style.display = 'none';
      }
    }

    // Function to handle the input event on the educational status dropdown
    function handleHealthStatusEditInput() {
      // Get the selected value
      var selectedValue = document.getElementById('id_dependent_edit_info_health_status').value;
      
      // Get the elements representing educational level and degree sections
      var diseaseTypeGroup = document.getElementById('id_dependent_edit_info_disease_type_group_info');

      // Show or hide the sections based on the selected value
      if (selectedValue === 'جيدة') {
        diseaseTypeGroup.style.display = 'none';
      } else if (selectedValue === 'غير جيدة') {
        diseaseTypeGroup.style.display = 'block';
      } else {
        // If none is selected, hide both sections
        diseaseTypeGroup.style.display = 'none';
      }
    }

    // Function to handle the modal's shown event
    function handleModalShown() {
      // Show loading state
      document.getElementById('loadingStateEditModal').style.display = 'block';
      document.getElementById('editModalContent').style.display = 'none';

      // Simulate an asynchronous operation (replace this with your actual data retrieval logic)
      setTimeout(function () {
        // Hide loading state
        document.getElementById('loadingStateEditModal').style.display = 'none';
        // Show actual content
        document.getElementById('editModalContent').style.display = 'block';
        
        // Call the function on the educational status dropdown to set the initial visibility
        handleEducationalStatusEditInput.call(educationalStatusDropdown);
        handleHealthStatusEditInput.call();
      }, 2000); // Replace 2000 with the actual time it takes to load data
      
    }

    // Add event listener to the educational status dropdown for the input event
    var educationalStatusDropdown = document.getElementById('id_dependent_info_educational_status');
    educationalStatusDropdown.addEventListener('input', handleEducationalStatusEditInput);

    var healthStatusDropdown = document.getElementById('id_dependent_edit_info_health_status');
    healthStatusDropdown.addEventListener('input', handleHealthStatusEditInput);

    // Get the modal element
    var editModal = new bootstrap.Modal(document.getElementById('editModal'));

    // Add event listener to the modal's shown event
    editModal._element.addEventListener('shown.bs.modal', handleModalShown);

  });
</script>
{% endblock %}
