{% extends 'base.html' %}{% load static %}{% block title %}تحديث بيانات المستفيد{% endblock %}
{% block head %}
<!-- Include jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Include jQuery Validation Plugin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>

<script src="{% static 'js/beneficiary_request_update.js' %}"></script>

{% endblock %}
{% block content %}
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
<div class="container mt-5">
  <div class="nav-breadcrumb mb-4">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'home' %}">الصفحة الرئيسية</a></li>
        <li class="breadcrumb-item"><a href="{% url 'beneficiary_requests' user_id=user.id %}">الطلبات</a></li>
        <li class="breadcrumb-item active" aria-current="page">تحديث بيانات المستفيد</li>
      </ol>
    </nav>
  </div>

  <div class="card bg-light">
    <div class="card-body">
      <h2 class="card-title fw-bold mt-3">تحديث بيانات المستفيد</h2>
      <small class="text-muted">رقم المستفيد #{{ beneficiary.id }}</small>
      <!-- Tabs navs -->
      
        <div class="mt-4">

          <div class="alert alert-danger" role="alert" id="alert-danger-error-fields">
            
          </div>
          <ul class="nav nav-fill nav-tabs" role="tablist">
            <li class="nav-item" role="presentation">
              <a class="nav-link active text-dark next" id="fill-tab-0" data-bs-toggle="tab" href="#fill-tabpanel-0" role="tab" aria-controls="fill-tabpanel-0" aria-selected="true"> المعلومات الشخصية </a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link text-dark next" id="fill-tab-1" data-bs-toggle="tab" href="#fill-tabpanel-1" role="tab" aria-controls="fill-tabpanel-1" aria-selected="false"> معلومات السكن </a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link text-dark next" id="fill-tab-2" data-bs-toggle="tab" href="#fill-tabpanel-2" role="tab" aria-controls="fill-tabpanel-2" aria-selected="false"> معلومات الدخل والمصروفات </a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link text-dark next" id="fill-tab-3" data-bs-toggle="tab" href="#fill-tabpanel-3" role="tab" aria-controls="fill-tabpanel-3" aria-selected="false"> المرفقات </a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link text-dark next" id="fill-tab-4" data-bs-toggle="tab" href="#fill-tabpanel-4" role="tab" aria-controls="fill-tabpanel-4" aria-selected="false"> معلومات المرافقين </a>
            </li>
          </ul>

          <div class="tab-content pt-3" id="tab-content">
            <form
              id="edit_beneficiary_request_form"
              name="edit_beneficiary_request_form"
              enctype="multipart/form-data"
              method="POST"
              action="{% url 'beneficiary_request_update_confirm' user_id=user_info.id %}"
              class="needs-validation tab-content"
              novalidate
            >
            {% csrf_token %}
              <div class="tab-pane active" id="fill-tabpanel-0" role="tabpanel" aria-labelledby="fill-tab-0">

                <div class="personal_info">
                  <h3 class="mt-4 mb-4">المعلومات الشخصية</h3>
                  <div class="row row-cols-lg-2 row-cols-xl-4">
                    <div class="mb-3">
                      <h6 class="col form-label" for="id_personalinfo_file_no">رقم الملف</h6>
                      <input type="text" class="form-control" id="id_personalinfo_file_no" name="personalinfo_file_no" value="{{ beneficiary.file_no }}" disabled readonly>
                    </div>
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_first_name">الأسم الأول<span style="color: red">*</span></h6>
                      <input type="text" class="form-control" id="id_personalinfo_first_name" name="personalinfo_first_name" data-bs-title="الأسم الأول" value="{{ beneficiary.user.first_name }}" disabled readonly>
                    </div>
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_second_name">الأسم الثاني<span style="color: red">*</span></h6>
                      <input type="text" class="form-control" id="id_personalinfo_second_name" name="personalinfo_second_name" data-bs-title="الأسم الثاني" value="{{ beneficiary.user.second_name }}" disabled readonly>
                    </div>
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_last_name">الأسم الأخير<span style="color: red">*</span></h6>
                      <input type="text" class="form-control" id="id_personalinfo_last_name" name="personalinfo_last_name" data-bs-title="الأسم الأخير" value="{{ beneficiary.user.last_name }}" disabled readonly>
                    </div>
                  </div>
        
                  <div class="row row-cols-lg-2 row-cols-xl-4">
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_gender">الجنس<span style="color: red">*</span></h6>
                      <select
                        name="personalinfo_gender"
                        class="form-select"
                        id="id_personalinfo_gender"
                        data-bs-title="الجنس"
                        disabled
                        readonly
                      >
                        <option value>---------</option>
                        <option value="ذكر">ذكر</option>
                        <option value="انثى">انثى</option>
                      </select>
                    </div>
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_date_of_birth">تاريخ الميلاد<span style="color: red">*</span></h6>
                      <input disabled readonly type="date" class="form-control" id="id_personalinfo_date_of_birth" name="personalinfo_date_of_birth" data-bs-title="تاريخ الميلاد">
                    </div>
                    <div class="col mb-3 form-group">
                      <label for="id_personalinfo_phone_number" class="form-label"
                        >رقم الجوال<span style="color: red">*</span></label
                      >
                      <div class="input-group mb-1">
                        <input
                          type="text"
                          name="personalinfo_phone_number"
                          data-bs-title="رقم الجوال" 
                          class="form-control convert-to-english"
                          id="id_personalinfo_phone_number"
                          placeholder="5XXXXXXXX"
                          value="{{ user_info.phonenumber }}"
                          disabled
                          readonly
                        />
                        <span class="input-group-text" id="basic-addon1">966+</span>
                      </div>
                      <div class="form-text" id="basic-addon4">يبدا رقم الجوال بدون الصفر, مثال (512345678)</div>
                    </div>
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_email">البريد الالكتروني<span style="color: red">*</span></h6>
                      <input disabled readonly type="email" class="form-control" id="id_personalinfo_email" name="personalinfo_email" data-bs-title="البريد الالكتروني" value="{{ user_info.email }}"
                      disabled
                      readonly>
                    </div>
                  </div>

                  <hr>
        
                  <div class="row row-cols-md-1 row-cols-xl-3">
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_nationality">الجنسية<span style="color: red">*</span></h6>
                      <select
                        name="personalinfo_nationality"
                        class="form-select"
                        id="id_personalinfo_nationality"
                        data-bs-title="الجنسية"
                        disabled
                        readonly
                      >
                        <option value>إختر</option>
                        <option value="السعودية">السعودية</option>
                        <option value="أفغانستان">أفغانستان</option>
                        <option value="ألبانيا">ألبانيا</option>
                        <option value="الجزائر">الجزائر</option>
                        <option value="أندورا">أندورا</option>
                        <option value="أنغولا">أنغولا</option>
                        <option value="أنتيغوا وباربودا">أنتيغوا وباربودا</option>
                        <option value="الأرجنتين">الأرجنتين</option>
                        <option value="أرمينيا">أرمينيا</option>
                        <option value="أستراليا">أستراليا</option>
                        <option value="النمسا">النمسا</option>
                        <option value="أذربيجان">أذربيجان</option>
                        <option value="البهاما">البهاما</option>
                        <option value="البحرين">البحرين</option>
                        <option value="بنغلاديش">بنغلاديش</option>
                        <option value="باربادوس">باربادوس</option>
                        <option value="بيلاروسيا">بيلاروسيا</option>
                        <option value="بلجيكا">بلجيكا</option>
                        <option value="بليز">بليز</option>
                        <option value="بنين">بنين</option>
                        <option value="بوتان">بوتان</option>
                        <option value="بوليفيا">بوليفيا</option>
                        <option value="البوسنة والهرسك ">البوسنة والهرسك</option>
                        <option value="بوتسوانا">بوتسوانا</option>
                        <option value="البرازيل">البرازيل</option>
                        <option value="بروناي">بروناي</option>
                        <option value="بلغاريا">بلغاريا</option>
                        <option value="بوركينا فاسو ">بوركينا فاسو</option>
                        <option value="بوروندي">بوروندي</option>
                        <option value="كمبوديا">كمبوديا</option>
                        <option value="الكاميرون">الكاميرون</option>
                        <option value="كندا">كندا</option>
                        <option value="الرأس الأخضر">الرأس الأخضر</option>
                        <option value="جمهورية أفريقيا الوسطى ">
                          جمهورية أفريقيا الوسطى
                        </option>
                        <option value="تشاد">تشاد</option>
                        <option value="تشيلي">تشيلي</option>
                        <option value="الصين">الصين</option>
                        <option value="كولومبيا">كولومبيا</option>
                        <option value="جزر القمر">جزر القمر</option>
                        <option value="كوستاريكا">كوستاريكا</option>
                        <option value="ساحل العاج">ساحل العاج</option>
                        <option value="كرواتيا">كرواتيا</option>
                        <option value="كوبا">كوبا</option>
                        <option value="قبرص">قبرص</option>
                        <option value="التشيك">التشيك</option>
                        <option value="جمهورية الكونغو الديمقراطية">
                          جمهورية الكونغو الديمقراطية
                        </option>
                        <option value="الدنمارك">الدنمارك</option>
                        <option value="جيبوتي">جيبوتي</option>
                        <option value="دومينيكا">دومينيكا</option>
                        <option value="جمهورية الدومينيكان">
                          جمهورية الدومينيكان
                        </option>
                        <option value="تيمور الشرقية ">تيمور الشرقية</option>
                        <option value="الإكوادور">الإكوادور</option>
                        <option value="مصر">مصر</option>
                        <option value="السلفادور">السلفادور</option>
                        <option value="غينيا الاستوائية">غينيا الاستوائية</option>
                        <option value="إريتريا">إريتريا</option>
                        <option value="إستونيا">إستونيا</option>
                        <option value="إثيوبيا">إثيوبيا</option>
                        <option value="فيجي">فيجي</option>
                        <option value="فنلندا">فنلندا</option>
                        <option value="فرنسا">فرنسا</option>
                        <option value="الغابون">الغابون</option>
                        <option value="غامبيا">غامبيا</option>
                        <option value="جورجيا">جورجيا</option>
                        <option value="ألمانيا">ألمانيا</option>
                        <option value="غانا">غانا</option>
                        <option value="اليونان">اليونان</option>
                        <option value="جرينادا">جرينادا</option>
                        <option value="غواتيمالا">غواتيمالا</option>
                        <option value="غينيا">غينيا</option>
                        <option value="غينيا بيساو">غينيا بيساو</option>
                        <option value="غويانا">غويانا</option>
                        <option value="هايتي">هايتي</option>
                        <option value="هندوراس">هندوراس</option>
                        <option value="المجر">المجر</option>
                        <option value="آيسلندا">آيسلندا</option>
                        <option value="الهند">الهند</option>
                        <option value="إندونيسيا">إندونيسيا</option>
                        <option value="إيران">إيران</option>
                        <option value="العراق">العراق</option>
                        <option value="جمهورية أيرلندا ">جمهورية أيرلندا</option>
                        <option value="فلسطين">فلسطين</option>
                        <option value="إيطاليا">إيطاليا</option>
                        <option value="جامايكا">جامايكا</option>
                        <option value="اليابان">اليابان</option>
                        <option value="الأردن">الأردن</option>
                        <option value="كازاخستان">كازاخستان</option>
                        <option value="كينيا">كينيا</option>
                        <option value="كيريباتي">كيريباتي</option>
                        <option value="الكويت">الكويت</option>
                        <option value="قرغيزستان">قرغيزستان</option>
                        <option value="لاوس">لاوس</option>
                        <option value="لاوس">لاوس</option>
                        <option value="لاتفيا">لاتفيا</option>
                        <option value="لبنان">لبنان</option>
                        <option value="ليسوتو">ليسوتو</option>
                        <option value="ليبيريا">ليبيريا</option>
                        <option value="ليبيا">ليبيا</option>
                        <option value="ليختنشتاين">ليختنشتاين</option>
                        <option value="ليتوانيا">ليتوانيا</option>
                        <option value="لوكسمبورغ">لوكسمبورغ</option>
                        <option value="مدغشقر">مدغشقر</option>
                        <option value="مالاوي">مالاوي</option>
                        <option value="ماليزيا">ماليزيا</option>
                        <option value="جزر المالديف">جزر المالديف</option>
                        <option value="مالي">مالي</option>
                        <option value="مالطا">مالطا</option>
                        <option value="جزر مارشال">جزر مارشال</option>
                        <option value="موريتانيا">موريتانيا</option>
                        <option value="موريشيوس">موريشيوس</option>
                        <option value="المكسيك">المكسيك</option>
                        <option value="مايكرونيزيا">مايكرونيزيا</option>
                        <option value="مولدوفا">مولدوفا</option>
                        <option value="موناكو">موناكو</option>
                        <option value="منغوليا">منغوليا</option>
                        <option value="الجبل الأسود">الجبل الأسود</option>
                        <option value="المغرب">المغرب</option>
                        <option value="موزمبيق">موزمبيق</option>
                        <option value="بورما">بورما</option>
                        <option value="ناميبيا">ناميبيا</option>
                        <option value="ناورو">ناورو</option>
                        <option value="نيبال">نيبال</option>
                        <option value="هولندا">هولندا</option>
                        <option value="نيوزيلندا">نيوزيلندا</option>
                        <option value="نيكاراجوا">نيكاراجوا</option>
                        <option value="النيجر">النيجر</option>
                        <option value="نيجيريا">نيجيريا</option>
                        <option value="كوريا الشمالية ">كوريا الشمالية</option>
                        <option value="النرويج">النرويج</option>
                        <option value="سلطنة عمان">سلطنة عمان</option>
                        <option value="باكستان">باكستان</option>
                        <option value="بالاو">بالاو</option>
                        <option value="بنما">بنما</option>
                        <option value="بابوا غينيا الجديدة">
                          بابوا غينيا الجديدة
                        </option>
                        <option value="باراغواي">باراغواي</option>
                        <option value="بيرو">بيرو</option>
                        <option value="الفلبين">الفلبين</option>
                        <option value="بولندا">بولندا</option>
                        <option value="البرتغال">البرتغال</option>
                        <option value="قطر">قطر</option>
                        <option value="جمهورية الكونغو">جمهورية الكونغو</option>
                        <option value="جمهورية مقدونيا">جمهورية مقدونيا</option>
                        <option value="رومانيا">رومانيا</option>
                        <option value="روسيا">روسيا</option>
                        <option value="رواندا">رواندا</option>
                        <option value="سانت كيتس ونيفيس">سانت كيتس ونيفيس</option>
                        <option value="سانت لوسيا">سانت لوسيا</option>
                        <option value="سانت فنسينت والجرينادينز">
                          سانت فنسينت والجرينادينز
                        </option>
                        <option value="ساموا">ساموا</option>
                        <option value="سان مارينو">سان مارينو</option>
                        <option value="ساو تومي وبرينسيب">
                          ساو تومي وبرينسيب
                        </option>
                        <option value="السنغال">السنغال</option>
                        <option value="صربيا">صربيا</option>
                        <option value="سيشيل">سيشيل</option>
                        <option value="سيراليون">سيراليون</option>
                        <option value="سنغافورة">سنغافورة</option>
                        <option value="سلوفاكيا">سلوفاكيا</option>
                        <option value="سلوفينيا">سلوفينيا</option>
                        <option value="جزر سليمان">جزر سليمان</option>
                        <option value="الصومال">الصومال</option>
                        <option value="جنوب أفريقيا">جنوب أفريقيا</option>
                        <option value="كوريا الجنوبية">كوريا الجنوبية</option>
                        <option value="جنوب السودان">جنوب السودان</option>
                        <option value="إسبانيا">إسبانيا</option>
                        <option value="سريلانكا">سريلانكا</option>
                        <option value="السودان">السودان</option>
                        <option value="سورينام">سورينام</option>
                        <option value="سوازيلاند">سوازيلاند</option>
                        <option value="السويد">السويد</option>
                        <option value="سويسرا">سويسرا</option>
                        <option value="سوريا">سوريا</option>
                        <option value="طاجيكستان">طاجيكستان</option>
                        <option value="تنزانيا">تنزانيا</option>
                        <option value="تايلاند">تايلاند</option>
                        <option value="توغو">توغو</option>
                        <option value="تونجا">تونجا</option>
                        <option value="ترينيداد وتوباغو">ترينيداد وتوباغو</option>
                        <option value="تونس">تونس</option>
                        <option value="تركيا">تركيا</option>
                        <option value="تركمانستان">تركمانستان</option>
                        <option value="توفالو">توفالو</option>
                        <option value="أوغندا">أوغندا</option>
                        <option value="أوكرانيا">أوكرانيا</option>
                        <option value="الإمارات العربية المتحدة">
                          الإمارات العربية المتحدة
                        </option>
                        <option value="المملكة المتحدة">المملكة المتحدة</option>
                        <option value="الولايات المتحدة">الولايات المتحدة</option>
                        <option value="أوروغواي">أوروغواي</option>
                        <option value="أوزبكستان">أوزبكستان</option>
                        <option value="فانواتو">فانواتو</option>
                        <option value="فنزويلا">فنزويلا</option>
                        <option value="فيتنام">فيتنام</option>
                        <option value="اليمن">اليمن</option>
                        <option value="زامبيا">زامبيا</option>
                        <option value="زيمبابوي">زيمبابوي</option>
                      </select>
                    </div>
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_national_id">رقم الهوية/الإقامة<span style="color: red">*</span></h6>
                      <input disabled readonly type="text" class="form-control convert-to-english" id="id_personalinfo_national_id" name="personalinfo_national_id" data-bs-title="رقم الهوية / الإقامة" value="{{ user_info.national_id }}">
                    </div>
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_national_id_exp_date">تاريخ انتهاء الهوية/الإقامة<span style="color: red">*</span></h6>
                      <input type="date" class="form-control" id="id_personalinfo_national_id_exp_date" name="personalinfo_national_id_exp_date"
                      data-bs-title="تاريخ انتهاء الهوية / الإقامة"
                      disabled
                      readonly>
                    </div>
                  </div>
        
                  <div class="row row-cols-md-1 row-cols-lg-3">
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_category">التصنيف الرئيسي<span style="color: red">*</span></h6>
                      <select
                        name="personalinfo_category"
                        class="form-select"
                        id="id_personalinfo_category"
                        data-bs-title="التصنيف الرئيسي"
                        onchange="categoryCheck(this);"
                      >
                        <option value>---------</option>
                        <option value="أسرة عادية">أسرة عادية</option>
                        <option value="أسرة أيتام">أسرة أيتام</option>
                        <option value="أسرة أرملة">أسرة أرملة</option>
                        <option value="أسرة سجناء">أسرة سجناء</option>
                        <option value="أسرة مطلقة">أسرة مطلقة</option>
                        <option value="فرد">فرد</option>
                      </select>
                    </div>
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_marital_status">الحالة الاجتماعية<span style="color: red">*</span></h6>
                      <select
                        name="personalinfo_marital_status"
                        class="form-select"
                        id="id_personalinfo_marital_status"
                        onchange="widowerCheck(this);"
                        data-bs-title="الحالة الاجتماعية"
                      >
                        <option value>---------</option>
                        <option value="متزوج/ـة">متزوج/ـة</option>
                        <option value="أعزب/ـة">أعزب/ـة</option>
                        <option value="أرمل/ـة">أرمل/ـة</option>
                        <option value="مطلقة">مطلقة</option>
                        <option value="مهجورة">مهجورة</option>
                      </select>
                    </div>
        
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_educational_level">المستوى التعليمي<span style="color: red">*</span></h6>
                      <select
                        name="personalinfo_educational_level"
                        class="form-select"
                        id="id_personalinfo_educational_level"
                        data-bs-title="المستوى التعليمي"
                      >
                        <option value>---------</option>
                        <option value="أُمّيّ (لا يقرأ ولا يكتب)">أُمّيّ (لا يقرأ ولا يكتب)</option>
                        <option value="يقرأ ويكتب">يقرأ ويكتب</option>
                        <option value="أول ابتدائي">أول ابتدائي</option>
                        <option value="ثاني ابتدائي">ثاني ابتدائي</option>
                        <option value="ثالث ابتدائي">ثالث ابتدائي</option>
                        <option value="رابع ابتدائي">رابع ابتدائي</option>
                        <option value="خامس ابتدائي">خامس ابتدائي</option>
                        <option value="سادس ابتدائي">سادس ابتدائي</option>
                        <option value="أول متوسط">أول متوسط</option>
                        <option value="ثاني متوسط">ثاني متوسط</option>
                        <option value="ثالث متوسط">ثالث متوسط</option>
                        <option value="أول ثانوي">أول ثانوي</option>
                        <option value="ثاني ثانوي">ثاني ثانوي</option>
                        <option value="ثالث ثانوي">ثالث ثانوي</option>
                        <option value="جامعي">جامعي</option>
                        
                      </select>
                    </div>
                  </div>

                  <hr>

                  <div class="row row-cols-lg-2" id="id_personalinfo_widower_group_info"
                  {% if beneficiary_death_date_father_husband or beneficiary.washing_place %}{% else %}style="display: none !important"{% endif %}>
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_death_date_father_husband">تاريخ وفاة الأب/الزوج</h6>
                      <input type="date" class="form-control" id="id_personalinfo_death_date_father_husband" name="personalinfo_death_date_father_husband"
                      data-bs-title="تاريخ وفاة الأب/الزوج">
                    </div>
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_washing_place">المغسلة التي تم التجهيز فيها</h6>
                      <select
                        name="personalinfo_washing_place"
                        class="form-select"
                        id="id_personalinfo_washing_place"
                        data-bs-title="المغسلة التي تم التجهيز فيها"
                      >
                        <option value>---------</option>
                        <option value="إكرام فلسطين">إكرام فلسطين</option>
                        <option value="الثنيان">الثنيان</option>
                        <option value="العمودي">العمودي</option>
                        <option value="ابن القيم">ابن القيم</option>
                        <option value="الأمير منصور">الأمير منصور</option>
                        <option value="الملك فهد">الملك فهد</option>
                        <option value="الملك عبدالعزيز">الملك عبدالعزيز</option>
                        <option value="اللامي">اللامي</option>
                        <option value="طيبة">طيبة</option>
                        <option value="القريقري">القريقري</option>
                        <option value="شرق جدة">شرق جدة</option>
                        <option value="أخرى">أخرى</option>
                      </select>
                    </div>
                  </div>

                  <hr id="widower_hr" style="display: none"/>
        
                  <div class="row row-cols-lg-2 row-cols-xl-4">
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_health_status">الحالة الصحية<span style="color: red">*</span></h6>
                      <select
                        name="personalinfo_health_status"
                        class="form-select"
                        id="id_personalinfo_health_status"
                        onchange="personalInfoHealthCheck(this);"
                        data-bs-title="الحالة الصحية"
                      >
                        <option value>---------</option>
                        <option value="جيدة">جيدة</option>
                        <option value="غير جيدة">غير جيدة</option>
                      </select>
                    </div>
                    <div class="mb-3 form-group" id="id_personalinfo_disease_type_group_info"
                    {% if beneficiary.disease_type %}{% else %}style="display: none !important"{% endif %}>
                      <h6 class="col form-label" for="id_personalinfo_disease_type">نوع المرض</h6>
                      <input type="text" class="form-control" id="id_personalinfo_disease_type" name="personalinfo_disease_type" data-bs-title="نوع المرض" value="{{ beneficiary.disease_type }}">
                    </div>
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_work_status">هل يعمل؟<span style="color: red">*</span></h6>
                      <select
                        name="personalinfo_work_status"
                        class="form-select"
                        id="id_personalinfo_work_status"
                        onchange="workCheck(this);"
                        data-bs-title="هل يعمل؟"
                      >
                        <option value=>---------</option>
                        <option value="نعم">نعم</option>
                        <option value="لا">لا</option>
                      </select>
                    </div>
                    <div class="mb-3 form-group" id="id_personalinfo_employer_group_info"
                    {% if beneficiary.employer %}{% else %}style="display: none !important"{% endif %}>
                      <h6 class="col form-label" for="id_personalinfo_employer">جهة العمل</h6>
                      <input type="text" class="form-control" id="id_personalinfo_employer" name="personalinfo_employer" data-bs-title="جهة العمل" value="{{ beneficiary.employer }}">
                    </div>
                  </div>
                  
                  <div class="row row-cols-lg-2">
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_bank_iban">رقم الإيبان<span style="color: red">*</span></h6>
                      <input type="text" class="form-control convert-to-english" id="id_personalinfo_bank_iban" name="personalinfo_bank_iban" data-bs-title="رقم الإيبان" value="{{ beneficiary.bank_iban }}">
                    </div>
                    <div class="mb-3 form-group">
                      <h6 class="col form-label" for="id_personalinfo_bank_type">أسم البنك<span style="color: red">*</span></h6>
                      <select
                        name="personalinfo_bank_type"
                        class="form-select"
                        id="id_personalinfo_bank_type"
                        data-bs-title="أسم البنك"
                      >
                        <option value>---------</option>
                        <option value="الأهلي السعودي">الأهلي السعودي</option>
                        <option value="الراجحي">الراجحي</option>
                        <option value="الجزيرة">الجزيرة</option>
                        <option value="الإنماء">الإنماء</option>
                        <option value="البلاد">البلاد</option>
                        <option value="الرياض">الرياض</option>
                        <option value="ساب">ساب</option>
                        <option value="السعودي الفرنسي">السعودي الفرنسي</option>
                        <option value="العربي">العربي</option>
                        <option value="مسقط">مسقط</option>
                        <option value="الإمارات دبي الوطني">الإمارات دبي الوطني</option>
                        <option value="الخليج الدولي">الخليج الدولي</option>
                        <option value="البحرين الوطني">البحرين الوطني</option>
                        <option value="الكويت الوطني">الكويت الوطني</option>
                        <option value="باكستان الوطني">باكستان الوطني</option>
                        <option value="الأول">الأول</option>
                        <option value="السعودي للاستثمار">السعودي للاستثمار</option>
                        <option value="زراعات">زراعات</option>
                        <option value="أخرى">أخرى</option>
                      </select>
                    </div>
                  </div>

                  <hr>

                  <div class="row mt-3" id="family_issues_needs_container">
                    <div class="col-md-6 mb-4 form-group">
                      <label class="form-label"
                        >المشكلات التي تعاني منها الأسرة<span style="color: red">*</span> <span class="text-muted" style="font-size: 0.9rem">
                          (إختيار متعدد)</span
                        ></label
                      >
                        <div
                          name="familyinfo_family_issues"
                          class="d-grid gap-2"
                          style="grid-template-columns: 1fr 1fr;"
                          id="id_familyinfo_family_issues"
                        >
                          <input type="checkbox" class="btn-check" id="id_familyinfo_issues_economical" autocomplete="off" name="familyinfo_issues_economical" value="اقتصادية">
                          <label class="btn btn-outline-primary" for="id_familyinfo_issues_economical">اقتصادية</label>
      
                          <input type="checkbox" class="btn-check" id="id_familyinfo_issues_educational" autocomplete="off" name="familyinfo_issues_educational" value="تعليمية">
                          <label class="btn btn-outline-primary" for="id_familyinfo_issues_educational">تعليمية</label>
      
                          <input type="checkbox" class="btn-check" id="id_familyinfo_issues_employment" autocomplete="off" name="familyinfo_issues_employment" value="توظيف">
                          <label class="btn btn-outline-primary" for="id_familyinfo_issues_employment">توظيف</label>
      
                          <input type="checkbox" class="btn-check" id="id_familyinfo_issues_sponsorship" autocomplete="off" name="familyinfo_issues_sponsorship" value="كفالة">
                          <label class="btn btn-outline-primary" for="id_familyinfo_issues_sponsorship">كفالة</label>
      
                          <input type="checkbox" class="btn-check" id="id_familyinfo_issues_healthy" autocomplete="off" name="familyinfo_issues_healthy" value="صحية">
                          <label class="btn btn-outline-primary" for="id_familyinfo_issues_healthy">صحية</label>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4 form-group">
                      <label class="form-label"
                        >احتياجات الأسرة<span style="color: red">*</span> <span class="text-muted" style="font-size: 0.9rem">
                          (إختيار متعدد)</span
                        ></label
                      >
                      <div
                        name="familyinfo_needs_type"
                        class="d-grid gap-2"
                        style="grid-template-columns: 1fr 1fr;"
                        id="id_familyinfo_needs_type"
                      >
                        <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_food_baskets" autocomplete="off" name="familyinfo_needs_type_food_baskets" value="سلال غذائية">
                        <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_food_baskets">سلال غذائية</label>
      
                        <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_clothing" autocomplete="off" name="familyinfo_needs_type_clothing" value="كسوة">
                        <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_clothing">كسوة</label>
      
                        <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_school_bags"  autocomplete="off" name="familyinfo_needs_type_school_bags" value="حقائب مدرسية">
                        <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_school_bags">حقائب مدرسية</label>
      
                        <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_water_filters"  autocomplete="off" name="familyinfo_needs_type_water_filters" value="فلاتر مياه">
                        <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_water_filters">فلاتر مياه</label>
      
                        <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_rent_payment"  autocomplete="off" name="familyinfo_needs_type_rent_payment" value="سداد إيجار">
                        <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_rent_payment">سداد إيجار</label>
      
                        <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_electricity_payment"  autocomplete="off" name="familyinfo_needs_type_electricity_payment" value="سداد كهرباء">
                        <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_electricity_payment">سداد كهرباء</label>
      
                        <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_dept_payment" autocomplete="off" name="familyinfo_needs_type_dept_payment" value="سداد دين">
                        <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_dept_payment">سداد دين</label>
      
                        <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_training"  autocomplete="off" name="familyinfo_needs_type_training" value="تدريب">
                        <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_training">تدريب</label>
      
                        <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_electronic_devices" autocomplete="off" name="familyinfo_needs_type_electronic_devices" value="أجهزة كهربائية">
                        <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_electronic_devices">أجهزة كهربائية</label>
      
                        <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_furniture" autocomplete="off" name="familyinfo_needs_type_furniture" value="أثاث">
                        <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_furniture">أثاث</label>
      
                        <input type="checkbox" class="btn-check" id="id_familyinfo_needs_type_home_renovation" autocomplete="off" name="familyinfo_needs_type_home_renovation" value="ترميم">
                        <label class="btn btn-outline-primary" for="id_familyinfo_needs_type_home_renovation">ترميم</label>
                      </div>
                    </div>
                  </div>
                </div> <!-- end line personal info --> 
        
              </div>
              <div class="tab-pane" id="fill-tabpanel-1" role="tabpanel" aria-labelledby="fill-tab-1">

                <div class="housing_info">
                  <h3 class="mt-4 mb-4">معلومات السكن</h3>
                  <div class="row row-cols-lg-2 row-cols-xl-4">
                    <div class="mb-3 form-group">
                      <label for="id_houseinfo_building_number" class="form-label"
                        >رقم المبنى<span style="color: red">*</span></label>
                      <input
                        type="number"
                        name="houseinfo_building_number"
                        min="0"
                        max="9999999"
                        class="form-control text-start"
                        id="id_houseinfo_building_number"
                        value="{{ beneficiary_house.building_number }}"
                        data-bs-title="رقم المبنى"
                      />
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_houseinfo_street_name" class="form-label"
                        >اسم الشارع<span style="color: red">*</span></label>
                      <input
                        type="text"
                        name="houseinfo_street_name"
                        maxlength="50"
                        class="form-control"
                        id="id_houseinfo_street_name"
                        value="{{ beneficiary_house.street_name }}"
                        data-bs-title="اسم الشارع"
                      />
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_houseinfo_neighborhood" class="form-label"
                        >الحي<span style="color: red">*</span></label>
                      <input
                        type="text"
                        name="houseinfo_neighborhood"
                        maxlength="50"
                        class="form-control"
                        id="id_houseinfo_neighborhood"
                        value="{{ beneficiary_house.neighborhood }}"
                        data-bs-title="الحي"
                      />
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_houseinfo_city" class="form-label"
                        >المدينة<span style="color: red">*</span></label>
                      <input
                        type="text"
                        name="houseinfo_city"
                        maxlength="50"
                        class="form-control"
                        id="id_houseinfo_city"
                        value="{{ beneficiary_house.city }}"
                        data-bs-title="المدينة"
                      />
                    </div>
                  </div>
        
                  <div class="row row-cols-lg-3">
                    <div class="mb-3 form-group">
                      <label for="id_houseinfo_postal_code" class="form-label"
                        >الرمز البريدي<span style="color: red">*</span></label>
                      <input
                        type="number"
                        name="houseinfo_postal_code"
                        min="0"
                        max="9999999"
                        class="form-control"
                        id="id_houseinfo_postal_code"
                        value="{{ beneficiary_house.postal_code }}"
                        data-bs-title="الرمز البريدي"
                      />
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_houseinfo_additional_number" class="form-label"
                        >الرقم الإضافي<span style="color: red">*</span></label>
                      <input
                        type="number"
                        name="houseinfo_additional_number"
                        min="0"
                        max="9999999"
                        class="form-control text-start"
                        id="id_houseinfo_additional_number"
                        value="{{ beneficiary_house.additional_number }}"
                        data-bs-title="الرقم الإضافي"
                      />
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_houseinfo_unit" class="form-label">الوحدة<span style="color: red">*</span></label>
                      <input
                        type="text"
                        name="houseinfo_unit"
                        maxlength="50"
                        class="form-control convert-to-english"
                        id="id_houseinfo_unit"
                        value="{{ beneficiary_house.unit }}"
                        data-bs-title="الوحدة"
                      />
                    </div>
                  </div>
        
                  <div class="row row-cols-xl-3">
                    <div class="mb-3 form-group">
                      <label for="id_houseinfo_location_url" class="form-label"
                        >رابط موقع المنزل<span style="color: red">*</span> (google maps)</label>
                      <input
                        type="url"
                        name="houseinfo_location_url"
                        maxlength="250"
                        class="form-control"
                        id="id_houseinfo_location_url"
                        value="{{ beneficiary_house.location_url }}"
                        data-bs-title="رابط موقع المنزل (google maps)"
                      />
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_houseinfo_housing_type" class="form-label"
                        >نوع السكن<span style="color: red">*</span></label>
                      <select
                        name="houseinfo_housing_type"
                        class="form-select"
                        id="id_houseinfo_housing_type"
                        data-bs-title="نوع السكن"
                      >
                        <option value>---------</option>
                        <option value="شعبي">شعبي</option>
                        <option value="شقة">شقة</option>
                        <option value="فيلا">فيلا</option>
                        <option value="ملحق">ملحق</option>
                      </select>
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_houseinfo_housing_ownership" class="form-label"
                        >ملكية السكن<span style="color: red">*</span></label>
                      <select
                        name="houseinfo_housing_ownership"
                        class="form-select"
                        id="id_houseinfo_housing_ownership"
                        data-bs-title="ملكية السكن"
                      >
                        <option value>---------</option>
                        <option value="ملك">ملك</option>
                        <option value="وقف">وقف</option>
                        <option value="إيجار">إيجار</option>
                        <option value="سكن تنموي (منتهي بالتمليك)">سكن تنموي (منتهي بالتمليك)</option>
                      </select>
                    </div>
                  </div>

                </div>
              </div>
              <div class="tab-pane" id="fill-tabpanel-2" role="tabpanel" aria-labelledby="fill-tab-2">

                <div class="income_expenses_info">
                  <h3 class="mb-4 mt-4">معلومات مصادر الدخل والمصروفات</h3>
                  <h4 class="mt-2 mb-3">مصادر دخل رب الأسرة (شهريًا)</h4>
                  <div
                    class="alert alert-warning mt-3"
                    role="alert"
                    id="checkboxError"
                  >
                    الرجاء إدخال مصادر الدخل ادناه, وفي حال عدم وجود الدخل المسمى,
                    يرجى ادخال قيمة صفر (0)
                  </div>
                  <div class="row row-cols-lg-2 row-cols-xl-4 mt-4">
                    <div class="mb-3 form-group">
                      <label for="id_incomeinfo_salary" class="form-label"
                        >الراتب<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="incomeinfo_salary"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_incomeinfo_salary"
                          value="{{ beneficiary_income_expense.salary_in }}"
                          data-bs-title="الراتب"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_incomeinfo_social_insurance" class="form-label"
                        >التأمينات الاجتماعية<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="incomeinfo_social_insurance"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_incomeinfo_social_insurance"
                          value="{{ beneficiary_income_expense.social_insurance_in }}"
                          data-bs-title="التأمينات الاجتماعية"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_incomeinfo_charity" class="form-label"
                        >جمعيات خيرية<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="incomeinfo_charity"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_incomeinfo_charity"
                          value="{{ beneficiary_income_expense.charity_in }}"
                          data-bs-title="جمعيات خيرية"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_incomeinfo_social_warranty" class="form-label"
                        >الضمان الاجتماعي<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="incomeinfo_social_warranty"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_incomeinfo_social_warranty"
                          value="{{ beneficiary_income_expense.social_warranty_in }}"
                          data-bs-title="الضمان الاجتماعي"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                  </div>
        
                  <div class="row row-cols-lg-2 row-cols-xl-4">
                    <div class="mb-3 form-group">
                      <label for="id_incomeinfo_pension_agency" class="form-label"
                        >مصلحة التقاعد<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="incomeinfo_pension_agency"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_incomeinfo_pension_agency"
                          value="{{ beneficiary_income_expense.pension_agency_in }}"
                          data-bs-title="مصلحة التقاعد"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_incomeinfo_citizen_account" class="form-label"
                        >حساب المواطن<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="incomeinfo_citizen_account"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_incomeinfo_citizen_account"
                          value="{{ beneficiary_income_expense.citizen_account_in }}"
                          data-bs-title="حساب المواطن"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_incomeinfo_benefactor" class="form-label"
                        >فاعل خير<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="incomeinfo_benefactor"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_incomeinfo_benefactor"
                          value="{{ beneficiary_income_expense.benefactor_in }}"
                          data-bs-title="فاعل خير"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_incomeinfo_other" class="form-label">أخرى<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="incomeinfo_other"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_incomeinfo_other"
                          value="{{ beneficiary_income_expense.other_in }}"
                          data-bs-title="أخرى (دخل)"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                  </div>
        
                  <h4 class="mt-4 mb-3">مصروفات الأسرة (شهريًا)</h4>
                  <div
                    class="alert alert-warning mt-3"
                    role="alert"
                    id="checkboxError"
                  >
                    الرجاء ادخال مصروفات الأسرة ادناه, وفي حال عدم وجود الدخل المسمى, يرجى ادخال قيمة صفر (0)
                  </div>
                  <div class="row row-cols-lg-2 row-cols-xl-4 mt-4">
                    <div class="mb-3 form-group">
                      <label for="id_expensesinfo_housing_rent" class="form-label"
                        >إيجار السكن<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="expensesinfo_housing_rent"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_expensesinfo_housing_rent"
                          value="{{ beneficiary_income_expense.housing_rent_ex }}"
                          data-bs-title="إيجار السكن"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                    <div class="mb-3 form-group">
                      <label
                        for="id_expensesinfo_electricity_bills"
                        class="form-label"
                        >فواتير كهرباء<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="expensesinfo_electricity_bills"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_expensesinfo_electricity_bills"
                          value="{{ beneficiary_income_expense.electricity_bills_ex }}"
                          data-bs-title="فواتير كهرباء"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_expensesinfo_water_bills" class="form-label"
                        >فواتير ماء<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="expensesinfo_water_bills"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_expensesinfo_water_bills"
                          value="{{ beneficiary_income_expense.water_bills_ex }}"
                          data-bs-title="فواتير الماء"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_expensesinfo_transportation" class="form-label"
                        >مواصلات<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="expensesinfo_transportation"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_expensesinfo_transportation"
                          value="{{ beneficiary_income_expense.transportation_ex }}"
                          data-bs-title="مواصلات"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                  </div>
        
                  <div class="row row-cols-lg-2 row-cols-xl-4">
                    <div class="mb-3 form-group">
                      <label for="id_expensesinfo_health_supplies" class="form-label"
                        >مستلزمات صحية<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="expensesinfo_health_supplies"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_expensesinfo_health_supplies"
                          value="{{ beneficiary_income_expense.health_supplies_ex }}"
                          data-bs-title="مستلزمات صحية"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_expensesinfo_food_supplies" class="form-label"
                        >مستلزمات غذائية<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="expensesinfo_food_supplies"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_expensesinfo_food_supplies"
                          value="{{ beneficiary_income_expense.food_supplies_ex }}"
                          data-bs-title="مستلزمات غذائية"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                    <div class="mb-3 form-group">
                      <label
                        for="id_expensesinfo_educational_supplies"
                        class="form-label"
                        >مستلزمات دراسية<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="expensesinfo_educational_supplies"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_expensesinfo_educational_supplies"
                          value="{{ beneficiary_income_expense.educational_supplies_ex }}"
                          data-bs-title="مستلزمات دراسية"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                    <div class="mb-3 form-group">
                      <label for="id_expensesinfo_proven_debts" class="form-label"
                        >ديون مثبتة<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="expensesinfo_proven_debts"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_expensesinfo_proven_debts"
                          value="{{ beneficiary_income_expense.proven_debts_ex }}"
                          data-bs-title="ديون مثبتة"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                  </div>
        
                  <div class="row">
                    <div class="mb-3 form-group">
                      <label for="id_expensesinfo_other" class="form-label"
                        >أخرى<span style="color: red">*</span></label>
                      <div class="input-group mb-3">
                        <input
                          type="number"
                          name="expensesinfo_other"
                          min="0.00"
                          max="99999999.00"
                          class="form-control"
                          id="id_expensesinfo_other"
                          value="{{ beneficiary_income_expense.other_ex }}"
                          data-bs-title="أخرى (مصروفات)"
                        />
                        <span class="input-group-text" id="basic-addon1">ر.س.</span>
                      </div>
                    </div>
                  </div>

                </div>
              </div>

              <div class="tab-pane" id="fill-tabpanel-3" role="tabpanel" aria-labelledby="fill-tab-3">

                <div class="attachment_info">
                  <h3 class="mt-4 mb-4">المرفقات</h3>
  
                  <div
                    class="alert alert-warning mb-2"
                    role="alert"
                    id="checkboxError"
                  >
                    يمكن رفع الملفات المطلوبة اسفل الصفحة
                  </div>
                    
                  <div class="mt-4">
                    {% if beneficiary_attachments %}
                    <div class="table-responsive">
                      <table class="table">
                        <thead>
                          <tr>
                            <th scope="col">اسم الملف</th>
                            <th scope="col">نوع المرفق</th>
                            <th scope="col">نوع الملف</th>
                            <th scope="col">الإجراءات</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for attachment in beneficiary_attachments %}
                          <tr data-bs-toggle="tooltip" title="">
                            <td>
                              <span>
                                {{ attachment.file_name }}
                              </span>
                            </td>
                            <td>
                              <span>
                                {{ attachment.attachment_type }}
                              </span>
                            </td>
                            <td>{{ attachment.file_extension }}</td>
                            <td>
                              <div class="d-flex align-items-center actions">
                                <div class="mb-2">
                                  <a href="{{ attachment.file_path }}" target="_blank" class="btn btn-primary">عرض</a>
                                  <button class="btn btn-danger delete-file-btn" data-file-id="{{ attachment.id }}">حذف</button>
                              </div>
                              </div>
                            </td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                    {% else %}
                    <p>لا يوجد مرفقات </p>
                    {% endif %}
                  </div>
  
                  <h4 class="mt-4">رفع المرفقات</h4>
  
                  <div class="row mt-3">
  
                    <div
                      class="alert alert-warning mb-2"
                      role="alert"
                      id="checkboxError"
                    >
                      جميع المرفقات المحددة بنجمة حمراء (<span style="color: red">*</span>) مطلوبة وهي إلزامية لإكمال الطلب <strong>ويجب رفع المرفقات المطلوبة اذا لم يتم رفعها بالفعل في الجدول اعلاه</strong>
                    </div>
        
                    <div
                      class="alert alert-danger mt-1 mb-4"
                      role="alert"
                      id="checkboxError"
                    >
                      الحجم الاقصى للملف الواحد لجميع المرفقات هو ١ ميجابايت <span dir="ltr">(1 MB)</span>, بحيث انه يمكن رفع اكثر من ملف لبعض المرفقات بما لا يتجاوز حجم 1 ميجابايت للملف الواحد
                    </div>
        
                    <div class="col-12 col-lg-6 row-gap-3 mb-3 mt-2">
        
                      <div class="mb-4 row column-gap-4 fileInputContainer">
                        <div class="row pe-0">
                          <label class="form-label col pt-3" id="id_beneficiaryNationalIDTitle"
                            >صورة الهوية الوطنية/الإقامة<span style="color: red">*</span></label
                          >
                          <div class="col-4 d-flex justify-content-center">
                            <label
                              class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                              for="id_formFileBeneficiaryNationalID"
                              >إرفاق ملف</label
                            >
                          </div>
                          <input
                            class="form-control d-none"
                            type="file"
                            id="id_formFileBeneficiaryNationalID"
                            name="fileBeneficiaryNationalID"
                            accept="application/pdf,image/png, image/jpg, image/jpeg"
                          />
                          
                        </div>
                        <div
                          class="col text-muted"
                          id="id_fileNamesBeneficiaryNationalID"
                        ></div>
                        <!--- Place of showing file names -->
                        
                      </div>
        
                      <hr />
        
                      <div class="mb-4 row column-gap-4 fileInputContainer">
                        <div class="row pe-0">
                          <label class="form-label col pt-3">العنوان الوطني<span style="color: red">*</span></label>
                          <div class="col-4 d-flex justify-content-center">
                            <label
                              class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                              for="id_formFileBeneficiaryNationalAddress"
                              >إرفاق ملف</label
                            >
                          </div>
                          <input
                            class="form-control d-none"
                            type="file"
                            id="id_formFileBeneficiaryNationalAddress"
                            name="fileBeneficiaryNationalAddress"
                            accept="application/pdf,image/png, image/jpg, image/jpeg"
                          />
                        </div>
                        <div
                          class="col text-muted"
                          id="id_fileNamesNationalAddress"
                        ></div>
                        <!--- Place of showing file names -->
        
                      </div>
        
                      <hr />
        
                      <div class="mb-4 row column-gap-4 fileInputContainer">
                        <div class="row pe-0">
                          <label class="form-label col pt-3">صك الدين<span style="color: red">*</span> (في حال وجود دين)</label>
                          <div class="col-4 d-flex justify-content-center">
                            <label
                              class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                              for="id_formFileDeptInstrument"
                              >إرفاق ملفات</label
                            >
                          </div>
                          <input
                            class="form-control d-none"
                            type="file"
                            id="id_formFileDeptInstrument"
                            name="fileDeptInstrument"
                            accept="application/pdf,image/png, image/jpg, image/jpeg"
                            multiple
                          />
                        </div>
                        <div
                          class="col text-muted"
                          id="id_fileNamesDeptInstrument"
                        ></div>
                        <!--- Place of showing file names -->
        
                      </div>
        
                      <hr />
        
                      <div
                        class="mb-4 row column-gap-4 fileInputContainer"
                        id="id_attachmentPensionOrSocialInsuranceInquiry_group_info"
                        style="display: none"
                      >
                        <div class="row pe-0">
                          <label
                            class="form-label col pt-3"
                            id="id_PensionOrSocialInsuranceInquiryTitle"
                            >مشهد التقاعد أو التأمينات الاجتماعية<span style="color: red">*</span></label
                          >
                          <div class="col-4 d-flex justify-content-center">
                            <label
                              class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                              for="id_formFilePensionOrSocialInsuranceInquiry"
                              >إرفاق ملفات</label
                            >
                          </div>
                          <input
                            class="form-control d-none"
                            type="file"
                            id="id_formFilePensionOrSocialInsuranceInquiry"
                            name="filePensionOrSocialInsuranceInquiry"
                            accept="application/pdf,image/png, image/jpg, image/jpeg"
                            multiple
                          />
                        </div>
                        <div
                          class="col text-muted"
                          id="id_fileNamesPensionOrSocialInsuranceInquiry"
                        ></div>
                        <!--- Place of showing file names -->
        
                      </div>
        
                      <hr
                        id="id_attachmentPensionOrSocialInsuranceInquiry_group_info_hr"
                        style="display: none"
                      />
        
                      <div
                        class="mb-4 row column-gap-4 fileInputContainer"
                        id="id_attachmentFatherOrHusbandDeathCertificate_group_info"
                        style="display: none"
                      >
                        <div class="row pe-0">
                          <label class="form-label col pt-3">شهادة الوفاة للزوج / الأب<span style="color: red">*</span></label>
                          <div class="col-4 d-flex justify-content-center">
                            <label
                              class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                              for="id_formFileFatherOrHusbandDeathCertificate"
                              >إرفاق ملف</label
                            >
                          </div>
                          <input
                            class="form-control d-none"
                            type="file"
                            id="id_formFileFatherOrHusbandDeathCertificate"
                            name="fileFatherOrHusbandDeathCertificate"
                            accept="application/pdf,image/png, image/jpg, image/jpeg"
                          />
                        </div>
                        <div
                          class="col text-muted"
                          id="id_fileNamesFatherOrHusbandDeathCertificate"
                        ></div>
                        <!--- Place of showing file names -->
        
                      </div>
        
                      <hr
                        id="id_attachmentFatherOrHusbandDeathCertificate_group_info_hr"
                        style="display: none"
                      />
        
                      <div
                        class="mb-4 row column-gap-4 fileInputContainer"
                        id="id_attachmentLetterFromPrison_group_info"
                        style="display: none"
                      >
                        <div class="row pe-0">
                          <label class="form-label col pt-3"
                            >خطاب من السجن<span style="color: red">*</span> (في حال أسرة سجين)</label
                          >
                          <div class="col-4 d-flex justify-content-center">
                            <label
                              class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                              for="id_formFileLetterFromPrison"
                              >إرفاق ملفات</label
                            >
                          </div>
                          <input
                            class="form-control d-none"
                            type="file"
                            id="id_formFileLetterFromPrison"
                            name="fileLetterFromPrison"
                            accept="application/pdf,image/png, image/jpg, image/jpeg"
                            multiple
                          />
                        </div>
                        <div
                          class="col text-muted"
                          id="id_fileNamesLetterFromPrison"
                        ></div>
                        <!--- Place of showing file names -->
        
                      </div>
        
                      <hr
                        id="id_attachmentLetterFromPrison_group_info_hr"
                        style="display: none"
                      />
        
                      <div
                        class="mb-4 row column-gap-4 fileInputContainer"
                        id="id_attachmentDivorceDeed_group_info"
                        style="display: none"
                      >
                        <div class="row pe-0">
                          <label class="form-label col pt-3">صك الطلاق<span style="color: red">*</span></label>
                          <div class="col-4 d-flex justify-content-center">
                            <label
                              class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                              for="id_formFileDivorceDeed"
                              >إرفاق ملف</label
                            >
                          </div>
                          <input
                            class="form-control d-none"
                            type="file"
                            id="id_formFileDivorceDeed"
                            name="fileDivorceDeed"
                            accept="application/pdf,image/png, image/jpg, image/jpeg"
                          />
                        </div>
                        <div
                          class="col text-muted"
                          id="id_fileNamesDivorceDeed"
                        ></div>
                        <!--- Place of showing file names -->
                      </div>
        
                      <hr
                        id="id_attachmentDivorceDeed_group_info_hr"
                        style="display: none"
                      />
        
                      <div
                        class="mb-4 row column-gap-4 fileInputContainer"
                        id="id_attachmentChildrenResponsibilityDeed_group_info"
                        style="display: none"
                      >
                        <div class="row pe-0">
                          <label class="form-label col pt-3"
                            >صك إعالة الأبناء<span style="color: red">*</span> (في حال كانوا مرافقين)</label
                          >
                          <div class="col-4 d-flex justify-content-center">
                            <label
                              class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                              for="id_formFileChildrenResponsibilityDeed"
                              >إرفاق ملفات</label
                            >
                          </div>
                          <input
                            class="form-control d-none"
                            type="file"
                            id="id_formFileChildrenResponsibilityDeed"
                            name="fileChildrenResponsibilityDeed"
                            accept="application/pdf,image/png, image/jpg, image/jpeg"
                            multiple
                          />
                        </div>
                        <div
                          class="col text-muted"
                          id="id_fileNamesChildrenResponsibilityDeed"
                        ></div>
                        <!--- Place of showing file names -->
        
                      </div>
        
                      <hr
                        id="id_attachmentChildrenResponsibilityDeed_group_info_hr"
                        style="display: none"
                      />
        
                      <div class="mb-4 row column-gap-4 fileInputContainer">
                        <div class="row pe-0">
                          <label class="form-label col pt-3">إرفاق مستندات أخرى</label>
                          <div class="col-4 d-flex justify-content-center">
                            <label
                              class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                              for="id_formFileOther"
                              >إرفاق ملفات</label
                            >
                          </div>
                          <input
                            class="form-control d-none"
                            type="file"
                            id="id_formFileOther"
                            name="fileOther"
                            accept="application/pdf,image/png, image/jpg, image/jpeg"
                            multiple
                          />
                        </div>
                        <div class="col text-muted" id="id_fileNamesOther"></div>
                          <!--- Place of showing file names -->
                        
                      </div>
        
                      <hr />
                    </div>
        
                    <div class="col-12 col-lg-6 row-gap-3 mb-3 mt-2">
        
                      <div class="mb-4 row column-gap-4 fileInputContainer">
                        <div class="row pe-0">
                          <label class="form-label col pt-3"
                            >عقد الإيجار الالكتروني من منصة إيجار أو صك ملكية<span style="color: red">*</span></label
                          >
                          <div class="col-4 d-flex justify-content-center">
                            <label
                              class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                              for="id_formFileLeaseContractOrTitleDeed"
                              >إرفاق ملفات</label
                            >
                          </div>
                          <input
                            class="form-control d-none"
                            type="file"
                            id="id_formFileLeaseContractOrTitleDeed"
                            name="fileLeaseContractOrTitleDeed"
                            accept="application/pdf,image/png, image/jpg, image/jpeg"
                            multiple
                          />
                        </div>
                        <div
                            class="col text-muted"
                            id="id_fileNamesLeaseContractOrTitleDeed"
                          ></div>
                          <!--- Place of showing file names -->
        
                      </div>
        
                      <hr />
        
                      <div class="mb-4 row column-gap-4 fileInputContainer">
                        <div class="row pe-0">
                          <label class="form-label col pt-3">الفواتير<span style="color: red">*</span> (كهرباء - ماء)</label>
                          <div class="col-4 d-flex justify-content-center">
                            <label
                              class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                              for="id_formFileWaterOrElectricityBills"
                              >إرفاق ملفات</label
                            >
                          </div>
                          <input
                            class="form-control d-none"
                            type="file"
                            id="id_formFileWaterOrElectricityBills"
                            name="fileWaterOrElectricityBills"
                            accept="application/pdf,image/png, image/jpg, image/jpeg"
                            multiple
                          />
                        </div>
                        <div
                            class="col text-muted"
                            id="id_fileNamesWaterOrElectricityBills"
                          ></div>
                          <!--- Place of showing file names -->
        
                      </div>
        
                      <hr />
        
                      <div
                        class="mb-4 row column-gap-4 fileInputContainer"
                        id="id_attachmentNationalIDForBeneficiaryForDependents_group_info"
                        style="display: none"
                      >
                        <div class="row pe-0">
                          <label
                            class="form-label col pt-3"
                            id="id_NationalIDForBeneficiaryForDependentsTitle"
                            >صورة الهوية الوطنية/الإقامة للمرافقين<span style="color: red">*</span></label
                          >
                          <div class="col-4 d-flex justify-content-center">
                            <label
                              class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                              for="id_formFileNationalIDForBeneficiaryForDependents"
                              >إرفاق ملفات</label
                            >
                          </div>
                          <input
                            class="form-control d-none"
                            type="file"
                            id="id_formFileNationalIDForBeneficiaryForDependents"
                            name="fileNationalIDForBeneficiaryDependents"
                            accept="application/pdf,image/png, image/jpg, image/jpeg"
                            multiple
                          />
                        </div>
                        <div
                          class="col text-muted"
                          id="id_fileNamesNationalIDForBeneficiaryForDependents"
                        ></div>
                        <!--- Place of showing file names -->
                        
                      </div>
        
                      <hr
                        id="id_attachmentNationalIDForBeneficiaryForDependents_group_info_hr"
                        style="display: none"
                      />
        
                      <div
                        class="mb-4 row column-gap-4 fileInputContainer"
                        id="id_attachmentSocialWarrantyInquiry_group_info"
                        style="display: none"
                      >
                        <div class="row pe-0">
                          <label class="form-label col pt-3" id="id_SocialWarrantyInquiryTitle"
                            >مشهد الضمان الاجتماعي<span style="color: red">*</span></label
                          >
                          <div class="col-4 d-flex justify-content-center">
                            <label
                              class="btn btn-success w-100 mb-2 mt-2 align-self-baseline"
                              for="id_formFileSocialWarrantyInquiry"
                              >إرفاق ملفات</label
                            >
                          </div>
                          <input
                            class="form-control d-none"
                            type="file"
                            id="id_formFileSocialWarrantyInquiry"
                            name="fileSocialWarrantyInquiry"
                            accept="application/pdf,image/png, image/jpg, image/jpeg"
                            multiple
                          />
                        </div>
                        <div
                          class="col text-muted"
                          id="id_fileNamesSocialWarrantyInquiry"
                        ></div>
                        <!--- Place of showing file names -->
                        
                      </div>
        
                      <hr
                        id="id_attachmentSocialWarrantyInquiry_group_info_hr"
                        style="display: none"
                      />
                    </div>
                  </div>
  
                </div>
              </div>

            </form> <!-- end line form 1 -->

            <div class="tab-pane" id="fill-tabpanel-4" role="tabpanel" aria-labelledby="fill-tab-4">

              <div class="dependents">
                
                <h3 class="mt-4 mb-4">المرافقين</h3>
                <div
                  class="alert alert-warning mt-3"
                  role="alert"
                  id="checkboxError"
                >
                <span class="text-danger fw-bold">تنبيه</span>: قائمة المرافقين موجودة أسفل الصفحة.
                </div>
                <h5 class="mt-4 mb-1">معلومات إضافة مرافق</h5>
                <hr>
                <div class="mt-3">
                  <form
                  id="editDependentForm"
                  name="editDependentForm"
                  method="POST"
                  action="/edit_dependent"
                  class="needs-validation"
                  novalidate
                  >
                    {% csrf_token %}
                    <div id="family-form">
                      <div class="row row-cols-md-2 row-cols-xl-4">
                        <div class="col-md-6 mb-4 form-group">
                          <label for="id_dependent_info_first_name" class="form-label"
                            >الأسم الأول<span style="color: red">*</span
                            ></label
                          >
                          <input
                            type="text"
                            id="id_dependent_info_first_name"
                            class="form-control"
                            name="dependent_info_first_name"
                          />
                        </div>
                        <div class="col-md-6 mb-4 form-group">
                          <label for="id_dependent_info_second_name" class="form-label"
                            >الأسم الثاني<span style="color: red">*</span
                            ></label
                          >
                          <input
                            type="text"
                            id="id_dependent_info_second_name"
                            class="form-control"
                            name="dependent_info_second_name"
                          />
                        </div>
                        <div class="col-md-6 mb-4 form-group">
                          <label for="id_dependent_info_last_name" class="form-label"
                            >الأسم الأخير<span style="color: red">*</span
                            ><span style="font-size: 0.9rem">
                              (أسم العائلة)</span
                            ></label
                          >
                          <input
                            type="text"
                            id="id_dependent_info_last_name"
                            class="form-control"
                            name="dependent_info_last_name"
                          />
                        </div>
                        <div class="col-md-6 mb-4 form-group">
                          <label
                            for="id_dependent_info_date_of_birth"
                            class="form-label"
                            >تاريخ الميلاد<span style="color: red">*</span></label
                          >
                          <input
                            type="date"
                            class="form-control"
                            id="id_dependent_info_date_of_birth"
                            maxlength="55"
                            name="dependent_info_date_of_birth"
                          />
                        </div>
                      </div>
        
                      <div class="row row-cols-md-2 row-cols-xl-3">
                        <div class="col-md-6 mb-4 form-group">
                          <label for="id_dependent_info_gender" class="form-label"
                            >الجنس<span style="color: red">*</span></label
                          >
                          <select
                            name="dependent_info_gender"
                            class="form-select"
                            id="id_dependent_info_gender"
                          >
                            <option value selected>---------</option>
                            <option value="ذكر">ذكر</option>
                            <option value="انثى">انثى</option>
                          </select>
                        </div>
                        <div class="col-md-6 mb-4 form-group">
                          <label for="id_dependent_info_relationship" class="form-label"
                            >صلة القرابة<span style="color: red">*</span></label
                          >
                          <select
                            name="dependent_info_relationship"
                            class="form-select"
                            id="id_dependent_info_relationship"
                          >
                            <option value selected>---------</option>
                            <option value="ابن">ابن</option>
                            <option value="ابنة">ابنة</option>
                            <option value="أخ">أخ</option>
                            <option value="أخت">أخت</option>
                            <option value="زوج/ـة">زوج/ـة</option>
                            <option value="خال/ـة">خال/ـة</option>
                            <option value="عم/ـة">عم/ـة</option>
                            <option value="جد/ـة">جد/ـة</option>
                          </select>
                        </div>
                        <div class="col-md-12 mb-4 form-group">
                          <label
                            for="id_dependent_info_marital_status"
                            class="form-label"
                            >الحالة الاجتماعية<span style="color: red">*</span></label
                          >
                          <select
                            name="dependent_info_marital_status"
                            class="form-select"
                            id="id_dependent_info_marital_status"
                          >
                            <option value selected>---------</option>
                            <option value="طفل/ـة">طفل/ـة</option>
                            <option value="ربة منزل">ربة منزل</option>
                            <option value="متزوج/ـة">متزوج/ـة</option>
                            <option value="أعزب/ـة">أعزب/ـة</option>
                            <option value="أرملة/ـة">أرمل/ـة</option>
                            <option value="مطلقة">مطلقة</option>
                            <option value="مهجورة">مهجورة</option>
                          </select>
                        </div>
                      </div>
        
        
                      <div class="row row-cols-md-2">
                        <div class="col-md-6 mb-4 form-group">
                          <label
                            for="id_dependent_info_educational_status"
                            class="form-label"
                            >الحالة الدراسية<span style="color: red">*</span></label
                          >
                          <select
                            name="dependent_info_educational_status"
                            class="form-select"
                            id="id_dependent_info_educational_status"
                            onchange="educationalStatusCheck(this);"
                          >
                            <option value selected>---------</option>
                            <option value="يدرس">يدرس</option>
                            <option value="لا يدرس">لا يدرس</option>
                          </select>
                        </div>
                        <div class="col-md-6 mb-4 form-group" style="display: none;" id="id_dependent_info_educational_level_group_info">
                          <label
                            for="id_dependent_info_educational_level"
                            class="form-label"
                            >المرحلة الدراسية<span style="color: red">*</span></label
                          >
                          <select
                            name="dependent_info_educational_level"
                            class="form-select"
                            id="id_dependent_info_educational_level"
                          >
                            <option value selected>---------</option>
                            <option value="أول ابتدائي">أول ابتدائي</option>
                            <option value="ثاني ابتدائي">ثاني ابتدائي</option>
                            <option value="ثالث ابتدائي">ثالث ابتدائي</option>
                            <option value="رابع ابتدائي">رابع ابتدائي</option>
                            <option value="خامس ابتدائي">خامس ابتدائي</option>
                            <option value="سادس ابتدائي">سادس ابتدائي</option>
                            <option value="اول متوسط">اول متوسط</option>
                            <option value="ثاني متوسط">ثاني متوسط</option>
                            <option value="ثالث متوسط">ثالث متوسط</option>
                            <option value="اول ثانوي">اول ثانوي</option>
                            <option value="ثاني ثانوي">ثاني ثانوي</option>
                            <option value="ثالث ثانوي">ثالث ثانوي</option>
                            <option value="جامعي">جامعي</option>
                          </select>
                        </div>
                        <div class="col-md-6 mb-4 form-group" style="display: none;" id="id_dependent_info_educational_degree_group_info">
                          <label
                            for="id_dependent_info_educational_degree"
                            class="form-label"
                            >المؤهل التعليمي<span style="color: red">*</span></label
                          >
                          <select
                            name="dependent_info_educational_degree"
                            class="form-select"
                            id="id_dependent_info_educational_degree"
                          >
                            <option value selected>---------</option>
                            <option value="أُمّيّ (لا يقرأ ولا يكتب)">أُمّيّ (لا يقرأ ولا يكتب)</option>
                            <option value="يقرأ ويكتب">يقرأ ويكتب</option>
                            <option value="ابتدائي">ابتدائي</option>
                            <option value="متوسط">متوسط</option>
                            <option value="ثانوي">ثانوي</option>
                            <option value="جامعي">جامعي</option>
                          </select>
                        </div>
                      </div>
        
        
                      <div class="row">
                        <div class="col-md-6 mb-4 form-group">
                          <label for="id_dependent_info_national_id" class="form-label"
                            >رقم الهوية الوطنية \ الإقامة<span style="color: red"
                              >*</span
                            ></label
                          >
                          <input
                            type="text"
                            class="form-control convert-to-english"
                            id="id_dependent_info_national_id"
                            maxlength="20"
                            name="dependent_info_national_id"
                          />
                        </div>
                        <div class="col-md-6 mb-4 form-group">
                          <label
                            for="id_dependent_info_national_id_exp_date"
                            class="form-label"
                            >تاريخ انتهاء الهوية \ الإقامة</label
                          >
                          <input
                            type="date"
                            class="form-control"
                            id="id_dependent_info_national_id_exp_date"
                            name="dependent_info_national_id_exp_date"
                          />
                        </div>
                      </div>
        
                      <div class="row">
                        <div class="col-md-6 mb-4 form-group">
                          <label for="id_dependent_info_work_status" class="form-label"
                            >هل تعمل؟<span style="color: red">*</span></label
                          >
                          <select
                            name="dependent_info_work_status"
                            class="form-select"
                            required
                            id="id_dependent_info_work_status"
                            onchange="workCheckDependent(this);"
                          >
                            <option value="" selected>---------</option>
                            <option value="نعم">نعم</option>
                            <option value="لا">لا</option>
                          </select>
                        </div>
                        <div
                          class="col-md-6 mb-4 form-group"
                          id="id_dependent_info_employer_group_info"
                          style="display: none"
                        >
                          <label for="id_dependent_info_employer" class="form-label"
                            >جهة العمل<span style="color: red">*</span> (عند اختيار
                            نعم)</label
                          >
                          <input
                            type="text"
                            name="dependent_info_employer"
                            maxlength="100"
                            class="form-control"
                            id="id_dependent_info_employer"
                          />
                        </div>
                      </div>
        
                      <h4 class="mb-4">مصادر الدخل</h4>
                      <div class="row justify-content-center">
                        <div class="col-md-4 mb-2 form-group">
                          <label for="id_dependent_info_monthly_income" class="form-label">دخل المرافق (شهريا)</label>
                          <div class="input-group mb-3">
                            <input type="number" name="dependent_info_monthly_income" max="9999999999999999" min="0" class="form-control" id="id_dependent_info_monthly_income" />
                            <span class="input-group-text" id="basic-addon1">ر.س.</span>
                          </div>
                        </div>
                        <div class="col-md-4 col-lg-5 mb-2 form-group">
                          <label for="id_dependent_info_income_source" class="form-label">مصدر الدخل</label>
                          <select name="dependent_info_income_source" class="form-select" id="id_dependent_info_income_source">
                            <option value selected>---------</option>
                            <option value="الراتب">الراتب</option>
                            <option value="التأمينات الاجتماعية">التأمينات الاجتماعية</option>
                            <option value="الضمان الاجتماعي">الضمان الاجتماعي</option>
                            <option value="مصلحة التقاعد">مصلحة التقاعد</option>
                            <option value="حساب المواطن">حساب المواطن</option>
                            <option value="التأهيل الشامل">التأهيل الشامل</option>
                            <option value="جمعية خيرية">جمعية خيرية</option>
                            <option value="فاعل خير">فاعل خير</option>
                            <option value="اخرى">اخرى</option>
                          </select>
                        </div>
                        <div class="col-md-4 col-lg-3 mb-sm-5 mb-md-3 mb-3 mt-4 row justify-content-center align-items-center" id="id_add_row_income_table">
                          <button type="button" class="btn btn-primary" onclick="addRowToIncomeInfoTable()">إضافة مصدر الدخل</button>
                        </div>
                      </div>
                      
                      {% comment %} Dependent Income Table {% endcomment %}
                      <div>
                        <table class="table table-striped table-hover mb-5" id="incomeInfoTable">
                          <thead>
                            <tr>
                              <th scope="col">دخل المرافق الشهري (ر.س.)</th>
                              <th scope="col">مصدر الدخل للمرافق</th>
                              <th scope="col">الإجراءات</th>
                            </tr>
                          </thead>
                          <tbody id="incomeInfoTableBody"></tbody>
                        </table>
                      </div>

                      <div class="row">
                        <div class="col-md-6 mb-4 form-group">
                          <label for="id_dependent_info_contribute_to_family_income" class="form-label"
                            >هل يساهم المرافق في دخل الأسرة؟<span style="color: red">*</span></label
                          >
                          <select
                            name="dependent_info_contribute_to_family_income"
                            class="form-select"
                            required
                            id="id_dependent_info_contribute_to_family_income"
                          >
                            <option value="" selected>---------</option>
                            <option value="نعم">نعم</option>
                            <option value="لا">لا</option>
                          </select>
                        </div>
                      </div>
        
        
                      <div class="row">
                        <div class="col-md-6 mb-4 form-group">
                          <label
                            for="id_dependent_info_health_status"
                            class="form-label"
                            >الحالة الصحية<span style="color: red">*</span></label
                          >
                          <select
                            name="dependent_info_health_status"
                            class="form-select"
                            id="id_dependent_info_health_status"
                            onchange="dependentInfoHealthCheck(this);"
                          >
                            <option value selected>---------</option>
                            <option value="جيدة">جيدة</option>
                            <option value="غير جيدة">غير جيدة</option>
                          </select>
                        </div>
                        <div
                          class="col-md-6 mb-4 form-group"
                          id="id_dependentinfo_disease_type_group_info"
                          style="display: none"
                        >
                          <label for="id_dependent_info_disease_type" class="form-label"
                            >نوع المرض<span style="color: red">*</span> (عند اختيار غير
                            جيدة)</label
                          >
                          <input
                            type="text"
                            name="dependent_info_disease_type"
                            maxlength="100"
                            class="form-control"
                            id="id_dependent_info_disease_type"
                          />
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-6 mb-4 form-group">
                          <label
                            for="id_dependent_info_is_disabled"
                            class="form-label"
                            >هل المرافق من ذوي الاعاقة؟<span style="color: red">*</span></label
                          >
                          <select
                            name="dependent_info_is_disabled"
                            class="form-select"
                            id="id_dependent_info_is_disabled"
                            onchange="dependentInfoDisabilityCheck(this);"
                          >
                            <option value selected>---------</option>
                            <option value="نعم">نعم</option>
                            <option value="لا">لا</option>
                          </select>
                        </div>
                        <div
                          class="col-md-6 mb-4 form-group"
                          id="id_dependentinfo_disability_type_group_info"
                          style="display: none"
                        >
                          <label for="id_dependent_info_disability_type" class="form-label"
                            >نوع الإعاقة<span style="color: red">*</span></label
                          >
                          <select
                            name="dependent_info_disability_type"
                            class="form-select"
                            id="id_dependent_info_disability_type"
                          >
                            <option value selected>---------</option>
                            <option value="حركية">حركية</option>
                            <option value="سمعية">سمعية</option>
                            <option value="بصرية">بصرية</option>
                            <option value="عقلية">عقلية</option>
                          </select>
                        </div>
                      </div>
        
                      <div class="row">
                        <div class="col-md-12 mb-4 form-group">
                          <label class="form-label"
                            >نوع الاحتياج للمرافق<span style="color: red"
                              >*</span
                            > <span style="font-size: 0.9rem">
                              (إختيار متعدد)</span
                            ></label
                          >
                          <div
                            name="dependent_info_needs_type"
                            class="d-grid gap-2"
                            style="grid-template-columns: 1fr 1fr 1fr;"
                            id="id_dependent_info_needs_type"
                          >
                            <input type="checkbox" class="btn-check" id="id_dependent_info_needs_type_economical" autocomplete="off" name="dependent_info_needs_type_economical" value="اقتصادي">
                            <label class="btn btn-outline-primary" for="id_dependent_info_needs_type_economical">اقتصادي</label>
        
                            <input type="checkbox" class="btn-check" id="id_dependent_info_needs_type_educational" autocomplete="off" name="dependent_info_needs_type_educational" value="تعليمي">
                            <label class="btn btn-outline-primary" for="id_dependent_info_needs_type_educational">تعليمي</label>
        
                            <input type="checkbox" class="btn-check" id="id_dependent_info_needs_type_employment" autocomplete="off" name="dependent_info_needs_type_employment" value="توظيف">
                            <label class="btn btn-outline-primary" for="id_dependent_info_needs_type_employment">توظيف</label>
        
                            <input type="checkbox" class="btn-check" id="id_dependent_info_needs_type_sponsorship" autocomplete="off" name="dependent_info_needs_type_sponsorship" value="كفالة">
                            <label class="btn btn-outline-primary" for="id_dependent_info_needs_type_sponsorship">كفالة</label>
        
                            <input type="checkbox" class="btn-check" id="id_dependent_info_needs_type_healthy" autocomplete="off" name="dependent_info_needs_type_healthy" value="صحي">
                            <label class="btn btn-outline-primary" for="id_dependent_info_needs_type_healthy">صحي</label>
                          </div>
                        </div>
                        <div class="col-md-12 mb-4 form-group">
                          <label for="id_dependent_info_needs_description" class="form-label">وصف الاحتياج</label>
                          <textarea type="textarea" class="form-control form-control-lg" id="id_dependent_info_needs_description" rows="5" name="dependentinfo_needs_description" maxlength="2000"></textarea>
                        </div>
                      </div>
        
                      <button
                        id="addChildButton"
                        type="button"
                        class="btn addChildBtn btn-success mb-4 mt-3 px-4 py-3"
                      >
                        إضافة مرافق
                      </button>
        
                      <hr class="mb-4">
        
                      <h3 class="mb-3">قائمة المرافقين</h3>
                      <div class="table-responsive-xl">
                        <table
                          id="family-table"
                          class="table table-striped table-hover"
                          style="overflow-x: scroll"
                        >
                          <thead>
                            <tr>
                              <th scope="col">الأسم الأول</th>
                              <th scope="col" class="d-none">الأسم الثاني</th>
                              <th scope="col" class="d-none">الأسم الأخير</th>
                              <th scope="col">الجنس</th>
                              <th scope="col">صلة القرابة</th>
                              <th scope="col">الحالة الدراسية</th>
                              <th scope="col">الحالة الاجتماعية</th>
                              <th scope="col">رقم الهوية</th>
                              <th scope="col">الحالة الصحية</th>
                              <th scope="col" class="d-none">دخل المرافق (شهريا)</th>
                              <th scope="col" class="d-none">مصدر الدخل</th>
                              <th scope="col" class="d-none">نوع الاحتياج</th>
                              <th scope="col" class="d-none">المؤهل التعليمي</th>
                              <th scope="col" class="d-none">تاريخ الميلاد</th>
                              <th scope="col" class="d-none">
                                تاريح انتهاء الهوية/الإقامة
                              </th>
                              <th scope="col" class="d-none">وصف الاحتياج</th>
                              <th scope="col" class="text-center">خيارات</th>
                            </tr>
                          </thead>
                          <tbody>
                            <!-- Child rows will be added here -->
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </form>
                </div>

              </div>
            </div>
            
          </div>
        </div>
        
        <hr>

        <div class="mt-4">
          <div class="d-grid d-md-flex gap-2 flex-lg-row">
            <button type="submit" class="btn btn-success px-5 py-2 submit-btn " disabled id="submit-btn">تأكيد طلب التحديث</button>
            <a href="{% url 'beneficiary_requests' user_id=user.id %}" class="btn btn-secondary px-4 py-2">العودة للصفحة السابقة</a>
          </div>
        </div>
      

    </div> <!-- end line card body -->
  </div> <!-- end line card -->
</div> <!-- end line container -->

<!-- Edit Modal -->
<div
  class="modal fade"
  id="editModal"
  tabindex="-1"
  aria-labelledby="editModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel">تعديل معلومات المرافق</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body bg-light">
        <!-- Loading state content -->
        <div id="loadingStateEditModal" style="display: none; text-align: center;">
          <div class="spinner-border text-primary mt-5" role="status">
            <span class="sr-only visually-hidden">انتظار...</span>
          </div>
          <p>انتظار...</p>
        </div>

        <!-- Actual modal content -->
        <div id="editModalContent" style="display: none;">
          <form
            id="editModalForm"
            name="editModalForm"
            method="POST"
            action="/handle_test2"
            class="needs-validation"
            novalidate
          >
            {% csrf_token %}
            <div class="row row-cols-md-2 row-cols-xl-4">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_dependent_edit_info_first_name" class="form-label"
                  >الأسم الأول<span style="color: red">*</span
                  ></label
                >
                <input
                  type="text"
                  id="id_dependent_edit_info_first_name"
                  class="form-control"
                  name="dependent_edit_info_first_name"
                />
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_dependent_edit_info_second_name" class="form-label"
                  >الأسم الثاني<span style="color: red">*</span
                  ></label
                >
                <input
                  type="text"
                  id="id_dependent_edit_info_second_name"
                  class="form-control"
                  name="dependent_edit_info_second_name"
                />
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_dependent_edit_info_last_name" class="form-label"
                  >الأسم الأخير<span style="color: red">*</span
                  ><span style="font-size: 0.9rem">
                    (أسم العائلة)</span
                  ></label
                >
                <input
                  type="text"
                  id="id_dependent_edit_info_last_name"
                  class="form-control"
                  name="dependent_edit_info_last_name"
                />
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label
                  for="id_dependent_edit_info_date_of_birth"
                  class="form-label"
                  >تاريخ الميلاد<span style="color: red">*</span></label
                >
                <input
                  type="date"
                  class="form-control"
                  id="id_dependent_edit_info_date_of_birth"
                  maxlength="55"
                  name="dependent_edit_info_date_of_birth"
                />
              </div>
            </div>

            <hr>

            <div class="row row-cols-md-2 row-cols-xl-3">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_dependent_edit_info_gender" class="form-label"
                  >الجنس<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_gender"
                  class="form-select"
                  id="id_dependent_edit_info_gender"
                >
                  <option value selected>---------</option>
                  <option value="ذكر">ذكر</option>
                  <option value="انثى">انثى</option>
                </select>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label for="id_dependent_edit_info_relationship" class="form-label"
                  >صلة القرابة<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_relationship"
                  class="form-select"
                  id="id_dependent_edit_info_relationship"
                >
                  <option value selected>---------</option>
                  <option value="ابن">ابن</option>
                  <option value="ابنة">ابنة</option>
                  <option value="أخ">أخ</option>
                  <option value="أخت">أخت</option>
                  <option value="زوج/ـة">زوج/ـة</option>
                  <option value="خال/ـة">خال/ـة</option>
                  <option value="عم/ـة">عم/ـة</option>
                  <option value="جد/ـة">جد/ـة</option>
                </select>
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label
                  for="id_dependent_edit_info_marital_status"
                  class="form-label"
                  >الحالة الاجتماعية<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_marital_status"
                  class="form-select"
                  id="id_dependent_edit_info_marital_status"
                >
                  <option value selected>---------</option>
                  <option value="طالب/ـة">طالب/ـة</option>
                  <option value="طفل/ـة">طفل/ـة</option>
                  <option value="ربة منزل">ربة منزل</option>
                  <option value="متزوج/ـة">متزوج/ـة</option>
                  <option value="أعزب/ـة">أعزب/ـة</option>
                  <option value="أرملة/ـة">أرمل/ـة</option>
                  <option value="مطلقة">مطلقة</option>
                  <option value="مهجورة">مهجورة</option>
                </select>
              </div>
            </div>

            <hr />

            <div class="row row-cols-md-2">
              <div class="col-md-6 mb-4 form-group">
                <label
                  for="id_dependent_edit_info_educational_status"
                  class="form-label"
                  >الحالة الدراسية<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_educational_status"
                  class="form-select"
                  id="id_dependent_edit_info_educational_status"
                  onchange="educationalStatusEditInfoCheck(this);"
                >
                  <option value selected>---------</option>
                  <option value="يدرس">يدرس</option>
                  <option value="لا يدرس">لا يدرس</option>
                </select>
              </div>
              <div class="col-md-6 mb-4 form-group" style="display: none;" id="id_dependent_edit_info_educational_level_group_info">
                <label
                  for="id_dependent_edit_info_educational_level"
                  class="form-label"
                  >المرحلة الدراسية<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_educational_level"
                  class="form-select"
                  id="id_dependent_edit_info_educational_level"
                >
                  <option value selected>---------</option>
                  <option value="أول ابتدائي">أول ابتدائي</option>
                  <option value="ثاني ابتدائي">ثاني ابتدائي</option>
                  <option value="ثالث ابتدائي">ثالث ابتدائي</option>
                  <option value="رابع ابتدائي">رابع ابتدائي</option>
                  <option value="خامس ابتدائي">خامس ابتدائي</option>
                  <option value="سادس ابتدائي">سادس ابتدائي</option>
                  <option value="اول متوسط">اول متوسط</option>
                  <option value="ثاني متوسط">ثاني متوسط</option>
                  <option value="ثالث متوسط">ثالث متوسط</option>
                  <option value="اول ثانوي">اول ثانوي</option>
                  <option value="ثاني ثانوي">ثاني ثانوي</option>
                  <option value="ثالث ثانوي">ثالث ثانوي</option>
                  <option value="جامعي">جامعي</option>
                </select>
              </div>
              <div class="col-md-6 mb-4 form-group" style="display: none;" id="id_dependent_edit_info_educational_degree_group_info">
                <label
                  for="id_dependent_edit_info_educational_degree"
                  class="form-label"
                  >المؤهل التعليمي<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_educational_degree"
                  class="form-select"
                  id="id_dependent_edit_info_educational_degree"
                >
                  <option value selected>---------</option>
                  <option value="لا يوجد">لا يوجد</option>
                  <option value="ابتدائي">ابتدائي</option>
                  <option value="متوسط">متوسط</option>
                  <option value="ثانوي">ثانوي</option>
                  <option value="جامعي">جامعي</option>
                </select>
              </div>
            </div>

            <hr />

            <div class="row">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_dependent_edit_info_national_id" class="form-label"
                  >رقم الهوية الوطنية \ الإقامة<span style="color: red"
                  >*</span
                ></label
                >
                <input
                  type="text"
                  class="form-control convert-to-english"
                  id="id_dependent_edit_info_national_id"
                  maxlength="20"
                  name="dependent_edit_info_national_id"
                />
              </div>
              <div class="col-md-6 mb-4 form-group">
                <label
                  for="id_dependent_edit_info_national_id_exp_date"
                  class="form-label"
                  >تاريخ انتهاء الهوية \ الإقامة</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="id_dependent_edit_info_national_id_exp_date"
                  name="dependent_edit_info_national_id_exp_date"
                />
              </div>
            </div>

            <hr/>

            <div class="row">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_dependent_edit_info_work_status" class="form-label"
                  >هل تعمل؟<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_work_status"
                  class="form-select"
                  required
                  id="id_dependent_edit_info_work_status"
                  onchange="workCheckEditDependent(this);"
                >
                  <option value="" selected>---------</option>
                  <option value="نعم">نعم</option>
                  <option value="لا">لا</option>
                </select>
              </div>
              <div
                class="col-md-6 mb-4 form-group"
                id="id_dependent_edit_info_employer_group_info"
                style="display: none"
              >
                <label for="id_dependent_edit_info_employer" class="form-label"
                  >جهة العمل<span style="color: red">*</span> (عند اختيار
                  نعم)</label
                >
                <input
                  type="text"
                  name="dependent_edit_info_employer"
                  maxlength="100"
                  class="form-control"
                  id="id_dependent_edit_info_employer"
                />
              </div>
            </div>

            <hr />

            <h4 class="mb-4">مصادر الدخل</h4>
            <div class="row row-cols-xl-3 justify-content-center">
              <div class="col-md-4 mb-2 form-group">
                <label for="id_dependent_edit_info_monthly_income" class="form-label">دخل المرافق (شهريا)</label>
                <div class="input-group mb-3">
                  <input type="number" name="dependent_edit_info_monthly_income" max="9999999999999999" min="0" class="form-control" id="id_dependent_edit_info_monthly_income" />
                  <span class="input-group-text" id="basic-addon1">ر.س.</span>
                </div>
              </div>
              <div class="col-md-4 col-lg-5 mb-2 form-group">
                <label for="id_dependent_edit_info_income_source" class="form-label">مصدر الدخل للمرافق</label>
                <select name="dependent_edit_info_income_source" class="form-select" id="id_dependent_edit_info_income_source">
                  <option value selected>---------</option>
                  <option value="الراتب">الراتب</option>
                  <option value="التأمينات الاجتماعية">التأمينات الاجتماعية</option>
                  <option value="الضمان الاجتماعي">الضمان الاجتماعي</option>
                  <option value="مصلحة التقاعد">مصلحة التقاعد</option>
                  <option value="حساب المواطن">حساب المواطن</option>
                  <option value="التأهيل الشامل">التأهيل الشامل</option>
                  <option value="جمعية خيرية">جمعية خيرية</option>
                  <option value="فاعل خير">فاعل خير</option>
                  <option value="اخرى">اخرى</option>
                </select>
              </div>
              <div class="col-md-4 col-lg-3 mb-sm-5 mb-md-3 mb-3 mt-4 row justify-content-center align-items-center" id="id_add_row_edit_income_table">
                <button type="button" class="btn btn-primary" id="id_add_row_income_edit_info" onclick="addRowToIncomeEditInfoTable()">إضافة مصدر الدخل</button>
              </div>
            </div>
            
            {% comment %} Dependent Income Table {% endcomment %}
            <table class="table table-striped table-hover mb-5" id="incomeEditInfoTable">
              <thead>
                <tr>
                  <th scope="col">دخل المرافق الشهري (ر.س.)</th>
                  <th scope="col">مصدر الدخل</th>
                  <th scope="col">الإجراءات</th>
                </tr>
              </thead>
              <tbody id="incomeEditInfoTableBody"></tbody>
            </table>

            <hr />

            <div class="row">
              <div class="col-md-6 mb-4 form-group">
                <label for="id_dependent_edit_info_contribute_to_family_income" class="form-label"
                  >هل يساهم المرافق في دخل الأسرة؟<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_contribute_to_family_income"
                  class="form-select"
                  required
                  id="id_dependent_edit_info_contribute_to_family_income"
                >
                  <option value="" selected>---------</option>
                  <option value="نعم">نعم</option>
                  <option value="لا">لا</option>
                </select>
              </div>
            </div>

            <hr />

            <div class="row">
              <div class="col-md-6 mb-4 form-group">
                <label
                  for="id_dependent_edit_info_health_status"
                  class="form-label"
                  >الحالة الصحية<span style="color: red"
                  >*</span
                ></label
                >
                <select
                  name="dependent_edit_info_health_status"
                  class="form-select"
                  id="id_dependent_edit_info_health_status"
                  onchange="dependentEditInfoHealthCheck(this);"
                >
                  <option value selected>---------</option>
                  <option value="جيدة">جيدة</option>
                  <option value="غير جيدة">غير جيدة</option>
                </select>
              </div>
              <div
                class="col-md-6 mb-4 form-group"
                id="id_dependent_edit_info_disease_type_group_info"
                style="display: none"
              >
                <label
                  for="id_dependent_edit_info_disease_type"
                  class="form-label"
                  >نوع المرض<span style="color: red"
                  >*</span
                > (عند اختيار غير جيدة)</label
                >
                <input
                  type="text"
                  name="dependent_edit_info_disease_type"
                  maxlength="100"
                  class="form-control"
                  id="id_dependent_edit_info_disease_type"
                />
              </div>
            </div>

            <hr />

            <div class="row">
              <div class="col-md-6 mb-4 form-group">
                <label
                  for="id_dependent_edit_info_is_disabled"
                  class="form-label"
                  >هل المرافق من ذوي الاعاقة؟<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_is_disabled"
                  class="form-select"
                  id="id_dependent_edit_info_is_disabled"
                  onchange="editDependentInfoDisabilityCheck(this);"
                >
                  <option value selected>---------</option>
                  <option value="نعم">نعم</option>
                  <option value="لا">لا</option>
                </select>
              </div>
              <div
                class="col-md-6 mb-4 form-group"
                id="id_dependent_edit_info_disability_type_group_info"
                style="display: none"
              >
                <label for="id_dependent_edit_info_disability_type" class="form-label"
                  >نوع الإعاقة<span style="color: red">*</span></label
                >
                <select
                  name="dependent_edit_info_disability_type"
                  class="form-select"
                  id="id_dependent_edit_info_disability_type"
                >
                  <option value selected>---------</option>
                  <option value="حركية">حركية</option>
                  <option value="سمعية">سمعية</option>
                  <option value="بصرية">بصرية</option>
                  <option value="عقلية">عقلية</option>
                </select>
              </div>
            </div>

            <hr />

            <div class="row">
              <div class="col-md-12 mb-4 form-group">
                <label class="form-label"
                  >نوع الاحتياج للمرافق<span style="color: red"
                    >*</span
                  > <span style="font-size: 0.9rem">
                    (إختيار متعدد)</span
                  ></label
                >
                <div
                  name="dependent_edit_info_needs_type"
                  class="d-grid gap-2"
                  style="grid-template-columns: 1fr 1fr 1fr;"
                  id="id_dependent_edit_info_needs_type"
                >
                  <input type="checkbox" class="btn-check" id="id_dependent_edit_info_needs_type_economical" autocomplete="off" name="dependent_edit_info_needs_type_economical" value="اقتصادي">
                  <label class="btn btn-outline-primary" for="id_dependent_edit_info_needs_type_economical">اقتصادي</label>

                  <input type="checkbox" class="btn-check" id="id_dependent_edit_info_needs_type_educational" autocomplete="off" name="dependent_edit_info_needs_type_educational" value="تعليمي">
                  <label class="btn btn-outline-primary" for="id_dependent_edit_info_needs_type_educational">تعليمي</label>

                  <input type="checkbox" class="btn-check" id="id_dependent_edit_info_needs_type_employment" autocomplete="off" name="dependent_edit_info_needs_type_employment" value="توظيف">
                  <label class="btn btn-outline-primary" for="id_dependent_edit_info_needs_type_employment">توظيف</label>

                  <input type="checkbox" class="btn-check" id="id_dependent_edit_info_needs_type_sponsorship" autocomplete="off" name="dependent_edit_info_needs_type_sponsorship" value="كفالة">
                  <label class="btn btn-outline-primary" for="id_dependent_edit_info_needs_type_sponsorship">كفالة</label>

                  <input type="checkbox" class="btn-check" id="id_dependent_edit_info_needs_type_healthy" autocomplete="off" name="dependent_edit_info_needs_type_healthy" value="صحي">
                  <label class="btn btn-outline-primary" for="id_dependent_edit_info_needs_type_healthy">صحي</label>
                </div>
              </div>
              <div class="col-md-12 mb-4 form-group">
                <label
                  for="id_dependent_edit_info_needs_description"
                  class="form-label"
                  >وصف الاحتياج</label
                >
                <textarea
                  type="textarea"
                  class="form-control"
                  id="id_dependent_edit_info_needs_description"
                  name="dependent_edit_info_needs_description"
                  maxlength="2000"
                  rows="5"
                ></textarea>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          إلغاء
        </button>
        <button
          type="button"
          class="btn btn-primary savechangesofedit"
          id="saveChanges"
          disabled
        >
          حفظ التغييرات
        </button>
      </div>
    </div>
  </div>
</div><!-- end line EditModal -->
<script>

  // console.log({{ beneficiary_dob }})
  // Populate the date response into the data input element
  let dob = new Date({{ beneficiary_dob }});
  let datestring1 = dob.getFullYear().toString().padStart(4, '0') + '-' + (dob.getMonth()+1).toString().padStart(2, '0') + '-' + dob.getDate().toString().padStart(2, '0');
  document.getElementById('id_personalinfo_date_of_birth').value = datestring1;

  let national_id_exp_date = new Date({{ beneficiary_national_id_exp_data }});
  let datestring2 = national_id_exp_date.getFullYear().toString().padStart(4, '0') + '-' + (national_id_exp_date.getMonth()+1).toString().padStart(2, '0') + '-' + national_id_exp_date.getDate().toString().padStart(2, '0');
  document.getElementById('id_personalinfo_national_id_exp_date').value = datestring2;

  {% if beneficiary_death_date_father_husband %}
  let death_date_father_husband = new Date({{ beneficiary_death_date_father_husband }});
  let datestring3 = death_date_father_husband.getFullYear().toString().padStart(4, '0') + '-' + (death_date_father_husband.getMonth()+1).toString().padStart(2, '0') + '-' + death_date_father_husband.getDate().toString().padStart(2, '0');
  document.getElementById('id_personalinfo_death_date_father_husband').value = datestring3;
  {% endif %}

  $(document).ready(function () {
    // List of values to match
    var family_issues_list = {{ beneficiary.family_issues | safe }};
    var family_needs_list = {{ beneficiary.family_needs | safe }};

    // Iterate through the checkboxes and set "checked" property based on the match
    $('[name^="familyinfo_issues_"]').each(function () {
      if (family_issues_list.includes($(this).val())) {
        $(this).prop('checked', true);
      }
    });

    // Iterate through the checkboxes and set "checked" property based on the match
    $('[name^="familyinfo_needs_type_"]').each(function () {
      if (family_needs_list.includes($(this).val())) {
        $(this).prop('checked', true);
      }
    });

    // Function to set the selected option for a given select element
    function setSelectedOption(selectId, selectedValue) {
      $('#' + selectId).val(selectedValue);
    }

    // Call the function with the specific select element and value
    // Personal information selectors
    setSelectedOption('id_personalinfo_nationality', "{{ user_info.nationality }}");
    setSelectedOption('id_personalinfo_gender', "{{ user_info.gender }}");
    setSelectedOption('id_personalinfo_category', "{{ beneficiary.category }}");
    setSelectedOption('id_personalinfo_marital_status', "{{ beneficiary.marital_status }}");
    setSelectedOption('id_personalinfo_educational_level', "{{ beneficiary.educational_level }}");
    setSelectedOption('id_personalinfo_health_status', "{{ beneficiary.health_status }}");
    setSelectedOption('id_personalinfo_work_status', "{{ beneficiary.work_status }}");
    setSelectedOption('id_personalinfo_washing_place', "{{ beneficiary.washing_place }}");
    setSelectedOption('id_personalinfo_bank_type', "{{ beneficiary.bank_type }}");
    
    // Housing information selectors
    setSelectedOption('id_houseinfo_housing_type', "{{ beneficiary_house.housing_type }}");
    setSelectedOption('id_houseinfo_housing_ownership', "{{ beneficiary_house.housing_ownership }}");


    const banks = [
      {
        samaCode: "55",
        bankName: "Banque Saudi Fransi",
        nameEn: "Banque Saudi Fransi",
        nameAr: "السعودي الفرنسي",
      },
      {
        samaCode: "80",
        name: "Alrajhi Bank",
        nameEn: "Alrajhi Bank",
        nameAr: "الراجحي",
      },
      {
        samaCode: "10",
        bankName: "National Commercial Bank",
        nameEn: "National Commertial Bank",
        nameAr: "الأهلي السعودي",
      },
      {
        samaCode: "45",
        bankName: "Saudi British Bank",
        nameEn: "SABB",
        nameAr: "ساب",
      },
      {
        samaCode: "20",
        bankName: "Riyadh Bank",
        nameEn: "Riyad Bank",
        nameAr: "الرياض",
      },
      {
        samaCode: "05",
        bankName: "Alinma Bank",
        nameEn: "AL Inma Bank",
        nameAr: "الإنماء",
      },
      {
        samaCode: "60",
        bankName: "Bank AlJazira",
        nameEn: "Bank Aljazerah",
        nameAr: "الجزيرة",
      },
      {
        samaCode: "15",
        bankName: "Bank AlBilad ",
        nameEn: "BANK ALBELAD",
        nameAr: "البلاد",
      },
      {
        samaCode: "30",
        bankName: "Arab National Bank",
        nameEn: "Arab National Bank",
        nameAr: "العربي",
      },

      {
        samaCode: "76",
        bankName: "Bank Muscat",
        nameEn: "Bank Muscat",
        nameAr: "مسقط",
      },
      /*
      {
        samaCode: "98",
        bankName: "BNP Paribas",
        nameEn: "BNP Paribas",
        nameAr: "بي ان بي باريبا",
      },
      {
        samaCode: "81",
        bankName: "Deutsche Bank",
        nameEn: "Deutsche Bank",
        nameAr: "دويتشه",
      },
      */
      {
        samaCode: "95",
        bankName: "Emirates Bank",
        nameEn: "Emirates Bank",
        nameAr: "الإمارات دبي الوطني",
      },
      {
        samaCode: "90",
        bankName: "Gulf International Bank",
        nameEn: "Gulf International Bank",
        nameAr: "الخليج الدولي",
      },
      {
        samaCode: "71",
        bankName: "National Bank of Bahrain",
        nameEn: "National Bank of Bahrain",
        nameAr: "البحرين الوطني",
      },
      {
        samaCode: "75",
        bankName: "National Bank of Kuwait",
        nameEn: "National Bank of Kuwait",
        nameAr: "الكويت الوطني",
      },
      {
        samaCode: "82",
        bankName: "National Bank of Pakistan",
        nameEn: "National Bank of Pakistan",
        nameAr: "باكستان الوطني",
      },
      /*
      {
        samaCode: "40",
        bankName: "Samba Financial Services",
        nameEn: "Samba Financial Services",
        nameAr: "سامبا",
      },
      {
        samaCode: "01",
        bankName: "Saudi Arabian Monetary Agency",
        nameEn: "Saudi Arabian Monetary Agency",
        nameAr: "المركزي السعودي",
      },
      */
      {
        samaCode: "50",
        bankName: "Alawwal Bank",
        nameEn: "Alawwal Bank",
        nameAr: "الأول",
      },
      {
        samaCode: "65",
        bankName: "Saudi Investment Bank",
        nameEn: "Saudi Investment Bank",
        nameAr: "السعودي للاستثمار",
      },
      /*
      {
        samaCode: "83",
        bankName: "State Bank of India",
        nameEn: "State Bank of India",
        nameAr: "الهند الوطني",
      },
      */
      {
        samaCode: "84",
        bankName: "Turkiye Cumhuriyeti Ziraat Bankasi",
        nameEn: "Turkiye Cumhuriyeti Ziraat Bankasi",
        nameAr: "زراعات",
      },
      /*
      {
        samaCode: "87",
        bankName: "Industrial & Commercial Bank of China (Riyadh Branch)",
        nameEn: "Industrial & Commercial Bank of China (Riyadh Branch)",
        nameAr: "ICBC",
      },
      {
        samaCode: "86",
        bankName: "Saudi Arabian Monetary Agency",
        nameEn: "Saudi Arabian Monetary Agency",
        nameAr: "جي بي مورجان",
      },
      */
    ];

    // Function to validate file sizes
    function validateFileSizes() {
      var files = document.querySelectorAll('input[type="file"]');
      var maxSize = 1 * 1024 * 1024; // 1MB in bytes

      for (var i = 0; i < files.length; i++) {
          var fileInput = files[i];
          var fileList = fileInput.files;

          for (var j = 0; j < fileList.length; j++) {
              var file = fileList[j];

              // Check if file size exceeds the limit
              if (file.size > maxSize) {
                  alert('حجم الملف يجب ألا يتجاوز 1 ميجابايت.');
                  return false;
              }
          }
      }

      return true; // All files are within the size limit
    }

    
    // Function to update the names of the uploaded files for each file input
    function updateFileNamesDisplay(fileInputId, fileNamesDivId) {
      var fileInput = document.getElementById(fileInputId);
      var fileNamesDiv = document.getElementById(fileNamesDivId);
      

      // Initialize with a message indicating no file is uploaded
      fileNamesDiv.innerHTML = "[لم يتم إرفاق أي ملفات]";

      fileInput.addEventListener("change", function () {
        var fileList = fileInput.files;

        if (fileList.length > 0) {
          fileNamesDiv.innerHTML = ""; // Clear the initial message
          var ul = document.createElement("ul"); // Create unordered list element
          ul.classList.add("file-names-list", "ps-1", "mt-3"); // Add classes to the list

          for (var i = 0; i < fileList.length; i++) {
            var fileSize = fileList[i].size;
            var sizeLabel = "";

            if (fileSize < 1024 * 1024) {
              sizeLabel = (fileSize / 1024).toFixed(2) + " KB";
            } else {
              sizeLabel = (fileSize / (1024 * 1024)).toFixed(2) + " MB";
            }

            // Add CSS class to size label if file size exceeds 1 MB
            var sizeClass = fileSize > 1024 * 1024 ? "text-bg-danger" : "text-bg-secondary";
            sizeLabel = "<span class='badge " + sizeClass + " d-inline'>" + sizeLabel + "</span>";

            // Create list item and append to the unordered list
            var li = document.createElement("li");
            li.innerHTML = fileList[i].name + " " + sizeLabel;
            li.classList.add("mb-3", "text-truncate"); // Add class to list item
            ul.appendChild(li);
          }

           // Append the unordered list to the fileNamesDiv
          fileNamesDiv.appendChild(ul);
        } else {
          // Show the no files uploaded message if no file is selected
          fileNamesDiv.innerHTML = "[لم يتم إرفاق أي ملفات]";
        }
      });
    }

    // Initialize for each file input (fileInputId, fileNamesDivId)
    updateFileNamesDisplay(
      "id_formFileBeneficiaryNationalAddress",
      "id_fileNamesNationalAddress"
    );
    updateFileNamesDisplay(
      "id_formFileLeaseContractOrTitleDeed",
      "id_fileNamesLeaseContractOrTitleDeed"
    );
    updateFileNamesDisplay(
      "id_formFileDeptInstrument",
      "id_fileNamesDeptInstrument"
    );
    updateFileNamesDisplay(
      "id_formFileNationalIDForBeneficiaryForDependents",
      "id_fileNamesNationalIDForBeneficiaryForDependents"
    );
    updateFileNamesDisplay(
      "id_formFileBeneficiaryNationalID",
      "id_fileNamesBeneficiaryNationalID"
    );
    updateFileNamesDisplay(
      "id_formFileWaterOrElectricityBills",
      "id_fileNamesWaterOrElectricityBills"
    );
    updateFileNamesDisplay(
      "id_formFileSocialWarrantyInquiry",
      "id_fileNamesSocialWarrantyInquiry"
    );
    updateFileNamesDisplay(
      "id_formFilePensionOrSocialInsuranceInquiry",
      "id_fileNamesPensionOrSocialInsuranceInquiry"
    );
    updateFileNamesDisplay(
      "id_formFileFatherOrHusbandDeathCertificate",
      "id_fileNamesFatherOrHusbandDeathCertificate"
    );
    updateFileNamesDisplay(
      "id_formFileLetterFromPrison",
      "id_fileNamesLetterFromPrison"
    );
    updateFileNamesDisplay("id_formFileDivorceDeed", "id_fileNamesDivorceDeed");
    updateFileNamesDisplay(
      "id_formFileChildrenResponsibilityDeed",
      "id_fileNamesChildrenResponsibilityDeed"
    );
    updateFileNamesDisplay("id_formFileOther", "id_fileNamesOther");
    

    /**
    * validates IBAN
    * @return {boolean}
    */
    function validateIBAN(iban) {
      if (!iban) {
        return false;
      }

      iban = iban.trim();

      if (iban.length !== 24) {
        return false;
      }

      if (!iban.startsWith("SA")) {
        return false;
      }

      const bankCode = iban.substring(4, 6);

      return banks.some((b) => b.samaCode === bankCode);
    }

    /**
    * Returns the bank object
    * @return {Object}
    */
    function getBankByIBAN(iban) {
      if (!validateIBAN(iban)) return null;

      const bankCode = iban.substring(4, 6);
      const bank = banks.find((b) => b.samaCode === bankCode);
      return bank ? bank.nameAr : null;
    }

    $("#id_personalinfo_bank_iban").on("input", function () {
      var iban = $(this).val();
      var bankNameAr = getBankByIBAN(iban);

      if (bankNameAr) {
        $("#id_personalinfo_bank_type").val(bankNameAr).change();
      } else {
        $("#id_personalinfo_bank_type").val("").change(); // Reset to default if IBAN is invalid
      }
    });

    // Validator method for the Saudi IBAN number
    $.validator.addMethod(
      "validateIBAN",
      function (value, element) {
        return this.optional(element) || validateIBAN(value);
      },
      "الرجاء إدخال رقم إيبان صحيح"
    );

    // Validator method for first, second, and last name fields in the form
    $.validator.addMethod(
      "nameRegex",
      function (value, element) {
        return (
          this.optional(element) || /^[a-zA-Z0-9\u0621-\u064A]*$/i.test(value)
        );
      },
      "يحتوي الأسم على حروف فقط."
    );

    $.validator.addMethod(
      "fullNameRegex",
      function (value, element) {
        return (
          this.optional(element) ||
          /^[a-zA-Z\u0621-\u064A]+([ '-][a-zA-Z\u0621-\u064A]+)*$/i.test(value)
        );
      },
      "يجب أن يتكون الاسم الكامل من الاسم الأول والأوسط والأخير."
    );

    // Validate Saudi Arabia IDs (Iqama/Saudi Natioanl Id)
    function validateSAID(id) {
      let type = id.substr(0, 1);
      let sum = 0;
      const _idLength = 10;
      const _type1 = "1";
      const _type2 = "2";
      id = id.trim();
      if (
        isNaN(parseInt(id)) ||
        id.length !== _idLength ||
        (type !== _type2 && type !== _type1)
      ) {
        return false;
      }
      for (let num = 0; num < 10; num++) {
        const digit = Number(id[num]);
        if (num % 2 === 0) {
          const doubled = digit * 2;
          const ZFOdd = `00${doubled}`.slice(-2);
          sum += Number(ZFOdd[0]) + Number(ZFOdd[1]);
        } else {
          sum += digit;
        }
      }
      return sum % 10 !== 0 ? false : true;
    }

    // Validator method for the national id (Iqama/Saudi)
    $.validator.addMethod(
      "nationalidRegex",
      function (value, element) {
        return this.optional(element) || validateSAID(value);
      },
      "أدخل رقم هوية/إقامة صحيح."
    );

    // Validator method for the phone number [Working - International Phone Numbers]
    /*
        $.validator.addMethod(
          "phonenumberRegex",
          function (value, element) {
              return this.optional(element) || /^(?:\+?\d{1,3}[\s-]?)?(0\d{9}|(?:\d{3}[\s-]?\d{3}[\s-]?\d{4})|\d{10})$/i.test(value);
          },
          "الرجاء إدخال رقم جوال صحيح."
        );
        */

    // Validator method for the phone number [Saudi Arabia Only]
    $.validator.addMethod(
      "saudiPhoneRegex",
      function (value, element) {
        return (
          this.optional(element) || /^(5\d{8})$/i.test(value)
        );
      },
      "الرجاء إدخال رقم جوال صحيح يبدأ برقم 5 وبطول 9 ارقام."
    );

    // Email address validator
    $.validator.addMethod(
      "emailRegex",
      function (value, element) {
        return (
          this.optional(element) ||
          /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(value)
        );
      },
      "الرجاء إدخال بريد إلكتروني صحيح."
    );

    $.validator.addMethod('filesize', function (value, element, param) {
      return this.optional(element) || (element.files[0].size <= param * 1000000)
    }, 'حجم الملف يجب أن يكون أقل من {0} MB');

    // Global variables
    var form = $("#edit_beneficiary_request_form");
    var alertContainer = $("#alert-danger-error-fields");
    var tabs = $(".nav-link.next"); //

    var includedFields = ["id_dependent_info_national_id", "id_personalinfo_bank_iban"]; // IDs of fields to exclude


    // The below code will change the default validation messages
    $.extend($.validator.messages, {
      required: "هذا الحقل مطلوب.",
      remote: "الرجاء اصلاح هذا الحقل.",
      email: "الرجاء إدخال بريد الكتروني صالح.",
      url: "الرجاء إدخال رابط صحيح وفعال.",
      date: "الرجاء إدخال تاريخ صالح.",
      dateISO: "الرجاء إدخال تاريخ صحيح (بصيغة ISO).",
      number: "الرجاء إدخال رقم صحيح.",
      digits: "الرجاء إدخال أرقام فقط.",
      creditcard: "الرجاء إدخال رقم بطاقة ائتمان صالحة.",
      equalTo: "رجاء أدخل نفس القيمة مره أخرى.",
      accept: "الرجاء إدخال قيمة بإمتداد صحيح.",
      maxlength: $.validator.format("الرجاء عدم إدخال أكثر من {0} أحرف."),
      minlength: $.validator.format("الرجاء إدخال على الأقل {0} حروف."),
      rangelength: $.validator.format(
        "Please enter a value between {0} and {1} characters long."
      ),
      range: $.validator.format("الرجاء إدخال رقم بين {0} و {1}."),
      max: $.validator.format(" الرجاء إدخال قيمة أقل من أو تساوي {0}."),
      min: $.validator.format("الرجاء إدخال قيمة أعلى من أو تساوي {0}."),
    });

    form.validate({
      errorElement: "span",
      errorClass: "help-block invalid-feedback",
      highlight: function (element, errorClass, validClass) {
        $(element).closest(".form-group").addClass("has-error");
        //$(element).fadeOut(function() {
        //  $(element).fadeIn();
        //  });

        // Check if the field is excluded
        if (includedFields.indexOf(element.id) !== -1) {
          $(element).addClass("is-invalid");
          $(element).removeClass("is-valid");
        }
      },
      unhighlight: function (element, errorClass, validClass) {
        $(element).closest(".form-group").removeClass("has-error");

        // Check if the field is excluded
          if (includedFields.indexOf(element.id) !== -1) {
            $(element).removeClass("is-invalid");
            $(element).addClass("is-valid");
          }
      },
      errorPlacement: function (error, element) {
        // Check if the element is inside an input-group
        if (element.parent(".input-group").length) {
          // Place the error after the input-group
          error.insertAfter(element.parent(".input-group"));
        } else {
          // Default placement for other elements
          error.insertAfter(element);
        }
      },
      focusInvalid: true,

      // Adding the rules (validations) for each input in the form.
      rules: {
        personalinfo_first_name: {
          required: true,
          nameRegex: true,
          minlength: 2,
          maxlength: 20,
        },
        personalinfo_second_name: {
          required: true,
          nameRegex: true,
          minlength: 2,
          maxlength: 20,
        },
        personalinfo_last_name: {
          required: true,
          nameRegex: true,
          minlength: 2,
          maxlength: 20,
        },
        /*
        personalinfo_date_of_birth: {
          required: true,
          dateISO: true,
        },
        personalinfo_gender: {
          required: true,
        },
        personalinfo_national_id: {
          required: true,
          nationalidRegex: true,
        },
        personalinfo_national_id_exp_date: {
          required: true,
          dateISO: true,
        },
        personalinfo_nationality: {
          required: true,
          maxlength: 30,
        },
        */
        personalinfo_category: {
          required: true,
        },
        personalinfo_marital_status: {
          required: true,
        },
        personalinfo_educational_level: {
          required: true,
        },
        personalinfo_death_date_father_husband: {
          required: true,
          dateISO: true,
        },
        personalinfo_washing_place: {
          required: false,
        },
        personalinfo_health_status: {
          required: true,
        },
        personalinfo_disease_type: {
          required: true,
        },
        personalinfo_work_status: {
          required: true,
        },
        personalinfo_employer: {
          required: true,
        },
        /*
        personalinfo_phone_number: {
          required: true,
          saudiPhoneRegex: true,
        },
        personalinfo_email: {
          required: true,
        },
        */
        // housing_income_need_information ---------
        houseinfo_building_number: {
          required: true,
        },
        houseinfo_street_name: {
          required: true,
        },
        houseinfo_neighborhood: {
          required: true,
        },
        houseinfo_city: {
          required: true,
        },
        houseinfo_postal_code:{
          required: true,
        },
        houseinfo_additional_number: {
          required: true,
        },
        houseinfo_unit: {
          required: true,
        },
        houseinfo_location_url: {
          required: true,
        },
        houseinfo_housing_type: {
          required: true,
        },
        houseinfo_housing_ownership: {
          required: true,
        },
        incomeinfo_salary: {
          required: true,
        },
        incomeinfo_social_insurance: {
          required: true,
        },
        incomeinfo_charity: {
          required: true,
        },
        incomeinfo_social_warranty: {
          required: true,
        },
        incomeinfo_pension_agency: {
          required: true,
        },
        incomeinfo_citizen_account: {
          required: true,
        },
        incomeinfo_benefactor: {
          required: true,
        },
        incomeinfo_other: {
          required: true,
        },
        expensesinfo_housing_rent: {
          required: true,
        },
        expensesinfo_electricity_bills: {
          required: true,
        },
        expensesinfo_water_bills: {
          required: true,
        },
        expensesinfo_transportation: {
          required: true,
        },
        expensesinfo_health_supplies: {
          required: true,
        },
        expensesinfo_food_supplies: {
          required: true,
        },
        expensesinfo_educational_supplies: {
          required: true,
        },
        expensesinfo_proven_debts: {
          required: true,
        },
        expensesinfo_other: {
          required: true,
        },
        familyinfo_family_issues: {
          required: true,
        },
        familyinfo_needs_type: {
          required: true,
        },
        personalinfo_bank_iban: {
          required: true,
          validateIBAN: true,
        },
        personalinfo_bank_type: {
          required: true,
        },
        // attachments_information --------- // File rules are currently not working
        fileBeneficiaryNationalID: {
          required: true,
          accept: "application/pdf, image/*",
          filesize : 5, // here we are working with MB
        },
        fileNationalIDForBeneficiaryDependents: {
          required: true,
          accept: "application/pdf, image/*",
        },
        fileBeneficiaryNationalAddress: {
          required: true,
          accept: "application/pdf, image/*",
        },
        filePensionOrSocialInsuranceInquiry: {
          required: true,
          accept: "application/pdf, image/*",
        },
        fileFatherOrHusbandDeathCertificate: {
          required: true,
          accept: "application/pdf, image/*",
        },
        fileLetterFromPrison: {
          required: true,
          accept: "application/pdf, image/*",
        },
        fileDivorceDeed: {
          required: true,
          accept: "application/pdf, image/*",
        },
        fileChildrenResponsibilityDeed: {
          required: true,
          accept: "application/pdf, image/*",
        },
        fileLeaseContractOrTitleDeed: {
          required: true,
          accept: "application/pdf, image/*",
        },
        fileWaterOrElectricityBills: {
          required: true,
          accept: "application/pdf, image/*",
        },
        fileSocialWarrantyInquiry: {
          required: true,
          accept: "application/pdf, image/*",
        },
      },
      messages: {
        personalinfo_first_name: {
          required: "هذا الحقل مطلوب.",
        },
        password: {
          required: "Password required",
        },
        conf_password: {
          required: "Password required",
          equalTo: "Password don't match",
        },
        name: {
          required: "Name required",
        },
      },
    });

    // When ".next" button is clicked, the following function is executed
    form.find("input, select, textarea").on("input change", function () {

      form.valid(); // Trigger validation
      updateAlert(); // Update the alert based on the validation result
      updateTabs(); // Update the tabs based on the validation result

    }); // input, select, textarea input fields (onclick, oninput) end line

    // Function to update the alert based on the form's validation status
    function updateAlert() {
      // Clear the content of the alert before updating
      alertContainer.empty();
      var errorMessages = [];

      // Check if the custom error message is visible
      var minChoiceErrorVisible = $('.minChoiceErrorMessage').length > 0;

      if (form.valid() && !minChoiceErrorVisible) {
        // If the form is valid and the custom error is not visible, hide the alert
        alertContainer.hide();

        // Enable the submit button
        $("#submit-btn").prop("disabled", false);
      } else {
        // If the form is invalid or the custom error is visible, construct the alert message with all validation errors
        errorMessages = [];

        form.find(".help-block.invalid-feedback").each(function () {
          var fieldName = $(this).closest('.form-group').find("input, select, textarea").attr("data-bs-title");
          var errorMessage = $(this).text().trim(); // Get the trimmed text content
          
          // Check if the errorMessage is not empty before pushing it
          if (errorMessage !== "") {
            errorMessages.push("<li>" + fieldName + ": " + errorMessage + "</li>");
          }
        });

        if (errorMessages.length > 0 || minChoiceErrorVisible) {

          // Display the alert with the list of errors
          // If there's not minChoiceErrorVisible
          if(!minChoiceErrorVisible) {
            var errorMessage = "<strong>الرجاء تصحيح الأخطاء التالية:</strong><br><ul>" + errorMessages.join("") + "</ul>";
            alertContainer.html(errorMessage).show();
          } else {
            var errorMessageFamilyIssues = $("#minChoiceCountFamilyIssuesErrorMessage").length > 0;
            var errorMessageFamilyNeeds = $("#minChoiceCountFamilyNeedsErrorMessage").length > 0;

            if (errorMessageFamilyIssues && errorMessageFamilyNeeds) {
              errorMessages.push("<li>" + "المشكلات التي تعاني منها الأسرة" + ": " + "الرجاء تحديد نوع واحد على الأقل" + "</li>");
              errorMessages.push("<li>" + "نوع احتياج الأسرة" + ": " + "الرجاء تحديد نوع واحد على الأقل" + "</li>");
            } else if (errorMessageFamilyIssues) {
              errorMessages.push("<li>" + "المشكلات التي تعاني منها الأسرة" + ": " + "الرجاء تحديد نوع واحد على الأقل" + "</li>");

            } else {// in case of family needs
              errorMessages.push("<li>" + "نوع احتياج الأسرة" + ": " + "الرجاء تحديد نوع واحد على الأقل" + "</li>");
            }
            
            var errorMessage = "<strong>الرجاء تصحيح الأخطاء التالية:</strong><br><ul>" + errorMessages.join("") + "</ul>";
            alertContainer.html(errorMessage).show();
          }

          // Disable the submit button
          $("#submit-btn").prop("disabled", true);
        }
      }
    }

    // Function to update the tabs based on the form's validation status
    function updateTabs() {
      var minChoiceErrorsVisible = $('.minChoiceErrorMessage').length > 0;

      if (alertContainer.is(":visible") || minChoiceErrorsVisible) {
        // If the alert or custom error is visible, disable the tabs
        tabs.attr("data-bs-toggle", "");
      } else {
        // If neither the alert nor custom error is visible, enable the tabs
        tabs.attr("data-bs-toggle", "tab");
      }
    }

    
    // Add an event listener to the form inputs to check validity and enable/disable the button
    form.find("input, select, textarea").on("input change", function () {
      // Check if the form is valid
      var isFormValid = form.valid();

      // Check if the custom error message is visible
      var minChoiceErrorVisible = $('.minChoiceErrorMessage').length > 0;
      
      if (!minChoiceErrorVisible) {
        // Enable or disable the submit button based on form validity
        $("#submit-btn").prop("disabled", !isFormValid);
      } 
    });

    // Function to convert non-English numbers to English numbers
    function convertToEnglishNumber(input) {
      const easternArabicNumerals = '٠١٢٣٤٥٦٧٨٩';
      const englishNumerals = '0123456789';

      for (let i = 0; i < easternArabicNumerals.length; i++) {
          const regex = new RegExp(easternArabicNumerals[i], 'g');
          input = input.replace(regex, englishNumerals[i]);
      }

      return input;
    }

    // Event listener for all input fields with class 'convert-to-english'
    document.querySelectorAll('.convert-to-english').forEach(function (inputField) {
      inputField.addEventListener('input', function (event) {
        const inputValue = event.target.value;
        const convertedValue = convertToEnglishNumber(inputValue);
        event.target.value = convertedValue;

        // to fix the error where the alert is not detecting the changes
        updateAlert();
        updateTabs();
      });
    });

    // Function to display an error message
    function displayMinChoiceCountFamilyIssuesErrorMessage(message, duration) {
      // Check if the error message element already exists
      var errorMessageElement = document.getElementById('minChoiceCountFamilyIssuesErrorMessage');
      
      // If not, create a new element and append it to the page
      if (!errorMessageElement) {
        errorMessageElement = document.createElement('div');
        errorMessageElement.id = 'minChoiceCountFamilyIssuesErrorMessage';
        errorMessageElement.classList.add('alert', 'alert-danger', 'minChoiceErrorMessage');

        // Get the parent node of the dependent income table
        var parentElement = document.getElementById('id_familyinfo_family_issues').parentNode;

        // Insert the error message element at the top of the parent node
        parentElement.insertBefore(errorMessageElement, parentElement.firstChild);

        // Focus on the error message
        errorMessageElement.focus();

        // Remove the error message after a specified duration
        //setTimeout(function () {
        //  removeMaxRowErrorMessage();
        //}, duration);
      }

      // Listen for changes in the checkboxes to update the error message
      var checkboxes = document.querySelectorAll('#id_familyinfo_family_issues input[type="checkbox"]');
      checkboxes.forEach(function (checkbox) {
        checkbox.addEventListener('change', function () {
          // Check if more than one checkbox is checked
          var checkedCount = Array.from(checkboxes).filter(function (checkbox) {
            return checkbox.checked;
          }).length;

          // If more than one checkbox is checked, remove the error message
          if (checkedCount > 0) {
            removeMinChoiceCountFamilyIssuesErrorMessage();
            
          }
        });
      });

      // Set the error message text
      errorMessageElement.textContent = message;
    }

    // Function to remove the error message
    function removeMinChoiceCountFamilyIssuesErrorMessage() {
      var errorMessageElement = document.getElementById('minChoiceCountFamilyIssuesErrorMessage');
      if (errorMessageElement) {
        errorMessageElement.remove();
        $("#submit-btn").prop("disabled", false); // Enable the submit button when the error is removed
        // to fix the error where the alert is not detecting the changes
        updateAlert();
        updateTabs();
      }
    }

    // Function to display an error message
    function displayMinChoiceCountFamilyNeedsErrorMessage(message, duration) {
      // Check if the error message element already exists
      var errorMessageElement = document.getElementById('minChoiceCountFamilyNeedsErrorMessage');
      
      // If not, create a new element and append it to the page
      if (!errorMessageElement) {
        errorMessageElement = document.createElement('div');
        errorMessageElement.id = 'minChoiceCountFamilyNeedsErrorMessage';
        errorMessageElement.classList.add('alert', 'alert-danger', 'minChoiceErrorMessage');

        // Get the parent node of the dependent income table
        var parentElement = document.getElementById('id_familyinfo_needs_type').parentNode;

        // Insert the error message element at the top of the parent node
        parentElement.insertBefore(errorMessageElement, parentElement.firstChild);

        // Focus on the error message
        errorMessageElement.focus();

        // Remove the error message after a specified duration
        //setTimeout(function () {
        //  removeMaxRowErrorMessage();
        //}, duration);
      }

      // Listen for changes in the checkboxes to update the error message
      var checkboxes = document.querySelectorAll('#id_familyinfo_needs_type input[type="checkbox"]');
      checkboxes.forEach(function (checkbox) {
        checkbox.addEventListener('change', function () {
          // Check if more than one checkbox is checked
          var checkedCount = Array.from(checkboxes).filter(function (checkbox) {
            return checkbox.checked;
          }).length;

          // If more than one checkbox is checked, remove the error message
          if (checkedCount > 0) {
            removeMinChoiceCountFamilyNeedsErrorMessage();
          }
        });
      });

      // Set the error message text
      errorMessageElement.textContent = message;
    }

    // Function to remove the error message
    function removeMinChoiceCountFamilyNeedsErrorMessage() {
      var errorMessageElement = document.getElementById('minChoiceCountFamilyNeedsErrorMessage');
      if (errorMessageElement) {
        errorMessageElement.remove();
        $("#submit-btn").prop("disabled", false); // Enable the submit button when the error is removed
        // to fix the error where the alert is not detecting the changes
        updateAlert();
        updateTabs();
      }
    }

    // Initially update the alert and tabs based on the form's validation status
    updateAlert();
    updateTabs();

    // Add click and input event listeners to checkboxes inside the family issues container
    $('#id_familyinfo_family_issues input[type="checkbox"]').on('click input', function () {
      displayMinChoiceCountFamilyIssuesErrorMessage("الرجاء تحديد نوع واحد على الأقل.", 5000);
      
      updateAlert(); // Update the alert after displaying the custom error
      updateTabs();  // Update the tabs after displaying the custom error
    });

    // Add click and input event listeners to checkboxes inside the family needs container
    $('#id_familyinfo_needs_type input[type="checkbox"]').on('click input', function () {
      displayMinChoiceCountFamilyNeedsErrorMessage("الرجاء تحديد نوع واحد على الأقل.", 5000);
      
      updateAlert(); // Update the alert after displaying the custom error
      updateTabs();  // Update the tabs after displaying the custom error
    });

    // A function to check whether the provided national id exists before in the family table or not
    function isNationalIdExists(nationalId) {
      var nationalIdExists = false; // Flag variable to indicate whether the national ID exists

      // Iterate through each row in the table body
      $('#family-table tbody tr').each(function() {
          // Get the national ID value from the current row
          var existingNationalId = $(this).find('td[data-attr="dependent_edit_info_national_id"]').text().trim();
  
          // Compare the existing national ID with the input national ID
          if (existingNationalId === nationalId) {
              // Set the flag variable to true if the national ID already exists
              nationalIdExists = true;
              return false; // Exit the loop early since we found a match
          }
      });
  
      // Return the flag variable indicating whether the national ID exists
      return nationalIdExists;
    }

    var excludedFieldsAddDependent = ["id_dependent_info_monthly_income", "id_dependent_info_income_source", "id_dependent_info_needs_description"]; // IDs of fields to exclude

    $add_dependent_form = $('#editDependentForm');

    // Retrieve the CSRF token from the specific form with id 'editDependentForm'
    var csrfTokenDepForm = $('#editDependentForm input[name=csrfmiddlewaretoken]').val();

    // When "add Child button" is clicked, the following function is called
    $(".addChildBtn").click(function (event) {

      // This line prevents the form from submitting
      event.preventDefault();

      // Clear previous validation errors
      // $add_dependent_form.validate().resetForm();

      // Define your validation rules here
      $add_dependent_form.validate({
        // Your validation rules
        rules: {
          // rules for your fields
          // dependent_information ---------
          dependent_info_first_name: {
            required: true,
            dependentNameRegex: true,
            minlength: 2,
            maxlength: 50,
          },
          dependent_info_second_name: {
            required: true,
            dependentNameRegex: true,
            minlength: 2,
            maxlength: 50,
          },
          dependent_info_last_name: {
            required: true,
            dependentNameRegex: true,
            minlength: 2,
            maxlength: 50,
          },
          dependent_info_relationship: {
            required: true,
          },
          dependent_info_national_id: {
            required: true,
            nationalidRegex: true,
            remote: {
              url: '{% url 'validate_national_id_dependent' user_id=request.user.id %}',
              type: 'post',
              data: {
                national_id: function() {
                  return $('#id_dependent_info_national_id').val();
                },
                csrfmiddlewaretoken: csrfTokenDepForm,  // Include CSRF token
              },
            },
          },
          dependent_info_national_id_exp_date: {
            required: false,
            dateISO: true,
          },
          dependent_info_work_status: {
            required: true,
          },
          dependent_info_employer: {
            required: true,
          },
          dependent_info_gender: {
            required: true,
          },
          dependent_info_marital_status: {
            required: true,
          },
          dependent_info_educational_status: {
            required: true,
          },
          dependent_info_educational_level: {
            required: true,
          },
          dependent_info_educational_degree: {
            required: true,
          },
          dependent_info_health_status: {
            required: true,
          },
          dependent_info_disease_type: {
            required: true,
          },
          dependent_info_date_of_birth: {
            required: true,
            dateISO: true,
          },
          dependent_info_needs_type: {
            required: true,
          },
          dependentinfo_needs_description: {
            required: false,
          },
          dependent_info_contribute_to_family_income: {
            required: true,
          },
          dependent_info_is_disabled: {
            required: true,
          },
          dependent_info_disability_type: {
            required: true,
          },
        },
        messages: {
          dependent_info_first_name: {
            required: "الرجاء إدخال الاسم حسب الهوية/الإقامة",
            minlength: "يجب ألا يقل الاسم عن حرفين",
          },
          dependent_info_second_name: {
            required: "الرجاء إدخال الاسم حسب الهوية/الإقامة",
            minlength: "يجب ألا يقل الاسم عن حرفين",
          },
          dependent_info_last_name: {
            required: "الرجاء إدخال الاسم حسب الهوية/الإقامة",
            minlength: "يجب ألا يقل الاسم عن حرفين",
          },
          dependent_info_gender: {
            required: "الرجاء اختيار الجنس",
          },
          dependent_info_relationship: {
            required: "الرجاء اختيار صلة القرابة",
          },
          dependent_info_national_id: {
            remote: "رقم الهوية / الإقامة تم استخدامه بالفعل!",
          },
          // Add other field messages here
        },
        errorElement: "div",
        errorClass: "invalid-feedback",
        highlight: function (element, errorClass, validClass) {
          //$(element).addClass('is-invalid');
          $(element).closest(".form-group").addClass("has-error");

          // Check if the field is excluded
          if (excludedFieldsAddDependent.indexOf(element.id) === -1) {
            $(element).addClass("is-invalid");
            $(element).removeClass("is-valid");
          }
        },
        unhighlight: function (element, errorClass, validClass) {
          $(element).closest(".form-group").removeClass("has-error");

          // Check if the field is excluded
          if (excludedFieldsAddDependent.indexOf(element.id) === -1) {
            $(element).removeClass("is-invalid");
            $(element).addClass("is-valid");
          }
        },
        errorPlacement: function (error, element) {
          // Check if the element is inside an input-group
          if (element.parent(".input-group").length) {
            // Place the error after the input-group
            error.insertAfter(element.parent(".input-group"));
          } else {
            // Default placement for other elements
            error.insertAfter(element);
          }
        },
        // other options
      });

      var dependentFirstName = $("#id_dependent_info_first_name").val().trim();
      var dependentSecondName = $("#id_dependent_info_second_name").val().trim();
      var dependentLastName = $("#id_dependent_info_last_name").val().trim();
      var dependentGender = $("#id_dependent_info_gender").val();

      var dependentRelationship = $("#id_dependent_info_relationship").val();
      var dependentEducationalStatus = $(
        "#id_dependent_info_educational_status"
      ).val();
      var dependentMaritalStatus = $("#id_dependent_info_marital_status").val();
      var dependentNationalID = $("#id_dependent_info_national_id").val();

      var dependentHealthStatus = $("#id_dependent_info_health_status").val();
      var dependentMonthlyIncome = $("#id_dependent_info_monthly_income").val();
      var dependentIncomeSource = $("#id_dependent_info_income_source").val();
      var dependentNeedsType = $("#id_dependent_info_needs_type").val();

      var dependentEducationalLevel = $(
        "#id_dependent_info_educational_level"
      ).val();
      var dependentEducationalDegree = $(
        "#id_dependent_info_educational_degree"
      ).val();
      var dependentDateOfBirth = $("#id_dependent_info_date_of_birth").val();
      var dependentNationalIDExpDate = $(
        "#id_dependent_info_national_id_exp_date"
      ).val();

      var DependentDiseaseType = $("#id_dependent_info_disease_type").val();
      var DependentNeedsDescription = $(
        "#id_dependent_info_needs_description"
      ).val();

      var dependentWorkStatus = $("#id_dependent_info_work_status").val();
      var dependentEmployer = $("#id_dependent_info_employer").val().trim();

      var dependentContributeToFamilyIncome = $("#id_dependent_info_contribute_to_family_income").val();
      
      var dependentDisabilityCheck = $("#id_dependent_info_is_disabled").val();
      var dependentDisabilityType = $("#id_dependent_info_disability_type").val();

      // Get all checkboxes within the specified container
      var checkboxes = document.querySelectorAll('#id_dependent_info_needs_type input[type="checkbox"]');
        
      // Check if at least one checkbox is selected
      var atLeastOneChecked = Array.from(checkboxes).some(function(checkbox) {
        return checkbox.checked;
      });

      // Alert the user if the provided national ID is added before in the family table
      if (isNationalIdExists(dependentNationalID)) {
        alert("رقم الهوية/الإقامة للمرافق تم إضافته بالفعل في قائمة المرافقين!");
        return;
      }

      var applierNationalID = $("#id_personalinfo_national_id").val().trim();
      // Alert the user if the provided national ID is equal to the applier national ID (in the first step)
      if (dependentNationalID === applierNationalID) {
        alert("رقم الهوية/الإقامة للمرافق لا يمكن أن يكون مماثلًا لرقم الهوية/الإقامة لمقدم الطلب!!");
        return;
      }

      // Collect dependent income information by looping over the income table
      function getDependentIncomeTableDataAsJSON() {
        // Create an array to store income information
        var incomeInfoArray = [];

        const dependentIncomeTable = document.getElementById('incomeInfoTable');
        const dependentIncomeTableRows = document.querySelectorAll('#incomeInfoTable tr');

        for (let i = 1; i < dependentIncomeTableRows.length; i++) {
          const cells = dependentIncomeTableRows[i].getElementsByTagName('td');

          // Create a JSON object to store income information
          var incomeInfo = {
            income_amount: cells[0].innerText,
            income_source: cells[1].innerText,
          };

          incomeInfoArray.push(incomeInfo);
        }
        
        return JSON.stringify(incomeInfoArray);
      }

      let dependentIncomeJSON = getDependentIncomeTableDataAsJSON();

      
      // Collecting and storing dependent needs type values
      var dependentNeedsTypeArray = [];
      $("#id_dependent_info_needs_type input[type=checkbox]:checked").each(function() {
        dependentNeedsTypeArray.push($(this).val());
      });

      if ($add_dependent_form.valid()) {

        if ($("#edit_beneficiary_request_form").valid() === true) {

          if (!atLeastOneChecked) {
            // Display an error message or perform any other action to indicate the requirement
            displayMinChoiceCountErrorMessage('الرجاء تحديد نوع واحد على الأقل.', 5000);
            return;
          }

          var $row = $("<tr></tr>");
          $row.append(
            $("<td></td>")
              .text(dependentFirstName)
              .attr("data-attr", "dependent_edit_info_first_name")
          );
          $row.append(
            $("<td></td>")
              .text(dependentSecondName)
              .addClass("d-none")
              .attr("data-attr", "dependent_edit_info_second_name")
          );
          $row.append(
            $("<td></td>")
              .text(dependentLastName)
              .addClass("d-none")
              .attr("data-attr", "dependent_edit_info_last_name")
          );
          $row.append(
            $("<td></td>")
              .text(dependentGender)
              .attr("data-attr", "dependent_edit_info_gender")
          );
          $row.append(
            $("<td></td>")
              .text(dependentRelationship)
              .attr("data-attr", "dependent_edit_info_relationship")
          );
          $row.append(
            $("<td></td>")
              .text(dependentEducationalStatus)
              .attr("data-attr", "dependent_edit_info_educational_status")
          );
          $row.append(
            $("<td></td>")
              .text(dependentMaritalStatus)
              .attr("data-attr", "dependent_edit_info_marital_status")
          );
          $row.append(
            $("<td></td>")
              .text(dependentNationalID)
              .attr("data-attr", "dependent_edit_info_national_id")
              .attr("data-attr-base-nid", dependentNationalID)
          );
          $row.append(
            $("<td></td>")
              .text(dependentHealthStatus)
              .attr("data-attr", "dependent_edit_info_health_status")
          );
          $row.append(
            $("<td></td>")
              .text(dependentIncomeJSON)
              .addClass("d-none dependent_income_json")
              .attr("data-attr", "dependent_edit_info_income_table_data")
          );
          /*
          $row.append(
            $("<td></td>")
              .text(dependentIncomeSource)
              .addClass("d-none")
              .attr("data-attr", "dependent_edit_info_income_source")
          );
          */
          // Add dependent needs type as a hidden cell or in any other way you prefer
          $row.append(
            $("<td></td>")
              .text(dependentNeedsTypeArray.join(','))
              .addClass("d-none")
              .attr("data-attr", "dependent_edit_info_needs_type")
          );
          $row.append(
            $("<td></td>")
              .text(dependentEducationalDegree)
              .addClass("d-none")
              .attr("data-attr", "dependent_edit_info_educational_degree")
          );
          $row.append(
            $("<td></td>")
              .text(dependentDateOfBirth)
              .addClass("d-none")
              .attr("data-attr", "dependent_edit_info_date_of_birth")
          );
          $row.append(
            $("<td></td>")
              .text(dependentNationalIDExpDate)
              .addClass("d-none")
              .attr("data-attr", "dependent_edit_info_national_id_exp_date")
          );
          $row.append(
            $("<td></td>")
              .text(DependentNeedsDescription)
              .addClass("d-none")
              .attr("data-attr", "dependent_edit_info_needs_description")
          );
          $row.append(
            $("<td></td>")
              .text(dependentEducationalLevel)
              .addClass("d-none")
              .attr("data-attr", "dependent_edit_info_educational_level")
          );
          $row.append(
            $("<td></td>")
              .text(DependentDiseaseType)
              .addClass("d-none")
              .attr("data-attr", "dependent_edit_info_disease_type")
          );

          $row.append(
            $("<td></td>")
              .text(dependentWorkStatus)
              .addClass("d-none")
              .attr("data-attr", "dependent_edit_info_work_status")
          );
          $row.append(
            $("<td></td>")
              .text(dependentEmployer)
              .addClass("d-none")
              .attr("data-attr", "dependent_edit_info_employer")
          );
          $row.append(
            $("<td></td>")
              .text(dependentContributeToFamilyIncome)
              .addClass("d-none")
              .attr("data-attr", "dependent_edit_info_contribute_to_family_income")
          );
          $row.append(
            $("<td></td>")
              .text(dependentDisabilityCheck)
              .addClass("d-none")
              .attr("data-attr", "dependent_edit_info_is_disabled")
          );
          $row.append(
            $("<td></td>")
              .text(dependentDisabilityType)
              .addClass("d-none")
              .attr("data-attr", "dependent_edit_info_disability_type")
          );


          // Edit Button
          var $editButton = $("<button>تفاصيل</button>")
            .addClass("edit btn btn-primary")
            .attr("data-bs-toggle", "modal")
            .attr("data-bs-target", "#editModal")
            .attr("id", "editModalButton")
            .click(function (event) {
              event.preventDefault();
              // Populate the modal fields with data from $row
              populateEditModal($row);
            });

          // Delete Button
          var $deleteButton = $('<button type="button">حذف</button>')
            .addClass("delete btn btn-danger")
            .click(function (event) {
              event.preventDefault();
              $row.remove();
            });

          // Action cell that containes Delete & Edit buttons
          var $actionsCell = $(
            '<td class="d-grid gap-2" style="grid-template-columns: 80px 80px; grid-template-rows: 50px;"></td>'
          ).append($deleteButton);
          $actionsCell.append($editButton);

          $row.append($actionsCell);

          $("#family-table tbody").append($row);

          // Clear checkboxes of dependent needs type
          $("#id_dependent_info_needs_type input[type=checkbox]").prop('checked', false);

          // Clear input fields
          $("#id_dependent_info_first_name").val("");
          $("#id_dependent_info_second_name").val("");
          $("#id_dependent_info_last_name").val("");
          $("#id_dependent_info_gender").val("");
          $("#id_dependent_info_relationship").val("");
          $("#id_dependent_info_educational_status").val("");
          $("#id_dependent_info_marital_status").val("");
          $("#id_dependent_info_national_id").val("");
          $("#id_dependent_info_health_status").val("");
          $("#id_dependent_info_monthly_income").val("");
          $("#id_dependent_info_income_source").val("");
          $("#id_dependent_info_needs_type").val("");
          $("#id_dependent_info_educational_level").val("");
          $("#id_dependent_info_educational_degree").val("");
          $("#id_dependent_info_date_of_birth").val("");
          $("#id_dependent_info_national_id_exp_date").val("");
          $("#id_dependent_info_needs_description").val("");
          $("#id_dependent_info_disease_type").val("");
          $("#id_dependent_info_work_status").val("");
          $("#id_dependent_info_employer").val("");
          $("#id_dependent_info_contribute_to_family_income").val("");
          $("#id_dependent_info_is_disabled").val("");
          $("#id_dependent_info_disability_type").val("");

          // Clear existing rows in the income table
          $("#incomeInfoTableBody").empty();

          // Remove "is-valid" and "is-invalid" classes from input elements within #family-form container
          $('#family-form input').removeClass('is-valid is-invalid');

          // Remove "is-valid" and "is-invalid" classes from select elements within #family-form container
          $('#family-form select').removeClass('is-valid is-invalid');

          // Remove "is-valid" and "is-invalid" classes from textarea elements within #family-form container
          $('#family-form textarea').removeClass('is-valid is-invalid');

          // Remove error messages
          removeMaxRowErrorMessage();
          removeMinChoiceCountErrorMessage();

        } else {
          alert("الرجاء التأكد من تصحيح الاخطاء!");

        }
      } else { // else (add_dependent_form is not valid)
        alert("الرجاء إدخال تفاصيل المرافقين!");

        if (!atLeastOneChecked) {
          // Display an error message or perform any other action to indicate the requirement
          displayMinChoiceCountErrorMessage('الرجاء تحديد نوع واحد على الأقل.', 5000);
          $add_dependent_form.validate();
          return;
        }
      }
    });

    // Function to remove the error message
    function removeMaxRowErrorMessage() {
      var errorMessageElement = document.getElementById('incomeTableErrorMessage');
      if (errorMessageElement) {
        errorMessageElement.remove();
      }
    }


    // Function to display an error message
    function displayMinChoiceCountErrorMessage(message, duration) {
      // Check if the error message element already exists
      var errorMessageElement = document.getElementById('minChoiceCountErrorMessage');
      
      // If not, create a new element and append it to the page
      if (!errorMessageElement) {
        errorMessageElement = document.createElement('div');
        errorMessageElement.id = 'minChoiceCountErrorMessage';
        errorMessageElement.classList.add('alert', 'alert-danger');

        // Get the parent node of the dependent income table
        var parentElement = document.getElementById('id_dependent_info_needs_type').parentNode;

        // Insert the error message element at the top of the parent node
        parentElement.insertBefore(errorMessageElement, parentElement.firstChild);

        // Focus on the error message
        errorMessageElement.focus();

        // Remove the error message after a specified duration
        //setTimeout(function () {
        //  removeMaxRowErrorMessage();
        //}, duration);
      }

      // Listen for changes in the checkboxes to update the error message
      var checkboxes = document.querySelectorAll('#id_dependent_info_needs_type input[type="checkbox"]');
      checkboxes.forEach(function (checkbox) {
        checkbox.addEventListener('change', function () {
          // Check if more than one checkbox is checked
          var checkedCount = Array.from(checkboxes).filter(function (checkbox) {
            return checkbox.checked;
          }).length;

          // If more than one checkbox is checked, remove the error message
          if (checkedCount > 0) {
            removeMinChoiceCountErrorMessage();
          }
        });
      });

      // Set the error message text
      errorMessageElement.textContent = message;
    }

    // Function to remove the error message
    function removeMinChoiceCountErrorMessage() {
      var errorMessageElement = document.getElementById('minChoiceCountErrorMessage');
      if (errorMessageElement) {
        errorMessageElement.remove();
      }
    }

    // Assuming you have an event handler like this
    $('#family-table tbody').on('click', '.edit', function(event) {
      event.preventDefault();
      var $row = $(this).closest('tr');
      populateEditModal($row);
    });

    function populateEditModal($row) {
      // First, uncheck all checkboxes in the modal
      $("#editModal").find("input[type='checkbox']").prop('checked', false);
  
      $row.children("td").each(function () {
          var tdDataAttr = $(this).data("attr");
          var cellText = $(this).text();
          var $inputs = $("#editModal").find('[name^="' + tdDataAttr + '"]'); // Selects all inputs that start with tdDataAttr
  
          $inputs.each(function() {
              if ($(this).attr('type') === 'checkbox') {
                  // Splitting the comma-separated values
                  var values = cellText.split(',').map(function(item) {
                      return item.trim(); // Trimming any extra whitespace
                  });
  
                  // Check if the checkbox value is in the values array
                  if (values.includes($(this).val())) {
                      $(this).prop('checked', true);
                  }
              } else {
                  
                  $(this).val(cellText);

                // If the input is the national id field, add a data attribute
                if ($(this).attr('name') === 'dependent_edit_info_national_id') {

                    // Assuming you want to add a data attribute named 'custom-data'
                    $(this).attr('data-attr-base-nid', cellText);
                }
              }
          });

          // Retrieve the stored income information array from the family table row
          var incomeInfoArrayText = "";

          if (tdDataAttr == "dependent_edit_info_income_table_data") {

            // Clear existing rows in the edit income table
            $("#incomeEditInfoTableBody").empty();

            incomeInfoArrayText = cellText;
            var incomeInfoArray = JSON.parse(incomeInfoArrayText) || [];

            // Add rows for each income information object in the array
            incomeInfoArray.forEach(function (incomeInfo) {
              var $incomeRow = $("<tr></tr>");
              $incomeRow.append($("<td></td>").text(incomeInfo.income_amount));
              $incomeRow.append($("<td></td>").text(incomeInfo.income_source));

              // Add a delete button to each row
              var $deleteButton = $("<button>حذف</button>").addClass('btn btn-danger btn-sm removeIncomeEditInfoRow');
              $deleteButton.on("click", function () {
                  // Handle the delete button click event here
                  // You can remove the corresponding row from the table or perform any other action
                  $incomeRow.remove();

                  // Select save changes btn
                  var $saveChangesButton = $("#saveChanges");
                  var $modalForm = $("#editModalForm");

                  if ($modalForm.valid()) {
                      $saveChangesButton.prop("disabled", false);
                  } else {
                      $saveChangesButton.prop("disabled", true);
                  }
              });

              // Append the delete button column to the row
              $incomeRow.append($("<td></td>").append($deleteButton));

              // Append the row to the edit income table
              $("#incomeEditInfoTableBody").append($incomeRow);
            });
          }
      });
  
      $("#saveChanges").data("rowToEdit", $row);
    }

    // Collect dependent income information by looping over the income table
    function getDependentIncomeTableDataAsJSON() {
      // Create an array to store income information
      var incomeInfoArray = [];

      const dependentIncomeTable = document.getElementById('incomeEditInfoTable');
      const dependentIncomeTableRows = document.querySelectorAll('#incomeEditInfoTable tr');

      for (let i = 1; i < dependentIncomeTableRows.length; i++) {
        const cells = dependentIncomeTableRows[i].getElementsByTagName('td');

        // Create a JSON object to store income information
        var incomeInfo = {
          income_amount: cells[0].innerText,
          income_source: cells[1].innerText,
        };

        incomeInfoArray.push(incomeInfo);
      }

      return JSON.stringify(incomeInfoArray);
    }

    
    // Onclick function to save the changes made to the dependent info
    $("#saveChanges").click(function (event) {
      event.preventDefault();

      var duplicateNationalIdFound = false; // Flag to indicate whether a duplicate national ID is found

      var isEqualToApplierNationalId = false; // Flag to indicate whether the dependent national ID is equal to applier national ID

      // Get all checkboxes within the specified container
      var checkboxes = document.querySelectorAll('#id_dependent_edit_info_needs_type input[type="checkbox"]');
      
      // Check if at least one checkbox is selected
      var atLeastOneChecked = Array.from(checkboxes).some(function(checkbox) {
        return checkbox.checked;
      });

      if (!atLeastOneChecked) {
        // Display an error message or perform any other action to indicate the requirement
        displayMinChoiceCountEditErrorMessage('الرجاء تحديد نوع واحد على الأقل.', 5000);
        return;
      }
  
      var $rowToEdit = $(this).data("rowToEdit");
      var checkedValues = [];
  
      // Iterate over all inputs, selects, and textareas in the modal
      $("#editModal").find(".modal-body input, .modal-body select, .modal-body textarea").each(function () {
          // Get the name of the input field in the edit modal
          var inputName = $(this).attr("name");
          // Select the cell in the corresponding row of the dependent with data-attr as inputName
          var $cell = $rowToEdit.find('td[data-attr="' + inputName + '"]');

          var applierNationalID = $("#id_personalinfo_national_id").val().trim();

          // Retrieve the data for national id in the edit form
          if ($(this).attr("name") == "dependent_edit_info_national_id") {

            // Get the value of data-attr-base-nid attribute
            var baseNid = $(this).data("attr-base-nid");

            // Check whether the provided national ID equal to the applier national ID
            if ($(this).val() === applierNationalID) {
              alert("رقم الهوية/الإقامة للمرافق لا يمكن أن يكون مماثلًا لرقم الهوية/الإقامة لمقدم الطلب!!");
              isEqualToApplierNationalId = true; // Set the flag to true
              return false; // Exit the loop early since we found a duplicate
            }

            // Alert the user if the provided national ID is added before in the family table
            if (isNationalIdExists($(this).val())) {

              // Check whether the national ID equals to the base national ID
              if (baseNid != $(this).val()) {
                alert("رقم الهوية/الإقامة للمرافق تم إضافته بالفعل في قائمة المرافقين!");
                duplicateNationalIdFound = true; // Set the flag to true
                return false; // Exit the loop early since we found a duplicate
              }
            }
          }

          if ($(this).attr('type') === 'checkbox') {
              // If it's a checkbox, gather all checked values with this name
              $('#editModal input[name="' + inputName + '"]:checked').each(function() {
                  checkedValues.push($(this).val());
              });
              // Select the cell that holds the dependent needs type as a list
              var $cell = $rowToEdit.find('td[data-attr="dependent_edit_info_needs_type"]');
              // Join the values with a comma and update the cell text
              $cell.text(checkedValues.join(','));
          } else {
              // For other input types, just update the cell text
              $cell.text($(this).val());
          }
      });

      // If a duplicate national ID is found, don't proceed with saving changes
      if (duplicateNationalIdFound || isEqualToApplierNationalId) {
        return;
      }

      // Get dependent income information from incomeEditInfoTable
      let dependentIncomeJSON = getDependentIncomeTableDataAsJSON();

      // Select the corresponding cell
      var $incomeTableCell = $rowToEdit.find('td[data-attr="dependent_edit_info_income_table_data"]');

      // Update the cell text (value)
      $incomeTableCell.text(dependentIncomeJSON);
  
      // Remove error messages
      removeMaxRowErrorMessage();
      removeMinChoiceCountEditErrorMessage();

      $("#editModal").modal("hide");
    });

    // Function to display an error message
    function displayMinChoiceCountEditErrorMessage(message, duration) {
      // Check if the error message element already exists
      var errorMessageElement = document.getElementById('minChoiceCountEditErrorMessage');
      
      // If not, create a new element and append it to the page
      if (!errorMessageElement) {
        errorMessageElement = document.createElement('div');
        errorMessageElement.id = 'minChoiceCountEditErrorMessage';
        errorMessageElement.classList.add('alert', 'alert-danger');

        // Get the parent node of the dependent income table
        var parentElement = document.getElementById('id_dependent_edit_info_needs_type').parentNode;

        // Insert the error message element at the top of the parent node
        parentElement.insertBefore(errorMessageElement, parentElement.firstChild);

        // Focus on the error message
        errorMessageElement.focus();

        // Remove the error message after a specified duration
        //setTimeout(function () {
        //  removeMaxRowErrorMessage();
        //}, duration);
      }

      // Listen for changes in the checkboxes to update the error message
      var checkboxes = document.querySelectorAll('#id_dependent_edit_info_needs_type input[type="checkbox"]');
      checkboxes.forEach(function (checkbox) {
        checkbox.addEventListener('change', function () {
          // Check if more than one checkbox is checked
          var checkedCount = Array.from(checkboxes).filter(function (checkbox) {
            return checkbox.checked;
          }).length;

          // If more than one checkbox is checked, remove the error message
          if (checkedCount > 0) {
            removeMinChoiceCountEditErrorMessage();
          }
        });
      });

      // Set the error message text
      errorMessageElement.textContent = message;
    }

    // Function to remove the error message
    function removeMinChoiceCountEditErrorMessage() {
      var errorMessageElement = document.getElementById('minChoiceCountEditErrorMessage');
      if (errorMessageElement) {
        errorMessageElement.remove();
      }
    }

    // Function to reset the values of the input fields after the modal is closed
    function resetInputFields() {
      // Reset the value of the monthly income input field
      $('#id_dependent_edit_info_monthly_income').val('');

      // Reset the value of the income source select field
      $('#id_dependent_edit_info_income_source').val('');
    }

    // Add an event listener for the modal's 'hidden.bs.modal' event
    $('#editModal').on('hidden.bs.modal', function () {
      // Call the function to reset the input fields
      resetInputFields();

      // Assuming your button has an ID "saveChanges"
      var saveChangesButton = document.getElementById('saveChanges');

      // Remove the 'disabled' attribute
      saveChangesButton.setAttribute('disabled', 'disabled');

      // Show loading state
      document.getElementById('loadingStateEditModal').style.display = 'block';
      // Hide actual content
      document.getElementById('editModalContent').style.display = 'none';
    });


    // Function to handle the input event on the educational status dropdown
    function handleEducationalStatusEditInput() {
      // Get the selected value
      var selectedValue = document.getElementById('id_dependent_edit_info_educational_status').value;
      
      // Get the elements representing educational level and degree sections
      var educationalLevelGroup = document.getElementById('id_dependent_edit_info_educational_level_group_info');
      var educationalDegreeGroup = document.getElementById('id_dependent_edit_info_educational_degree_group_info');

      // Show or hide the sections based on the selected value
      if (selectedValue === 'يدرس') {
        // If يدرس is selected, show educational level and hide educational degree
        educationalLevelGroup.style.display = 'block';
        educationalDegreeGroup.style.display = 'none';
      } else if (selectedValue === 'لا يدرس') {
        // If لا يدرس is selected, show educational degree and hide educational level
        educationalLevelGroup.style.display = 'none';
        educationalDegreeGroup.style.display = 'block';
      } else {
        // If none is selected, hide both sections
        educationalLevelGroup.style.display = 'none';
        educationalDegreeGroup.style.display = 'none';
      }
    }

    // Function to handle the input event on the educational status dropdown
    function handleHealthStatusEditInput() {
      // Get the selected value
      var selectedValue = document.getElementById('id_dependent_edit_info_health_status').value;
      
      // Get the elements representing educational level and degree sections
      var diseaseTypeGroup = document.getElementById('id_dependent_edit_info_disease_type_group_info');

      // Show or hide the sections based on the selected value
      if (selectedValue === 'جيدة') {
        diseaseTypeGroup.style.display = 'none';
      } else if (selectedValue === 'غير جيدة') {
        diseaseTypeGroup.style.display = 'block';
      } else {
        // If none is selected, hide both sections
        diseaseTypeGroup.style.display = 'none';
      }
    }

    // Function to handle the input event on the work status dropdown
    function handleWorkStatusEditInput() {
      // Get the selected value
      var selectedValue = document.getElementById('id_dependent_edit_info_work_status').value;
      
      // Get the elements representing work status sections
      var employerGroup = document.getElementById('id_dependent_edit_info_employer_group_info');

      // Show or hide the sections based on the selected value
      if (selectedValue === 'نعم') {
        employerGroup.style.display = 'block';
      } else if (selectedValue === 'لا') {
        employerGroup.style.display = 'none';
      } else {
        // If none is selected, hide both sections
        employerGroup.style.display = 'none';
      }
    }

    // Function to handle the input event on the is disability dropdown
    function handleIsDisabledEditInput() {
      // Get the selected value
      var selectedValue = document.getElementById('id_dependent_edit_info_is_disabled').value;
      
      // Get the elements representing is disability sections
      var disabilityTypeGroup = document.getElementById('id_dependent_edit_info_disability_type_group_info');

      // Show or hide the sections based on the selected value
      if (selectedValue === 'نعم') {
        disabilityTypeGroup.style.display = 'block';
      } else if (selectedValue === 'لا') {
        disabilityTypeGroup.style.display = 'none';
      } else {
        // If none is selected, hide both sections
        disabilityTypeGroup.style.display = 'none';
      }
    }

    // Function to handle the modal's shown event
    function handleModalShown() {
      // Show loading state
      document.getElementById('loadingStateEditModal').style.display = 'block';
      document.getElementById('editModalContent').style.display = 'none';

      // Simulate an asynchronous operation (replace this with your actual data retrieval logic)
      setTimeout(function () {
        // Hide loading state
        document.getElementById('loadingStateEditModal').style.display = 'none';
        // Show actual content
        document.getElementById('editModalContent').style.display = 'block';
        
        // Call the function on the educational status dropdown to set the initial visibility
        handleEducationalStatusEditInput.call(educationalStatusDropdown);
        handleHealthStatusEditInput.call();
        handleWorkStatusEditInput.call();
        handleIsDisabledEditInput.call();
      }, 2000); // 2000 = 2 seconds timeout

    }


    // Add event listener to the educational status dropdown for the input event
    var educationalStatusDropdown = document.getElementById('id_dependent_info_educational_status');// It may need to be changed to "_edit_info_"
    educationalStatusDropdown.addEventListener('input', handleEducationalStatusEditInput);

    var healthStatusDropdown = document.getElementById('id_dependent_edit_info_health_status');
    healthStatusDropdown.addEventListener('input', handleHealthStatusEditInput);

    var workStatusDropdown = document.getElementById('id_dependent_edit_info_work_status');
    workStatusDropdown.addEventListener('input', handleWorkStatusEditInput);

    var disabilityTypeDropdown = document.getElementById('id_dependent_edit_info_is_disabled');
    disabilityTypeDropdown.addEventListener('input', handleIsDisabledEditInput);

    var categoryDropdown = document.getElementById('id_personalinfo_category');
    categoryDropdown.addEventListener('input', categoryCheck);

    // Call the function for the first time the data is loaded
    categoryCheck(categoryDropdown);

    // Get the modal element
    var editModal = new bootstrap.Modal(document.getElementById('editModal'));

    // Add event listener to the modal's shown event
    editModal._element.addEventListener('shown.bs.modal', handleModalShown);

    var $modalForm = $("#editModalForm");
    var $saveChangesButton = $("#saveChanges");

    // Retrieve the CSRF token from the specific form with id 'editModalForm'
    var csrfTokenEditDepForm = $('#editModalForm input[name=csrfmiddlewaretoken]').val();

    // Retrieve the data-attr-base-nid 
    //var base_national_id_edit_dep = $('#id_dependent_edit_info_national_id').data('data-attr-base-nid');

    $.validator.addMethod(
      "fullNameRegex",
      function (value, element) {
        return (
          this.optional(element) ||
          /^[a-zA-Z\u0621-\u064A]+([ '-][a-zA-Z\u0621-\u064A]+)*$/i.test(value)
        );
      },
      "يجب أن يتكون الاسم الكامل من الاسم الأول والأوسط والأخير."
    );

    // Validate Saudi Arabia IDs (Iqama/Saudi Natioanl Id)
    function validateSAID(id) {
      let type = id.substr(0, 1);
      let sum = 0;
      const _idLength = 10;
      const _type1 = "1";
      const _type2 = "2";
      id = id.trim();
      if (
        isNaN(parseInt(id)) ||
        id.length !== _idLength ||
        (type !== _type2 && type !== _type1)
      ) {
        return false;
      }
      for (let num = 0; num < 10; num++) {
        const digit = Number(id[num]);
        if (num % 2 === 0) {
          const doubled = digit * 2;
          const ZFOdd = `00${doubled}`.slice(-2);
          sum += Number(ZFOdd[0]) + Number(ZFOdd[1]);
        } else {
          sum += digit;
        }
      }
      return sum % 10 !== 0 ? false : true;
    }

    // Validator method for the national id (Iqama/Saudi)
    $.validator.addMethod(
      "nationalidRegex",
      function (value, element) {
        console.log(value, validateSAID(value));
        return this.optional(element) || validateSAID(value);
      },
      "أدخل رقم هوية/إقامة صحيح."
    );

    $.validator.addMethod(
      "dependentNameRegex",
      function (value, element) {
        return (
          this.optional(element) || /^[a-zA-Z0-9\u0621-\u064A]*$/i.test(value)
        );
      },
      "يحتوي الأسم على حروف فقط."
    );

    var includedFieldsEditModal = ["id_dependent_edit_info_national_id"]; // IDs of fields to include

    // Define your validation rules here
    $modalForm.validate({
      // Your validation rules
      rules: {
        // rules for your fields
        // dependent_information ---------
        dependent_edit_info_first_name: {
          required: true,
          dependentNameRegex: true,
          minlength: 2,
          maxlength: 50,
        },
        dependent_edit_info_second_name: {
          required: true,
          dependentNameRegex: true,
          minlength: 2,
          maxlength: 50,
        },
        dependent_edit_info_last_name: {
          required: true,
          dependentNameRegex: true,
          minlength: 2,
          maxlength: 50,
        },
        dependent_edit_info_relationship: {
          required: true,
        },
        dependent_edit_info_national_id: {
          required: true,
          nationalidRegex: true,
          remote: {
            url: '/beneficiaries/' + {{ request.user.id }}  + '/update/validate_national_id_edit_dependent/',
            type: 'post',
            data: {
              national_id: function() {
                return $('#id_dependent_edit_info_national_id').val();
              },
              csrfmiddlewaretoken: csrfTokenEditDepForm,  // Include CSRF token
              base_nid: function() { 
                // Get the value from the data-attr-base-nid attribute using plain JavaScript
                var element = document.getElementById('id_dependent_edit_info_national_id');
                return element.getAttribute('data-attr-base-nid');
              },
            },
          },
        },
        dependent_edit_info_national_id_exp_date: {
          required: false,
          dateISO: true,
        },
        dependent_edit_info_gender: {
          required: true,
        },
        dependent_edit_info_marital_status: {
          required: true,
        },
        dependent_edit_info_educational_status: {
          required: true,
        },
        dependent_edit_info_educational_level: {
          required: true,
        },
        dependent_edit_info_educational_degree: {
          required: true,
        },
        dependent_edit_info_health_status: {
          required: true,
        },
        dependent_edit_info_disease_type: {
          required: true,
        },
        dependent_edit_info_date_of_birth: {
          required: true,
          dateISO: true,
        },
        dependent_edit_info_needs_type: {
          required: true,
        },
        dependent_edit_info_needs_description: {
          required: false,
        },
        dependent_edit_info_work_status: {
          required: true,
        },
        dependent_edit_info_employer: {
          required: true,
        },
        dependent_edit_info_contribute_to_family_income: {
          required: true,
        },
        dependent_edit_info_is_disabled: {
          required: true,
        },
        dependent_edit_info_disability_type: {
          required: true,
        },
      },
      messages: {
        dependent_edit_info_first_name: {
          required: "الرجاء إدخال الاسم حسب الهوية/الإقامة",
          minlength: "يجب ألا يقل الاسم عن حرفين",
        },
        dependent_edit_info_second_name: {
          required: "الرجاء إدخال الاسم حسب الهوية/الإقامة",
          minlength: "يجب ألا يقل الاسم عن حرفين",
        },
        dependent_edit_info_last_name: {
          required: "الرجاء إدخال الاسم حسب الهوية/الإقامة",
          minlength: "يجب ألا يقل الاسم عن حرفين",
        },
        dependent_edit_info_gender: {
          required: "الرجاء اختيار الجنس",
        },
        dependent_edit_info_relationship: {
          required: "الرجاء اختيار صلة القرابة",
        },
        dependent_edit_info_national_id: {
          remote: "رقم الهوية / الإقامة تم استخدامه بالفعل!",
        },
      },
      errorElement: "div",
      errorClass: "invalid-feedback",
      highlight: function (element, errorClass, validClass) {
        //$(element).addClass('is-invalid');
        $(element).closest(".form-group").removeClass("has-error");

        // Check if the field is excluded
        if (includedFieldsEditModal.indexOf(element.id) !== -1) {
          $(element).addClass("is-invalid");
          $(element).removeClass("is-valid");
        }
      },
      unhighlight: function (element, errorClass, validClass) {
        $(element).closest(".form-group").removeClass("has-error");

        // Check if the field is excluded
        if (includedFieldsEditModal.indexOf(element.id) !== -1) {
          $(element).removeClass("is-invalid");
          $(element).addClass("is-valid");
        }
      },
      errorPlacement: function (error, element) {
        // Check if the element is inside an input-group
        if (element.parent(".input-group").length) {
          // Place the error after the input-group
          error.insertAfter(element.parent(".input-group"));
        } else {
          // Default placement for other elements
          error.insertAfter(element);
        }
      },
      // other options
    });


    // Check form validity on input change
    $modalForm.on("change keyup", function () {
      if ($modalForm.valid()) {
          $saveChangesButton.prop("disabled", false);
      } else {
          $saveChangesButton.prop("disabled", true);
      }
    });



    // Add an event listener to the dependent income table for add row btn
    $("#id_add_row_income_edit_info").on("click", function () {
      if ($modalForm.valid()) {
          $saveChangesButton.prop("disabled", false);
      } else {
          $saveChangesButton.prop("disabled", true);
      }
    });


    // Additionally, you may want to trigger the event when a row is removed from income table
    $(".removeIncomeEditInfoRow").on("click", function () {
      if ($modalForm.valid()) {
          $saveChangesButton.prop("disabled", false);
      } else {
          $saveChangesButton.prop("disabled", true);
      }
    });

    // Function to populate the table with dependent data
    function populateTable(dependentData) {
        var tableBody = $('#family-table tbody');

        // Clear existing rows
        tableBody.empty();

        // Loop through dependent data and append rows to the table
        for (var i = 0; i < dependentData.length; i++) {
            var dependent = dependentData[i];

            // Create a new row
            var newRow = $('<tr>');

            // Add data to the row
            newRow.append('<td data-attr="dependent_edit_info_first_name">' + dependent.dependent_first_name + '</td>');
            newRow.append('<td class="d-none" data-attr="dependent_edit_info_second_name">' + dependent.dependent_second_name + '</td>');
            // Add other columns similarly
            newRow.append('<td class="d-none" data-attr="dependent_edit_info_last_name">' + dependent.dependent_last_name + '</td>');
            newRow.append('<td data-attr="dependent_edit_info_gender">' + dependent.dependent_gender + '</td>');
            newRow.append('<td data-attr="dependent_edit_info_relationship">' + dependent.dependent_relationship + '</td>');
            newRow.append('<td data-attr="dependent_edit_info_educational_status">' + dependent.dependent_educational_status + '</td>');
            newRow.append('<td data-attr="dependent_edit_info_marital_status">' + dependent.dependent_marital_status + '</td>');
            newRow.append('<td data-attr="dependent_edit_info_national_id" data-attr-base-nid='+ dependent.dependent_national_id + '>' + dependent.dependent_national_id + '</td>');
            newRow.append('<td data-attr="dependent_edit_info_health_status">' + dependent.dependent_health_status + '</td>');

            // Assuming dependent.dependent_income_data is an array
            const income_list = dependent.dependent_income_data;

            // Convert the array of objects to a JSON string
            const jsonString = JSON.stringify(income_list);

            newRow.append('<td class="d-none dependent_income_json" data-attr="dependent_edit_info_income_table_data">' + jsonString + '</td>');
            newRow.append('<td class="d-none" data-attr="dependent_edit_info_needs_type">' + dependent.dependent_needs_type + '</td>');
            newRow.append('<td class="d-none" data-attr="dependent_edit_info_educational_degree">' + dependent.dependent_educational_degree + '</td>');
            newRow.append('<td class="d-none" data-attr="dependent_edit_info_date_of_birth">' + dependent.dependent_date_of_birth + '</td>');

            // Check if national ID expiration date is null or undefined
            var nationalIdExpDate = dependent.dependent_national_id_exp_date ? dependent.dependent_national_id_exp_date : '';
            newRow.append('<td class="d-none" data-attr="dependent_edit_info_national_id_exp_date">' + nationalIdExpDate + '</td>');

            newRow.append('<td class="d-none" data-attr="dependent_edit_info_needs_description">' + dependent.dependent_needs_description + '</td>');
            newRow.append('<td class="d-none" data-attr="dependent_edit_info_educational_level">' + dependent.dependent_educational_level + '</td>');
            newRow.append('<td class="d-none" data-attr="dependent_edit_info_disease_type">' + dependent.dependent_disease_type + '</td>');
            newRow.append('<td class="d-none" data-attr="dependent_edit_info_work_status">' + dependent.dependent_work_status + '</td>');
            newRow.append('<td class="d-none" data-attr="dependent_edit_info_employer">' + dependent.dependent_employer + '</td>');
            newRow.append('<td class="d-none" data-attr="dependent_edit_info_contribute_to_family_income">' + dependent.dependent_contribute_to_family_income + '</td>');
            newRow.append('<td class="d-none" data-attr="dependent_edit_info_is_disabled">' + dependent.dependent_disability_check + '</td>');
            newRow.append('<td class="d-none" data-attr="dependent_edit_info_disability_type">' + dependent.dependent_disability_type + '</td>');
            

            // Edit Button
            var $editButton = $("<button>تفاصيل</button>")
            .addClass("edit btn btn-primary")
            .attr("data-bs-toggle", "modal")
            .attr("data-bs-target", "#editModal")
            .attr("id", "editModalButton")
            .click(createEditButtonClickHandler(newRow));

            // Delete Button
            var $deleteButton = $('<button type="button">حذف</button>')
                .addClass("delete btn btn-danger")
                .click(createDeleteButtonClickHandler(newRow));

            // Action cell that contains Delete & Edit buttons
            var $actionsCell = $(
                '<td class="d-grid gap-2" style="grid-template-columns: 80px 80px; grid-template-rows: 50px;"></td>'
            ).append($deleteButton).append($editButton);

            // Append the action cell to the row
            newRow.append($actionsCell);

            // Append the row to the table
            tableBody.append(newRow);
        }

        // Function to handle edit button click
        function createEditButtonClickHandler(row) {
          return function(event) {
              event.preventDefault();
              // Populate the modal fields with data from the clicked row
              populateEditModal(row);
          };
        }

        // Function to handle delete button click
        function createDeleteButtonClickHandler(row) {
          return function(event) {
              event.preventDefault();
              row.remove(); // Remove the clicked row
          };
        }
    }

    // Call the function with dependent data
    var dependentData = {{ dependent_list | safe }};
    populateTable(dependentData);

    function getTableDataAsJSON() {
        const table = document.getElementById('family-table');
        const rows = document.querySelectorAll('#family-table tr');
        let dependentsData = [];
    
        for (let i = 1; i < rows.length; i++) { // Start from 1 to skip table header
            const cells = rows[i].getElementsByTagName('td');

            // Check if nationalIDExpDate is null or empty and handle it
            let nationalIDExpDate = cells[13].innerText;
            if (!nationalIDExpDate || nationalIDExpDate === 'null' || nationalIDExpDate.trim() === '') {
                nationalIDExpDate = null; // Set it to null if empty or invalid
            }

            let dependent = {
                firstName: cells[0].innerText, // Assuming first cell contains the first name
                secondName: cells[1].innerText,
                lastName: cells[2].innerText,
                gender: cells[3].innerText,
                relationship: cells[4].innerText,
                educationalStatus: cells[5].innerText,
                martialStatus: cells[6].innerText,
                nationalID: cells[7].innerText,
                healthStatus: cells[8].innerText,
                dependentIncomeTable: cells[9].innerText,
                needsType: cells[10].innerText,
                educationalDegree: cells[11].innerText,
                dateOfBitrh: cells[12].innerText,
                nationalIDExpDate: nationalIDExpDate, // Use the checked value
                needsDescription: cells[14].innerText,
                educationalLevel: cells[15].innerText,
                diseaseType: cells[16].innerText,
                workStatus: cells[17].innerText,
                employer: cells[18].innerText,
                contributeToFamilyIncome: cells[19].innerText,
                disabilityCheck: cells[20].innerText,
                disabilityType: cells[21].innerText,
            };
            dependentsData.push(dependent);
        }
    
        return JSON.stringify(dependentsData);
    }

    // Array to store file IDs marked for deletion
    let filesToDelete = [];

    document.querySelectorAll('.delete-file-btn').forEach(button => {
      button.addEventListener('click', function() {
        const fileId = this.getAttribute('data-file-id');
        const confirmation = confirm('هل أنت متأكد من حذف هذا الملف؟');
        if (confirmation) {
          // Remove file from table
          const row = this.closest('tr');
          row.remove();

          // Add file ID to array of files to delete
          filesToDelete.push(fileId);
        }
      });
    });

    document.getElementById('submit-btn').addEventListener('click', function(e) {
      e.preventDefault();

      var personal_national_id = $("#id_personalinfo_national_id").val().trim();

      // Alert the user if the provided national ID is added before in the family table
      if (isNationalIdExists(personal_national_id)) {
        alert("رقم الهوية/الإقامة لمقدم الطلب لا يمكن ان يكون مماثلاً لرقم الهوية/الإقامة لاحد المرافقين!")
        return;
      }

      // Alert the user if one of the files exceeds the maximum size
      if (!validateFileSizes()) {
        return false;
      }
  
      // Select the form element
      const form = document.getElementById('edit_beneficiary_request_form');

      const formData = new FormData(form);

      // Adding filesToDelete array to formData
      formData.append('filesToDelete', JSON.stringify(filesToDelete));

      // Collecting checkbox values
      let dependentNeedsType = [];
      document.querySelectorAll('#id_dependent_info_needs_type input[type=checkbox]').forEach((checkbox) => {
          if (checkbox.checked) {
              dependentNeedsType.push(checkbox.value);
          }
      });
      formData.append('dependent_info_needs_type', JSON.stringify(dependentNeedsType));
      

      // Collecting checkbox values
      let familyIssue = [];
      document.querySelectorAll('#id_familyinfo_family_issues input[type=checkbox]').forEach((checkbox) => {
          if (checkbox.checked) {
              familyIssue.push(checkbox.value);
          }
      });
      formData.append('familyinfo_family_issues', JSON.stringify(familyIssue));

      // Collecting checkbox values
      let familyNeedsType = [];
      document.querySelectorAll('#id_familyinfo_needs_type input[type=checkbox]').forEach((checkbox) => {
          if (checkbox.checked) {
              familyNeedsType.push(checkbox.value);
          }
      });
      formData.append('familyinfo_needs_type', JSON.stringify(familyNeedsType));

      // Adding information of the dependents table to the FormData
      formData.append('dependents-table', getTableDataAsJSON());

      // Remove 'Content-Type' header to allow the browser to add it
      // along with the correct 'boundary'
      // delete options.headers['Content-Type'];

      fetch('https://beneficiaries.asdiqa.org.sa{% url 'beneficiary_request_update_confirm' user_id=user_info.id %}', {
          method: 'POST',
          body: formData,
      })
      .then(response => response.json())
      .then(data => {
          console.log(data);
          if (data.redirect) {
              window.location.href = data.redirect;
              // console.log(data);
          } else {
              // Handle other responses
          }
      })
      .catch((error) => {
          console.error('Error:', error);
          // Handle error
      });
    });

  }); // document end line 
</script>
{% endblock %}
